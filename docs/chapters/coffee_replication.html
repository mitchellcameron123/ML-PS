<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.52">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>4&nbsp; Replication Case Study – Machine Learning and the Propensity Score</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/conclusion.html" rel="next">
<link href="../chapters/implimentation_workflow.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>

<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta name="citation_title" content="[4]{.chapter-number}&nbsp; [Replication Case Study]{.chapter-title}">
<meta name="citation_language" content="en">
<meta name="citation_reference" content="citation_title=An introduction to propensity score methods for reducing the effects of confounding in observational studies;,citation_abstract=The propensity score is the probability of treatment assignment conditional on observed baseline characteristics. The propensity score allows one to design and analyze an observational (nonrandomized) study so that it mimics some of the particular characteristics of a randomized controlled trial. In particular, the propensity score is a balancing score: conditional on the propensity score, the distribution of observed baseline covariates will be similar between treated and untreated subjects. I describe 4 different propensity score methods: matching on the propen-sity score, stratification on the propensity score, inverse probability of treatment weighting using the propensity score, and covariate adjustment using the propensity score. I describe balance diagnostics for examining whether the propensity score model has been adequately specified. Furthermore, I discuss differences between regression-based methods and propensity score-based methods for the analysis of observational data. I describe different causal average treatment effects and their relationship with propensity score analyses.  Taylor &amp;amp;amp; Francis Group, LLC.;,citation_author=Peter Austin;,citation_publication_date=2011;,citation_cover_date=2011;,citation_year=2011;,citation_issue=3;,citation_doi=10.1080/00273171.2011.568786;,citation_issn=00273171;,citation_pmid=21818162;,citation_volume=46;,citation_journal_title=Multivariate Behavioral Research;">
<meta name="citation_reference" content="citation_title=The Changing Risk and Burden of Wildfire in the Us;,citation_abstract=Recent dramatic and deadly increases in global wildfire activity have increased attention on the causes of wildfires, their consequences, and how risk from fire might be mitigated. Here we bring together data on the changing risk and societal burden of wildfire in the US. We estimate that nearly 50 million homes are currently in the wildland-urban interface in the US, a number increasing by 1 million houses every 3 years. Using a statistical model that links satellite-based fire and smoke data to pollution monitoring stations, we estimate that wildfires have accounted for up to 25% of PM2.5 in recent years across the US, and up to half in some Western regions. We then show that ambient exposure to smoke-based PM2.5 does not follow traditional socioeconomic exposure gradients. Finally, using stylized scenarios, we show that fuels management interventions have large but uncertain impacts on health outcomes, and that future health impacts from climate-change-induced wildfire smoke could approach projected overall increases in temperature-related mortality from climate change. We draw lessons for research and policy.;,citation_author=Marshall Burke;,citation_author=Anne Driscoll;,citation_author=Jenny Xue;,citation_author=Sam Heft-Neal;,citation_author=Jennifer Burney;,citation_author=Michael W. Wara;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_doi=10.2139/ssrn.3637724;,citation_journal_title=SSRN Electronic Journal;">
<meta name="citation_reference" content="citation_title=A tutorial on propensity score estimation for multiple treatments using generalized boosted models;,citation_abstract=The use of propensity scores to control for pretreatment imbalances on observed variables in non-randomized or observational studies examining the causal effects of treatments or interventions has become widespread over the past decade. For settings with two conditions of interest such as a treatment and a control, inverse probability of treatment weighted estimation with propensity scores estimated via boosted models has been shown in simulation studies to yield causal effect estimates with desirable properties. There are tools (e.g., the twang package in R) and guidance for implementing this method with two treatments. However, there is not such guidance for analyses of three or more treatments. The goals of this paper are twofold: (1) to provide step-by-step guidance for researchers who want to implement propensity score weighting for multiple treatments and (2) to propose the use of generalized boosted models (GBM) for estimation of the necessary propensity score weights. We define the causal quantities that may be of interest to studies of multiple treatments and derive weighted estimators of those quantities. We present a detailed plan for using GBM to estimate propensity scores and using those scores to estimate weights and causal effects. We also provide tools for assessing balance and overlap of pretreatment variables among treatment groups in the context of multiple treatments. A case study examining the effects of three treatment programs for adolescent substance abuse demonstrates the methods.  2013 John Wiley &amp;amp;amp; Sons, Ltd.;,citation_author=Daniel F. Mccaffrey;,citation_author=Beth Ann Griffin;,citation_author=Daniel Almirall;,citation_author=Mary Ellen Slaughter;,citation_author=Rajeev Ramchand;,citation_author=Lane F. Burgette;,citation_publication_date=2013;,citation_cover_date=2013;,citation_year=2013;,citation_issue=19;,citation_doi=10.1002/sim.5753;,citation_issn=02776715;,citation_pmid=23508673;,citation_volume=32;,citation_journal_title=Statistics in Medicine;">
<meta name="citation_reference" content="citation_title=A blueprint for synthetic control methodology: A causal inference tool for evaluating natural experiments in population health;,citation_author=Ben Barr;,citation_author=Xingna Zhang;,citation_author=Mark Green;,citation_author=Iain Buchan;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_doi=10.1136/bmj.o2712;,citation_isbn=2021054101;,citation_issn=17561833;,citation_pmid=36418028;,citation_volume=379;,citation_journal_title=Bmj;">
<meta name="citation_reference" content="citation_title=Wildfire Smoke and COVID-19;,citation_author=Natural Disasters and Severe Weather;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://www.cdc.gov/disasters/covid-19/wildfire{\_}smoke{\_}covid-19.html;">
<meta name="citation_reference" content="citation_title=Making Sense of Random Forest Probabilities: a Kernel Perspective;,citation_abstract=A random forest is a popular tool for estimating probabilities in machine learning classification tasks. However, the means by which this is accomplished is unprincipled: one simply counts the fraction of trees in a forest that vote for a certain class. In this paper, we forge a connection between random forests and kernel regression. This places random forest probability estimation on more sound statistical footing. As part of our investigation, we develop a model for the proximity kernel and relate it to the geometry and sparsity of the estimation problem. We also provide intuition and recommendations for tuning a random forest to improve its probability estimates.;,citation_author=Matthew A. Olson;,citation_author=Abraham J. Wyner;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_fulltext_html_url=http://arxiv.org/abs/1812.05792;">
<meta name="citation_reference" content="citation_title=Applied Causal Inference Powered by ML and AI;,citation_abstract=An introduction to the emerging fusion of machine learning and causal inference. The book presents ideas from classical structural equation models (SEMs) and their modern AI equivalent, directed acyclical graphs (DAGs) and structural causal models (SCMs), and covers Double/Debiased Machine Learning methods to do inference in such models using modern predictive tools.;,citation_author=Victor Chernozhukov;,citation_author=Christian Hansen;,citation_author=Nathan Kallus;,citation_author=Martin Spindler;,citation_author=Syrgkanis Vasilis;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;">
<meta name="citation_reference" content="citation_title=A local generalized method of moments estimator;,citation_abstract=A local Generalized Method of Moments Estimator is proposed for nonparametrically estimating unknown functions that are defined by conditional moment restrictions.  2006 Elsevier B.V. All rights reserved.;,citation_author=Arthur Lewbel;,citation_publication_date=2007;,citation_cover_date=2007;,citation_year=2007;,citation_issue=1;,citation_doi=10.1016/j.econlet.2006.08.011;,citation_issn=01651765;,citation_volume=94;,citation_journal_title=Economics Letters;">
<meta name="citation_reference" content="citation_title=7 Instrumental Variables Causal Inference :;,citation_author=The Mixtape;,citation_inbook_title=undefined;">
<meta name="citation_reference" content="citation_title=Causal Forest Estimation of Heterogeneous Household Response to Time-Of-Use Electricity Pricing Schemes;,citation_author=Eoghan O Neill;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_fulltext_html_url=https://arxiv.org/abs/arXiv:1810.09179v3;">
<meta name="citation_reference" content="citation_title=Large sample properties of matching estimators for average treatment effects;,citation_abstract=Matching estimators for average treatment effects are widely used in evaluation research despite the fact that their large sample properties have not been established in many cases. The absence of formal results in this area may be partly due to the fact that standard asymptotic expansions do not apply to matching estimators with a fixed number of matches because such estimators are highly nonsmooth functionals of the data. In this article we develop new methods for analyzing the large sample properties of matching estimators and establish a number of new results. We focus on matching with replacement with a fixed number of matches. First, we show that matching estimators are not N 1/2-consistent in general and describe conditions under which matching estimators do attain N 1/2-consistency. Second, we show that even in settings where matching estimators are N 1/2-consistent, simple matching estimators with a fixed number of matches do not attain the semiparametric efficiency bound. Third, we provide a consistent estimator for the large sample variance that does not require consistent nonparametric estimation of unknown functions. Software for implementing these methods is available in Matlab, Stata, and R.  The Econometric Society 2006.;,citation_author=Alberto Abadie;,citation_author=Guido W. Imbens;,citation_publication_date=2006;,citation_cover_date=2006;,citation_year=2006;,citation_issue=1;,citation_doi=10.1111/j.1468-0262.2006.00655.x;,citation_issn=00129682;,citation_volume=74;,citation_journal_title=Econometrica;">
<meta name="citation_reference" content="citation_title=Cross-validated:What is the difference between the G-formula , G- estmation , G-computation and G-methods;,citation_author=James Robins;">
<meta name="citation_reference" content="citation_title=The impact of coffee certification on small-scale producers’ livelihoods: A case study from the Jimma Zone, Ethiopia;,citation_abstract=What is the impact of product certification on small-scale farmers’ livelihoods? To what extent does the participation of Ethiopian small-scale coffee farmers in certified local cooperative structures improve their socioeconomic situation? To answer these questions, this article employs household data of 249 coffee farmers from six different cooperatives collected in the Jimma zone of Southwestern Ethiopia in 2009. Findings show that the certification of coffee cooperatives has in total a low impact on small-scale coffee producers’ livelihoods mainly due to (1) low productivity, (2) insignificant price premium, and (3) poor access to credit and information from the cooperative. Differences in production and organizational capacities between the local cooperatives are mirrored in the extent of the certification benefits for the smallholders. &amp;amp;amp;quot;Good&amp;quot; cooperatives have reaped the benefits of certification, whereas &quot;bad&quot; ones did not fare well. In this regard the &quot;cooperative effect&quot; overlies the &quot;certification effect&quot;.  2012 International Association of Agricultural Economists.;,citation_author=Pradyot Ranjan Jena;,citation_author=Bezawit Beyene Chichaibelu;,citation_author=Till Stellmacher;,citation_author=Ulrike Grote;,citation_publication_date=2012;,citation_cover_date=2012;,citation_year=2012;,citation_issue=4;,citation_doi=10.1111/j.1574-0862.2012.00594.x;,citation_issn=01695150;,citation_volume=43;,citation_journal_title=Agricultural Economics (United Kingdom);">
<meta name="citation_reference" content="citation_title=Variable selection for propensity score models;,citation_abstract=Despite the growing popularity of propensity score (PS) methods in epidemiology, relatively little has been written in the epidemiologic literature about the problem of variable selection for PS models. The authors present the results of two simulation studies designed to help epidemiologists gain insight into the variable selection problem in a PS analysis. The simulation studies illustrate how the choice of variables that are included in a PS model can affect the bias, variance, and mean squared error of an estimated exposure effect. The results suggest that variables that are unrelated to the exposure but related to the outcome should always be included in a PS model. The inclusion of these variables will decrease the variance of an estimated exposure effect without increasing bias. In contrast, including variables that are related to the exposure but not to the outcome will increase the variance of the estimated exposure effect without decreasing bias. In very small studies, the inclusion of variables that are strongly related to the exposure but only weakly related to the outcome can be detrimental to an estimate in a mean squared error sense. The addition of these variables removes only a small amount of bias but can increase the variance of the estimated exposure effect. These simulation studies and other analytical results suggest that standard model-building tools designed to create good predictive models of the exposure will not always lead to optimal PS models, particularly in small studies. Copyright  2006 by the Johns Hopkins Bloomberg School of Public Health All rights reserved.;,citation_author=M. Alan Brookhart;,citation_author=Sebastian Schneeweiss;,citation_author=Kenneth J. Rothman;,citation_author=Robert J. Glynn;,citation_author=Jerry Avorn;,citation_author=Til Stürmer;,citation_publication_date=2006;,citation_cover_date=2006;,citation_year=2006;,citation_issue=12;,citation_doi=10.1093/aje/kwj149;,citation_issn=00029262;,citation_pmid=16624967;,citation_volume=163;,citation_journal_title=American Journal of Epidemiology;">
<meta name="citation_reference" content="citation_title=STATS 361: Causal Inference;,citation_author=Stefan Wager;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;">
<meta name="citation_reference" content="citation_title=Residuals and Influence in Regression;,citation_author=Sanford Weisberg;,citation_author=R D Cook;,citation_publication_date=1982;,citation_cover_date=1982;,citation_year=1982;">
<meta name="citation_reference" content="citation_title=[ On the Application of Probability Theory to Agricultural Experiments . Essay on Principles . Section 9 .] Comment : Neyman ( 1923 ) and Causal Inference in Experiments and Observational Studies Author ( s ): Donald B . Rubin Source : Statistical Science;,citation_author=Donald B. Rubin;,citation_publication_date=1923;,citation_cover_date=1923;,citation_year=1923;">
<meta name="citation_reference" content="citation_title=Springer Texts in Statistics An Introduction to Statistical Learning wth application in R;,citation_abstract=An Introduction to Statistical Learning provides an accessible overview of the fi eld of statistical learning, an essential toolset for making sense of the vast and complex data sets that have emerged in fi elds ranging from biology to fi nance to marketing to astrophysics in the past twenty years. Th is book presents some of the most important modeling and prediction techniques, along with relevant applications. Topics include linear regression, classifi cation, resampling methods, shrinkage approaches, tree-based methods, support vector machines, clustering, and more. Color graphics and real-world examples are used to illustrate the methods presented. Since the goal of this textbook is to facilitate the use of these statistical learning techniques by practitioners in sci-ence, industry, and other fi elds, each chapter contains a tutorial on implementing the analyses and methods presented in R, an extremely popular open source statistical soft ware platform.;,citation_author=Gareth James;,citation_author=undefined DanielaWitten;,citation_author=Trevor Hastie;,citation_author=Robert Tibshirani;,citation_publication_date=2013;,citation_cover_date=2013;,citation_year=2013;,citation_isbn=9781461471370;,citation_issn=01621459;,citation_pmid=10911016;">
<meta name="citation_reference" content="citation_title=Different worlds Confirmatory versus exploratory research;,citation_abstract=Simon Schwab and Leonhard Held explain the differences between confirmatory and exploratory research and the dangers of confusing the two concepts.;,citation_author=Simon Schwab;,citation_author=Leonhard Held;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_issue=2;,citation_doi=10.1111/1740-9713.01369;,citation_issn=17409713;,citation_volume=17;,citation_journal_title=Significance;">
<meta name="citation_reference" content="citation_title=Does matching overcome LaLonde’s critique of nonexperimental estimators?;,citation_abstract=This paper applies cross-sectional and longitudinal propensity score matching estimators to data from the National Supported Work (NSW) Demonstration that have been previously analyzed by LaLonde (1986) and Dehejia and Wahba (1999, 2002). We find that estimates of the impact of NSW based on propensity score matching are highly sensitive to both the set of variables included in the scores and the particular analysis sample used in the estimation. Among the estimators we study, the difference-in-differences matching estimator performs the best. We attribute its performance to the fact that it eliminates potential sources of temporally invariant bias present in the NSW data, such as geographic mismatch between participants and nonparticipants and the use of a dependent variable measured in different ways for the two groups. Our analysis demonstrates that while propensity score matching is a potentially useful econometric tool, it does not represent a general solution to the evaluation problem.  2004 Elsevier B.V. All rights reserved.;,citation_author=Jeffrey A. Smith;,citation_author=Petra E. Todd;,citation_publication_date=2005;,citation_cover_date=2005;,citation_year=2005;,citation_doi=10.1016/j.jeconom.2004.04.011;,citation_isbn=1301405353;,citation_issn=03044076;,citation_volume=125;">
<meta name="citation_reference" content="citation_title=American Economic Association Evaluating the Econometric Evaluations of Training Programs with Experimental Data Author ( s ): Robert J . LaLonde Source : The American Economic Review , Vol . 76 , No . 4 ( Sep ., 1986 ), pp . 604-620 Published by : Americ;,citation_abstract=This paper compares the effect on trainee earnings of an employment program that was run as a field experiment where participants were randomly assigned to treatment and control groups with the estimates that would have been produced by an econometrician. This comparison shows that many of the econometric proce- dures do not replicate the experimentally determined results, and it suggests that researchers should be aware of the potential for specification errors in other nonexperimental evaluations.;,citation_author=Robert J. LaLonde;,citation_publication_date=1986;,citation_cover_date=1986;,citation_year=1986;,citation_issue=4;,citation_volume=76;,citation_journal_title=The American Economic Review;">
<meta name="citation_reference" content="citation_title=Causal Inference in the Presence of Interference in Sponsored Search Advertising;,citation_abstract=In classical causal inference, inferring cause-effect relations from data relies on the assumption that units are independent and identically distributed. This assumption is violated in settings where units are related through a network of dependencies. An example of such a setting is ad placement in sponsored search advertising, where the likelihood of a user clicking on a particular ad is potentially influenced by where it is placed and where other ads are placed on the search result page. In such scenarios, confounding arises due to not only the individual ad-level covariates but also the placements and covariates of other ads in the system. In this paper, we leverage the language of causal inference in the presence of interference to model interactions among the ads. Quantification of such interactions allows us to better understand the click behavior of users, which in turn impacts the revenue of the host search engine and enhances user satisfaction. We illustrate the utility of our formalization through experiments carried out on the ad placement system of the Bing search engine.;,citation_author=Razieh Nabi;,citation_author=Joel Pfeiffer;,citation_author=Denis Charles;,citation_author=Emre Kıcıman;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://arxiv.org/abs/2010.07458;,citation_doi=10.3389/fdata.2022.888592;,citation_issn=2624909X;,citation_volume=5;,citation_journal_title=Frontiers in Big Data;">
<meta name="citation_reference" content="citation_title=Excess of COVID-19 cases and deaths due to fine particulate matter exposure during the 2020 wildfires in the United States;,citation_abstract=The year 2020 brought unimaginable challenges in public health, with the confluence of the COVID-19 pandemic and wildfires across the western United States. Wildfires produce high levels of fine particulate matter (PM2.5). Recent studies reported that short-term exposure to PM2.5 is associated with increased risk of COVID-19 cases and deaths. We acquired and linked publicly available daily data on PM2.5, the number of COVID-19 cases and deaths, and other confounders for 92 western U.S. counties that were affected by the 2020 wildfires. We estimated the association between short-term exposure to PM2.5 during the wildfires and the epidemiological dynamics of COVID-19 cases and deaths. We adjusted for several time-varying confounding factors (e.g., weather, seasonality, long-term trends, mobility, and population size). We found strong evidence that wildfires amplified the effect of short-term exposure to PM2.5 on COVID-19 cases and deaths, although with substantial heterogeneity across counties.;,citation_author=Xiaodan Zhou;,citation_author=Kevin Josey;,citation_author=Leila Kamareddine;,citation_author=Miah C. Caine;,citation_author=Tianjia Liu;,citation_author=Loretta J. Mickley;,citation_author=Matthew Cooper;,citation_author=Francesca Dominici;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_issue=33;,citation_doi=10.1126/sciadv.abi8789;,citation_issn=23752548;,citation_pmid=34389545;,citation_volume=7;,citation_journal_title=Science Advances;">
<meta name="citation_reference" content="citation_title=Biased Random Forest for Dealing with the Class Imbalance Problem;,citation_abstract=The class imbalance issue has been a persistent problem in machine learning that hinders the accurate predictive analysis of data in many real-world applications. The class imbalance problem exists when the number of instances present in a class (or classes) is significantly fewer than the number of instances belonging to another class (or classes). Sufficiently recognizing the minority class during classification is a problem as most algorithms employed to learn from data input are biased toward the majority class. The underlying issue is made more complex with the presence of data difficult factors embedded in such data input. This paper presents a novel and effective ensemble-based method for dealing with the class imbalance problem. This paper is motivated by the idea of moving the oversampling from the data level to the algorithm level, instead of increasing the minority instances in the data sets, the algorithms in this paper aims to ’oversample the classification ensemble’ by increasing the number of classifiers that represent the minority class in the ensemble, i.e., random forest. The proposed biased random forest algorithm employs the nearest neighbor algorithm to identify the critical areas in a given data set. The standard random forest is then fed with more random trees generated based on the critical areas. The results show that the proposed algorithm is very effective in dealing with the class imbalance problem.;,citation_author=Mohammed Bader-El-Den;,citation_author=Eleman Teitei;,citation_author=Todd Perry;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_issue=7;,citation_doi=10.1109/TNNLS.2018.2878400;,citation_issn=21622388;,citation_pmid=30475733;,citation_volume=30;,citation_journal_title=IEEE Transactions on Neural Networks and Learning Systems;,citation_publisher=IEEE;">
<meta name="citation_reference" content="citation_title=Causal inference;,citation_abstract=We have examined only a few of the basic questions about causal inference that result from Reichenbach’s two principles. We have not considered what happens when the probability distribution is a mixture of distributions from different causal structures, or how unmeasured common causes can be detected, or what inferences can reliably be drawn about causal relations among unmeasured variables, or the exact advantages that experimental control offers. A good deal is known about these questions, and there is a good deal more to find out.  1991 Kluwer Academic Publishers.;,citation_author=undefined Mixtape;,citation_publication_date=1991;,citation_cover_date=1991;,citation_year=1991;,citation_doi=10.1007/BF00388284;,citation_issn=01650106;,citation_volume=35;">
<meta name="citation_reference" content="citation_title=Improving propensity score weighting using machine learning;,citation_abstract=Machine learning techniques such as classification and regression trees (CART) have been suggested as promising alternatives to logistic regression for the estimation of propensity scores. The authors examined the performance of various CART-based propensity score models using simulated data. Hypothetical studies of varying sample sizes (n=500, 1000, 2000) with a binary exposure, continuous outcome, and 10 covariates were simulated under seven scenarios differing by degree of non-linear and non-additive associations between covariates and the exposure. Propensity score weights were estimated using logistic regression (all main effects), CART, pruned CART, and the ensemble methods of bagged CART, random forests, and boosted CART. Performance metrics included covariate balance, standard error, per cent absolute bias, and 95 per cent confidence interval (CI) coverage. All methods displayed generally acceptable performance under conditions of either non-linearity or non-additivity alone. However, under conditions of both moderate non-additivity and moderate non-linearity, logistic regression had subpar performance, whereas ensemble methods provided substantially better bias reduction and more consistent 95 per cent CI coverage. The results suggest that ensemble methods, especially boosted CART, may be useful for propensity score weighting. Copyright  2009 John Wiley &amp;amp;amp; Sons, Ltd.;,citation_author=Brian K. Lee;,citation_author=Justin Lessler;,citation_author=Elizabeth A. Stuart;,citation_publication_date=2010;,citation_cover_date=2010;,citation_year=2010;,citation_doi=10.1002/sim.3782;,citation_issn=02776715;,citation_pmid=19960510;,citation_volume=29;,citation_journal_title=Statistics in Medicine;">
<meta name="citation_reference" content="citation_title=Causal Inference: What If (1st ed.);,citation_author=A. Miguel Hernan;,citation_author=M. James Robins;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://doi.org/10.1201/9781315374932;,citation_volume=[1] A. M.;">
<meta name="citation_reference" content="citation_title=Measuring the effectiveness of protected area networks in reducing deforestation;,citation_abstract=Global efforts to reduce tropical deforestation rely heavily on the establishment of protected areas. Measuring the effectiveness of these areas is difficult because the amount of deforestation that would have occurred in the absence of legal protection cannot be directly observed. Conventional methods of evaluating the effectiveness of protected areas can be biased because protection is not randomly assigned and because protection can induce deforestation spillovers (displacement) to neighboring forests. We demonstrate that estimates of effectiveness can be substantially improved by controlling for biases along dimensions that are observable, measuring spatial spillovers, and testing the sensitivity of estimates to potential hidden biases. We apply matching methods to evaluate the impact on deforestation of Costa Rica’s renowned protected-area system between 1960 and 1997. We find that protection reduced deforestation: approximately 10% of the protected forests would have been deforested had they not been protected. Conventional approaches to evaluating conservation impact, which fail to control for observable covariates correlated with both protection and deforestation, substantially overestimate avoided deforestation (by over 65%, based on our estimates). We also find that deforestation spillovers from protected to unprotected forests are negligible. Our conclusions are robust to potential hidden bias, as well as to changes in modeling assumptions. Our results show that, with appropriate empirical methods, conservation scientists and policy makers can better understand the relationships between human and natural systems and can use this to guide their attempts to protect critical ecosystem services.  2008 by The National Academy of Sciences of the USA.;,citation_author=Kwaw S. Andam;,citation_author=Paul J. Ferraro;,citation_author=Alexander Pfaff;,citation_author=G. Arturo Sanchez-Azofeifa;,citation_author=Juan A. Robalino;,citation_publication_date=2008;,citation_cover_date=2008;,citation_year=2008;,citation_issue=42;,citation_doi=10.1073/pnas.0800437105;,citation_issn=00278424;,citation_pmid=18854414;,citation_volume=105;,citation_journal_title=Proceedings of the National Academy of Sciences;">
<meta name="citation_reference" content="citation_title=Classification and Regression Trees;,citation_author=L Breiman;,citation_author=Jerome H Friedman;,citation_author=Richard A Olshen;,citation_author=C J Stone;,citation_publication_date=1984;,citation_cover_date=1984;,citation_year=1984;,citation_fulltext_html_url=https://api.semanticscholar.org/CorpusID:29458883;,citation_volume=40;,citation_journal_title=Biometrics;">
<meta name="citation_reference" content="citation_title=Climate drivers of global wildfire burned area;,citation_abstract=Wildfire is an integral part of the Earth system, but at the same time it can pose serious threats to human society and to certain types of terrestrial ecosystems. Meteorological conditions are a key driver of wildfire activity and extent, which led to the emergence of the use of fire danger indices that depend solely on weather conditions. The Canadian Fire Weather Index (FWI) is a widely used fire danger index of this kind. Here, we evaluate how well the FWI, its components, and the climate variables from which it is derived, correlate with observation-based burned area (BA) for a variety of world regions. We use a novel technique, according to which monthly BA are grouped by size for each Global Fire Emissions Database (GFED) pyrographic region. We find strong correlations of BA anomalies with the FWI anomalies, as well as with the underlying deviations from their climatologies for the four climate variables from which FWI is estimated, namely, temperature, relative humidity, precipitation, and wind. We quantify the relative sensitivity of the observed BA to each of the four climate variables, finding that this relationship strongly depends on the pyrographic region and land type. Our results indicate that the BA anomalies strongly correlate with FWI anomalies at a GFED region scale, compared to the strength of the correlation with individual climate variables. Additionally, among the individual climate variables that comprise the FWI, relative humidity and temperature are the most influential factors that affect the observed BA. Our results support the use of the composite fire danger index FWI, as well as its sub-indices, the Build-Up Index (BUI) and the Initial Spread Index (ISI), comparing to single climate variables, since they are found to correlate better with the observed forest or non-forest BA, for the most regions across the globe.;,citation_author=Manolis Grillakis;,citation_author=Apostolos Voulgarakis;,citation_author=Anastasios Rovithakis;,citation_author=Konstantinos D. Seiradakis;,citation_author=Aristeidis Koutroulis;,citation_author=Robert D. Field;,citation_author=Matthew Kasoar;,citation_author=Athanasios Papadopoulos;,citation_author=Mihalis Lazaridis;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_doi=10.1088/1748-9326/ac5fa1;,citation_issn=17489326;,citation_volume=17;,citation_journal_title=Environmental Research Letters;">
<meta name="citation_reference" content="citation_title=Evaluating uses of data mining techniques in propensity score estimation: a simulation study;,citation_author=Soko Setoguchi;,citation_author=Sebastian Schneeweiss;,citation_author=Alan M. Brookhart;,citation_author=Robert J. Glynn;,citation_author=Francis E. Cook;,citation_publication_date=2008;,citation_cover_date=2008;,citation_year=2008;,citation_issue=March;,citation_doi=10.1002/pds;,citation_issn=1053-8569;,citation_volume=17;,citation_journal_title=pharmacoepidemiology and drug safety;">
<meta name="citation_reference" content="citation_title=Credibility of propensity score matching estimates. An example from Fair Trade certification of coffee producers;,citation_abstract=Propensity score matching (PSM) is an increasingly popular method for evaluation studies in agricultural and development economics. However, statisticians and econometricians have stressed that results rely on untestable assumptions, and therefore, guidelines for researchers on how to improve credibility have been developed. We follow one of these guidelines with a data set analysed by other authors to evaluate the impact of Fair Trade certification on the income of coffee producers. We provide thereby a best practice example of how to evaluate the credibility of PSM estimates. We find that a thorough assessment of the assumptions made renders the data we use not suitable for a credible PSM estimation of the effects of treatment. We conclude that the debate about the impact of Fair Trade certification would greatly benefit from a detailed reporting of credibility checking.;,citation_author=Nicolas Lampach;,citation_author=Ulrich B. Morawetz;,citation_publication_date=2016;,citation_cover_date=2016;,citation_year=2016;,citation_issue=44;,citation_doi=10.1080/00036846.2016.1153795;,citation_issn=14664283;,citation_volume=48;,citation_journal_title=Applied Economics;">
<meta name="citation_reference" content="citation_title=Some practical guidance for the implementation of propensity score matching;,citation_abstract=Propensity score matching (PSM) has become a popular approach to estimate causal treatment effects. It is widely applied when evaluating labour market policies, but empirical examples can be found in very diverse fields of study. Once the researcher has decided to use PSM, he is confronted with a lot of questions regarding its implementation. To begin with, a first decision has to be made concerning the estimation of the propensity score. Following that one has to decide which matching algorithm to choose and determine the region of common support. Subsequently, the matching quality has to be assessed and treatment effects and their standard errors have to be estimated. Furthermore, questions like ’what to do if there is choice-based sampling?’ or ’when to measure effects?’ can be important in empirical studies. Finally, one might also want to test the sensitivity of estimated treatment effects with respect to unobserved heterogeneity or failure of the common support condition. Each implementation step involves a lot of decisions and different approaches can be thought of. The aim of this paper is to discuss these implementation issues and give some guidance to researchers who want to use PSM for evaluation purposes.  2008 The Authors Journal compilation  2008 Blackwell Publishing Ltd.;,citation_author=Marco Caliendo;,citation_author=Sabine Kopeinig;,citation_publication_date=2008;,citation_cover_date=2008;,citation_year=2008;,citation_issue=1;,citation_doi=10.1111/j.1467-6419.2007.00527.x;,citation_issn=09500804;,citation_volume=22;,citation_journal_title=Journal of Economic Surveys;">
<meta name="citation_reference" content="citation_title=Understanding Inverse Probability of Treatment Weighting (IPTW) in Causal Inference An Intuitive Explanation of IPTW and a Comparison to Multivariate Regression;,citation_author=Jonah Breslow;,citation_author=undefined Follow;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;">
<meta name="citation_reference" content="citation_title=Metalearners for estimating heterogeneous treatment effects using machine learning;,citation_abstract=There is growing interest in estimating and analyzing heterogeneous treatment effects in experimental and observational studies. We describe a number of metaalgorithms that can take advantage of any supervised learning or regression method in machine learning and statistics to estimate the conditional average treatment effect (CATE) function. Metaalgorithms build on base algorithms—such as random forests (RFs), Bayesian additive regression trees (BARTs), or neural networks—to estimate the CATE, a function that the base algorithms are not designed to estimate directly. We introduce a metaalgorithm, the X-learner, that is provably efficient when the number of units in one treatment group is much larger than in the other and can exploit structural properties of the CATE function. For example, if the CATE function is linear and the response functions in treatment and control are Lipschitz-continuous, the X-learner can still achieve the parametric rate under regularity conditions. We then introduce versions of the X-learner that use RF and BART as base learners. In extensive simulation studies, the X-learner performs favorably, although none of the metalearners is uniformly the best. In two persuasion field experiments from political science, we demonstrate how our X-learner can be used to target treatment regimes and to shed light on underlying mechanisms. A software package is provided that implements our methods.;,citation_author=Sören R. Künzel;,citation_author=Jasjeet S. Sekhon;,citation_author=Peter J. Bickel;,citation_author=Bin Yu;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_fulltext_html_url=https://arxiv.org/abs/1706.03461;,citation_issue=10;,citation_doi=10.1073/pnas.1804597116;,citation_issn=10916490;,citation_pmid=30770453;,citation_volume=116;,citation_journal_title=Proceedings of the National Academy of Sciences of the United States of America;">
<meta name="citation_reference" content="citation_title=Propensity score model overfitting led to inflated variance of estimated odds ratios;,citation_abstract=Objective Simulation studies suggest that the ratio of the number of events to the number of estimated parameters in a logistic regression model should be not less than 10 or 20 to 1 to achieve reliable effect estimates. Applications of propensity score approaches for confounding control in practice, however, do often not consider these recommendations. Study Design and Setting We conducted extensive Monte Carlo and plasmode simulation studies to investigate the impact of propensity score model overfitting on the performance in estimating conditional and marginal odds ratios using different established propensity score inference approaches. We assessed estimate accuracy and precision as well as associated type I error and type II error rates in testing the null hypothesis of no exposure effect. Results For all inference approaches considered, our simulation study revealed considerably inflated standard errors of effect estimates when using overfitted propensity score models. Overfitting did not considerably affect type I error rates for most inference approaches. However, because of residual confounding, estimation performance and type I error probabilities were unsatisfactory when using propensity score quintile adjustment. Conclusion Overfitting of propensity score models should be avoided to obtain reliable estimates of treatment or exposure effects in individual studies.;,citation_author=Tibor Schuster;,citation_author=Wilfrid Kouokam Lowe;,citation_author=Robert W. Platt;,citation_publication_date=2016;,citation_cover_date=2016;,citation_year=2016;,citation_fulltext_html_url=http://dx.doi.org/10.1016/j.jclinepi.2016.05.017;,citation_doi=10.1016/j.jclinepi.2016.05.017;,citation_issn=18785921;,citation_pmid=27498378;,citation_volume=80;,citation_journal_title=Journal of Clinical Epidemiology;,citation_publisher=Elsevier Inc;">
<meta name="citation_reference" content="citation_title=What Makes Forest-Based Heterogeneous Treatment Effect Estimators Work?;,citation_abstract=Estimation of heterogeneous treatment effects (HTE) is of prime importance in many disciplines, from personalized medicine to economics among many others. Random forests have been shown to be a flexible and powerful approach to HTE estimation in both randomized trials and observational studies. In particular “causal forests” introduced by Athey, Tibshirani and Wager (Ann. Statist. 47 (2019) 1148–1178), along with the R implementation in package grf were rapidly adopted. A related approach, called “model-based forests” that is geared toward randomized trials and simultaneously captures effects of both prognostic and predictive variables, was introduced by Seibold, Zeileis and Hothorn (Stat. Methods Med. Res. 27 (2018) 3104–3125) along with a modular implementation in the R package model4you. Neither procedure is directly applicable to the estimation of individualized predictions of excess postpartum blood loss caused by a cesarean section in comparison to vaginal delivery. Clearly, randomization is hardly possible in this setup, and thus model-based forests lack clinical trial data to address this question. On the other hand, the skewed and interval-censored postpartum blood loss observations violate assumptions made by causal forests. Here we present a tailored model-based forest for skewed and interval-censored data to infer possible predictive prepartum characteristics and their impact on excess postpartum blood loss caused by a cesarean section. As a methodological basis, we propose a unifying view on causal and model-based forests that goes beyond the theoretical motivations and investigates which computational elements make causal forests so successful and how these can be blended with the strengths of model-based forests. To do so, we show that both methods can be understood in terms of the same parameters and model assumptions for an additive model under L2 loss. This theoretical insight allows us to implement several flavors of “model-based causal forests” and dissect their different elements in silico. The original causal forests and model-based forests are compared with the new blended versions in a benchmark study exploring both randomized trials and observational settings. In the randomized setting, both approaches performed akin. If confounding was present in the data-generating process, we found local centering of the treatment indicator with the corresponding propensities to be the main driver for good performance. Local centering of the outcome was less important and might be replaced or enhanced by simultaneous split selection with respect to both prognostic and predictive effects. This lays the foundation for future research combining random forests for HTE estimation with other types of models.;,citation_author=Y. Susanne Dandl;,citation_author=Christian Haslinger;,citation_author=Torsten Hothorn;,citation_author=Heidi Seibold;,citation_author=Erik Sverdrup;,citation_author=Stefan Wager;,citation_author=Achim Zeileis;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://arxiv.org/abs/2206.10323;,citation_issue=1;,citation_doi=10.1214/23-AOAS1799;,citation_issn=19417330;,citation_volume=18;,citation_journal_title=Annals of Applied Statistics;">
<meta name="citation_reference" content="citation_title=Root-N-Consistent Semiparametric Regression;,citation_author=P.m. Robinson;,citation_publication_date=1988;,citation_cover_date=1988;,citation_year=1988;,citation_fulltext_html_url=https://www.jstor.org/stable/1912705;,citation_issue=4;,citation_volume=56;,citation_journal_title=The Econometric Socieity;">
<meta name="citation_reference" content="citation_title=Estimating Treatment Effects with Causal Forests: An Application;,citation_abstract=We apply causal forests to a dataset derived from the National Study of Learning Mindsets, and discusses resulting practical and conceptual challenges. This note will appear in an upcoming issue of Observational Studies, Empirical Investigation of Methods for Heterogeneity, that compiles several analyses of the same dataset.;,citation_author=Susan Athey;,citation_author=Stefan Wager;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_fulltext_html_url=https://arxiv.org/abs/1902.07409;,citation_issue=2;,citation_doi=10.1353/obs.2019.0001;,citation_issn=27673324;,citation_volume=5;,citation_journal_title=Observational Studies;">
<meta name="citation_reference" content="citation_title=Machine Learning Methods for Estimating Heterogeneous Causal Effect;,citation_abstract=In this paper we study the problems of estimating heterogeneity in causal effects in experimental or observational studies and conducting inference about the magnitude of the differences in treatment effects across subsets of the population. In applications, our method provides a data-driven approach to determine which subpopulations have large or small treatment effects and to test hypotheses about the differences in these effects. For experiments, our method allows researchers to identify heterogeneity in treatment effects that was not specified in a pre-analysis plan, without concern about invalidating inference due to multiple testing. In most of the literature on supervised machine learning (e.g. regression trees, random forests, LASSO, etc.), the goal is to build a model of the relationship between a unit’s attributes and an observed outcome. A prominent role in these methods is played by cross-validation which compares predictions to actual outcomes in test samples, in order to select the level of complexity of the model that provides the best predictive power. Our method is closely related, but it differs in that it is tailored for predicting causal effects of a treatment rather than a unit’s outcome. The challenge is that the “ground truth” for a causal effect is not observed for any individual unit: we observe the unit with the treatment, or without the treatment, but not both at the same time. Thus, it is not obvious how to use cross-validation to determine whether a causal effect has been accurately predicted. We propose several novel cross-validation criteria for this problem and demonstrate through simulations the conditions under which they perform better than standard methods for the problem of causal effects. We then apply the method to a large-scale field experiment re-ranking results on a search engine. Keywords:;,citation_author=Susan Athey;,citation_author=Guido Imbens;,citation_publication_date=2015;,citation_cover_date=2015;,citation_year=2015;,citation_fulltext_html_url=https://arxiv.org/abs/1504.01132;">
<meta name="citation_reference" content="citation_title=Causal inference for climate change events from satellite image time series using computer vision and deep learning;,citation_abstract=We propose a method for causal inference using satellite image time series, in order to determine the treatment effects of interventions which impact climate change, such as deforestation. Simply put, the aim is to quantify the ’before versus after’ effect of climate related human driven interventions, such as urbanization; as well as natural disasters, such as hurricanes and forest fires. As a concrete example, we focus on quantifying forest tree cover change/ deforestation due to human led causes. The proposed method involves the following steps. First, we uae computer vision and machine learning/deep learning techniques to detect and quantify forest tree coverage levels over time, at every time epoch. We then look at this time series to identify changepoints. Next, we estimate the expected (forest tree cover) values using a Bayesian structural causal model and projecting/forecasting the counterfactual. This is compared to the values actually observed post intervention, and the difference in the two values gives us the effect of the intervention (as compared to the non intervention scenario, i.e. what would have possibly happened without the intervention). As a specific use case, we analyze deforestation levels before and after the hyperinflation event (intervention) in Brazil (which ended in 1993-94), for the Amazon rainforest region, around Rondonia, Brazil. For this deforestation use case, using our causal inference framework can help causally attribute change/reduction in forest tree cover and increasing deforestation rates due to human activities at various points in time.;,citation_author=Vikas Ramachandra;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_fulltext_html_url=http://arxiv.org/abs/1910.11492;">
<meta name="citation_reference" content="citation_title=A Primer for Applying Propensity-Score Matching;,citation_abstract=The use of microeconometric techniques to estimate the effects of development policies has become a common approach not only for scholars, but also for policy-makers engaged in designing, implementing and evaluating projects in different fields. Among these techniques, Propensity-Score Matching (PSM) is increasingly applied in the policy evaluation community. This technical note provides a guide to the key aspects of implementing PSM methodology for an audience of practitioners interested in understanding its applicability to specific evaluation problems. The note summarizes the basic conditions under which PSM can be used to estimate the impact of a program and the data required. It explains how the Conditional Independence Assumption, combined with the Overlap Condition, reduces selection bias when participation in a program is determined by observable characteristics. It also describes different matching algorithms and some tests to assess the quality of the matching. Case studies are used throughout to illustrate important concepts in impact evaluation and PSM. In the annexes, the note provides an outline of the main technical aspects and a list of statistical and econometric software for implementing PSM.;,citation_author=Carolyn Heinrich;,citation_publication_date=2010;,citation_cover_date=2010;,citation_year=2010;,citation_fulltext_html_url=http://www.iadb.org/document.cfm?id=35320229;,citation_issue=August;,citation_issn={\textless}null{\textgreater};,citation_journal_title=Development;">
<meta name="citation_reference" content="citation_title=Quasi-oracle estimation of heterogeneous treatment effects;,citation_abstract=Flexible estimation of heterogeneous treatment effects lies at the heart of many statistical applications, such as personalized medicine and optimal resource allocation. In this article we develop a general class of two-step algorithms for heterogeneous treatment effect estimation in observational studies. First, we estimate marginal effects and treatment propensities to form an objective function that isolates the causal component of the signal. Then, we optimize this data-adaptive objective function. The proposed approach has several advantages over existing methods. From a practical perspective, our method is flexible and easy to use: in both steps, any loss-minimization method can be employed, such as penalized regression, deep neural networks, or boosting; moreover, these methods can be fine-tuned by cross-validation. Meanwhile, in the case of penalized kernel regression, we show that our method has a quasi-oracle property. Even when the pilot estimates for marginal effects and treatment propensities are not particularly accurate, we achieve the same error bounds as an oracle with prior knowledge of these two nuisance components. We implement variants of our approach based on penalized regression, kernel ridge regression, and boosting in a variety of simulation set-ups, and observe promising performance relative to existing baselines.;,citation_author=X. Nie;,citation_author=S. Wager;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_fulltext_html_url=https://arxiv.org/abs/1712.04912;,citation_issue=2;,citation_doi=10.1093/biomet/asaa076;,citation_issn=14643510;,citation_volume=108;,citation_journal_title=Biometrika;">
<meta name="citation_reference" content="citation_title=Increasing trends in high-severity fire in the southwestern USA from 1984 to 2015;,citation_abstract=In the last three decades, over 4.1 million hectares have burned in Arizona and New Mexico and the largest fires in documented history have occurred in the past two decades. Changes in burn severity over time, however, have not been well documented in forest and woodland ecosystems in the southwestern US. Using remotely sensed burn severity data from 1621 fires (&amp;amp;amp;gt;404 ha), we assessed trends from 1984 to 2015 in Arizona and New Mexico in (1) number of fires and total area burned in all vegetation types; (2) area burned, area of high-severity, and percent of high-severity fire in all forest and woodland areas; and (3) area burned, area of high-severity, and percent of high-severity in seven different grouped forest and woodland vegetation types (Ecological Response Unit [ERU] Fire Regime Types). Number of fires and area burned increased across the Southwest regardless of vegetation type. The significant increasing trends held for area burned, area of high-severity, and percent of high-severity fire in all forest and woodland ecosystems. Area burned and area burned severely increased in all seven ERU Fire Regime Types while percent of high-severity fire increased in two ERUs: Mixed Conifer Frequent Fire and Mixed Conifer with Aspen/Spruce Fir. Managers must face the implications of increasing, uncharacteristic high-severity fire in many ecosystems as climate change and human pressures continue to affect fire regimes.;,citation_author=Megan P. Singleton;,citation_author=Andrea E. Thode;,citation_author=Andrew J. Sánchez Meador;,citation_author=Jose M. Iniguez;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_fulltext_html_url=https://doi.org/10.1016/j.foreco.2018.11.039;,citation_issue=November 2018;,citation_doi=10.1016/j.foreco.2018.11.039;,citation_issn=03781127;,citation_volume=433;,citation_journal_title=Forest Ecology and Management;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Causal Rule Ensemble: Interpretable Discovery and Inference of Heterogeneous Treatment Effects;,citation_abstract=In health and social sciences, it is critically important to identify subgroups of the study population where a treatment has notable heterogeneity in the causal effects with respect to the average treatment effect. Data-driven discovery of heterogeneous treatment effects (HTE) via decision tree methods has been proposed for this task. Despite its high interpretability, the single-tree discovery of HTE tends to be highly unstable and to find an oversimplified representation of treatment heterogeneity. To accommodate these shortcomings, we propose Causal Rule Ensemble (CRE), a new method to discover heterogeneous subgroups through an ensemble-of-trees approach. CRE has the following features: 1) provides an interpretable representation of the HTE; 2) allows extensive exploration of complex heterogeneity patterns; and 3) guarantees high stability in the discovery. The discovered subgroups are defined in terms of interpretable decision rules, and we develop a general two-stage approach for subgroup-specific conditional causal effects estimation, providing theoretical guarantees. Via simulations, we show that the CRE method has a strong discovery ability and a competitive estimation performance when compared to state-of-the-art techniques. Finally, we apply CRE to discover subgroups most vulnerable to the effects of exposure to air pollution on mortality for 35.3 million Medicare beneficiaries across the contiguous U.S.;,citation_author=Falco J. Bargagli-Stoffi;,citation_author=Riccardo Cadei;,citation_author=Kwonsang Lee;,citation_author=Francesca Dominici;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=http://arxiv.org/abs/2009.09036;">
<meta name="citation_reference" content="citation_title=An introduction to g methods;,citation_abstract=Robins’ generalized methods (g methods) provide consistent estimates of contrasts (e.g. differences, ratios) of potential outcomes under a less restrictive set of identification conditions than do standard regression methods (e.g. linear, logistic, Cox regression). Uptake of g methods by epidemiologists has been hampered by limitations in understanding both conceptual and technical details. We present a simple worked example that illustrates basic concepts, while minimizing technical complications.;,citation_author=Ashley I. Naimi;,citation_author=Stephen R. Cole;,citation_author=Edward H. Kennedy;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_issue=2;,citation_doi=10.1093/ije/dyw323;,citation_issn=14643685;,citation_pmid=28039382;,citation_volume=46;,citation_journal_title=International Journal of Epidemiology;">
<meta name="citation_reference" content="citation_title=Overfitting in propensity score model: a commentary on “propensity score model overfitting led to inflated variance of estimated odds ratios” by Schuster et&nbsp;al.;,citation_author=David Hajage;,citation_author=Florence Tubach;,citation_author=Yann De Rycke;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_fulltext_html_url=http://dx.doi.org/10.1016/j.jclinepi.2017.05.011;,citation_doi=10.1016/j.jclinepi.2017.05.011;,citation_issn=18785921;,citation_pmid=28549930;,citation_volume=88;,citation_journal_title=Journal of Clinical Epidemiology;,citation_publisher=Elsevier Inc.;">
<meta name="citation_reference" content="citation_title=Regression Shrinkage and Selection via the Lasso;,citation_abstract=We propose a new method for estimation in linear models. The ’lasso’ minimizes the residual sum of squares subject to the sum of the absolute value of the coefficients being less than a constant. Because of the nature of this constraint it tends to produce some coefficients that are exactly 0 and hence gives interpretable models. Our simulation studies suggest that the lasso enjoys some of the favourable properties of both subset selection and ridge regression. It produces interpretable models like subset selection and exhibits the stability of ridge regression. There is also an interesting relationship with recent work in adaptive function estimation by Donoho and Johnstone. The lasso idea is quite general and can be applied in a variety of statistical models: extensions to generalized regression models and tree-based models are briefly described.;,citation_author=Robert Tibshirani;,citation_publication_date=1996;,citation_cover_date=1996;,citation_year=1996;,citation_fulltext_html_url=https://www.jstor.org/stable/pdf/2346178.pdf?refreqid=fastly-default{\%}3Aff57285d6b8854126d21a135984fc4ca{\&amp;amp;amp;}ab{\_}segments={\&amp;}origin={\&amp;}initiator={\&amp;}acceptTC=1;,citation_issue=1;,citation_volume=58;,citation_journal_title=Journal of the Royal Statistical Society;">
<meta name="citation_reference" content="citation_title=Policy Learning With Observational Data;,citation_abstract=In many areas, practitioners seek to use observational data to learn a treatment assignment policy that satisfies application‐specific constraints, such as budget, fairness, simplicity, or other functional form constraints. For example, policies may be restricted to take the form of decision trees based on a limited set of easily observable individual characteristics. We propose a new approach to this problem motivated by the theory of semiparametrically efficient estimation. Our method can be used to optimize either binary treatments or infinitesimal nudges to continuous treatments, and can leverage observational data where causal effects are identified using a variety of strategies, including selection on observables and instrumental variables. Given a doubly robust estimator of the causal effect of assigning everyone to treatment, we develop an algorithm for choosing whom to treat, and establish strong guarantees for the asymptotic utilitarian regret of the resulting policy.;,citation_author=Susan Athey;,citation_author=Stefan Wager;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_fulltext_html_url=https://arxiv.org/abs/1702.02896;,citation_issue=1;,citation_doi=10.3982/ecta15732;,citation_issn=0012-9682;,citation_volume=89;,citation_journal_title=Econometrica;">
<meta name="citation_reference" content="citation_title=Propensity score adjustment using machine learning classification algorithms to control selection bias in online surveys;,citation_abstract=Modern survey methods may be subject to non-observable bias, from various sources. Among online surveys, for example, selection bias is prevalent, due to the sampling mechanism commonly used, whereby participants self-select from a subgroup whose characteristics differ from those of the target population. Several techniques have been proposed to tackle this issue. One such is Propensity Score Adjustment (PSA), which is widely used and has been analysed in various studies. The usual method of estimating the propensity score is logistic regression, which requires a reference probability sample in addition to the online nonprobability sample. The predicted propensities can be used for reweighting using various estimators. However, in the online survey context, there are alternatives that might outperform logistic regression regarding propensity estimation. The aim of the present study is to determine the efficiency of some of these alternatives, involving Machine Learning (ML) classification algorithms. PSA is applied in two simulation scenarios, representing situations commonly found in online surveys, using logistic regression and ML models for propensity estimation. The results obtained show that ML algorithms remove selection bias more effectively than logistic regression when used for PSA, but that their efficacy depends largely on the selection mechanism employed and the dimensionality of the data.;,citation_author=Ramón Ferri-García;,citation_author=María Del Mar Rueda;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_issue=4;,citation_doi=10.1371/journal.pone.0231500;,citation_isbn=1111111111;,citation_issn=19326203;,citation_pmid=32320429;,citation_volume=15;,citation_journal_title=PLoS ONE;">
<meta name="citation_reference" content="citation_title=The changing risk and burden of wildfire in the United States;,citation_abstract=Recent dramatic and deadly increases in global wildfire activity have increased attention on the causes of wildfires, their consequences, and how risk from wildfire might be mitigated. Here we bring together data on the changing risk and societal burden of wildfire in the United States. We estimate that nearly 50 million homes are currently in the wildland-urban interface in the United States, a number increasing by 1 million houses every 3 y. To illustrate how changes in wildfire activity might affect air pollution and related health outcomes, and how these linkages might guide future science and policy, we develop a statistical model that relates satellite-based fire and smoke data to information from pollution monitoring stations. Using the model, we estimate that wildfires have accounted for up to 25% of PM2.5 (particulate matter with diameter &amp;amp;amp;lt;2.5 $\mu$m) in recent years across the United States, and up to half in some Western regions, with spatial patterns in ambient smoke exposure that do not follow traditional socioeconomic pollution exposure gradients. We combine the model with stylized scenarios to show that fuel management interventions could have large health benefits and that future health impacts from climate-change-induced wildfire smoke could approach projected overall increases in temperature-related mortality from climate change-but that both estimates remain uncertain. We use model results to highlight important areas for future research and to draw lessons for policy.;,citation_author=Marshall Burke;,citation_author=Anne Driscoll;,citation_author=Sam Heft-Neal;,citation_author=Jiani Xue;,citation_author=Jennifer Burney;,citation_author=Michael Wara;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_issue=2;,citation_doi=10.1073/PNAS.2011048118;,citation_issn=10916490;,citation_pmid=33431571;,citation_volume=118;,citation_journal_title=Proceedings of the National Academy of Sciences of the United States of America;">
<meta name="citation_reference" content="citation_title=Comparison of various machine learning algorithms for estimating generalized propensity score;,citation_abstract=In this paper, we conducted a simulation study to evaluate the performance of four algorithms: multinomial logistic regression (MLR), bagging (BAG), random forest (RF), and gradient boosting (GB), for estimating generalized propensity score (GPS). Similar to the propensity score (PS), the ultimate goal of using GPS is to estimate unbiased average treatment effects (ATEs) in observational studies. We used the GPS estimates computed from these four algorithms with the generalized doubly robust (GDR) estimator to estimate ATEs in observational studies. We evaluated these ATE estimates in terms of bias and mean squared error (MSE). Simulation results show that overall, the GB algorithm produced the best ATE estimates based on these evaluation criteria. Thus, we recommend using the GB algorithm for estimating GPS in practice.;,citation_author=Chunhao Tu;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_fulltext_html_url=https://doi.org/10.1080/00949655.2019.1571059;,citation_issue=4;,citation_doi=10.1080/00949655.2019.1571059;,citation_issn=15635163;,citation_volume=89;,citation_journal_title=Journal of Statistical Computation and Simulation;">
<meta name="citation_reference" content="citation_title=Springer Series in Statistics The Elements of Statistical Learning;,citation_abstract=During the past decade there has been an explosion in computation and information technology. With it has come a vast amount of data in a variety of fields such as medicine, biology, finance, and marketing. The challenge of understanding these data has led to the development of new tools in the field of statistics, and spawned new areas such as data mining, machine learning, and bioinformatics. Many of these tools have common underpinnings but are often expressed with different terminology. This book describes the important ideas in these areas in a common conceptual framework. While the approach is statistical, the emphasis is on concepts rather than mathematics.;,citation_author=Trevor Hastie;,citation_publication_date=2009;,citation_cover_date=2009;,citation_year=2009;,citation_fulltext_html_url=http://www.springerlink.com/index/D7X7KX6772HQ2135.pdf;,citation_issue=2;,citation_isbn=9780387848570;,citation_issn=03436993;,citation_pmid=15512507;,citation_volume=27;,citation_journal_title=The Mathematical Intelligencer;">
<meta name="citation_reference" content="citation_title=Causal Inference : An Introduction;,citation_abstract=Lately, the concept of causality has been gaining popularity in the domain of machine learning and artificial intelligence due to its…;,citation_author=Siddhant Haldar;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_fulltext_html_url=https://medium.com/analytics-vidhya/causal-inference-an-introduction-f424df7c76ef{\%}0Ahttp://files/135/causal-inference-an-introduction-f424df7c76ef.html;,citation_journal_title=Medium;">
<meta name="citation_reference" content="citation_title=Member-only story Understanding Causal Trees How to use regression trees to estimate heterogeneous treatment effects;,citation_abstract=Listen Share More Cover, image by Author causal inference, we are usually interested in estimating the causal effect of a treatment (a drug, ad, product, …) on an outcome of interest (a disease, firm revenue, customer satisfaction, …). However, knowing that a This member-only story is on us. Upgrade to access all of Medium.;,citation_author=Matteo Courthoud;,citation_author=undefined Follow;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;">
<meta name="citation_reference" content="citation_title=Directed Acyclic Graphs;,citation_author=Scott Cunningham;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_doi=10.2307/j.ctv1c29t27.6;,citation_inbook_title=Causal inference: The mixtape;">
<meta name="citation_reference" content="citation_title=An Introduction to Recursive Partitioning for Heterogeneous Causal Effects Estimation Using causalTree package;,citation_author=Susan Athey;,citation_publication_date=2016;,citation_cover_date=2016;,citation_year=2016;">
<meta name="citation_reference" content="citation_title=On the application of probability theory to agricultural experiments. Essay on principles. Section 9;,citation_abstract=In the portion of the paper translated here, Neyman introduces a model for the analysis of field experiments conducted for the purpose of comparing a number of crop varieties, which makes use of a double-indexed array of unknown potential yields, one index corresponding to varieties and the other to plots. The yield corresponding to only one variety will be observed on any given plot, but through an urn model embodying sampling without replacement from this doubly indexed array, Neyman obtains a formula for the variance of the difference between the averages of the observed yields of two varieties. This variance involves the variance over all plots of the potential yields and the correlation coefficient r between the potential yields of the two varieties on the same plot. Since it is impossible to estimate r directly, Neyman advises taking r = 1, observing that in practice this may lead to using too large an estimated standard deviation, when comparing two variety means.  1990, Institute of Mathematical Statistics. All Rights Reserved.;,citation_author=Jerzy Splawa-Neyman;,citation_publication_date=1923;,citation_cover_date=1923;,citation_year=1923;,citation_fulltext_html_url=https://www.mimuw.edu.pl/{~}noble/courses/BayesianNetworks/90NeymanTranslation.pdf;,citation_doi=10.1214/ss/1177012031;,citation_issn=08834237;">
<meta name="citation_reference" content="citation_title=Matching and Subclassification;,citation_author=Scott Cunningham;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_doi=10.2307/j.ctv1c29t27.8;,citation_inbook_title=Causal inference: The mixtape;">
<meta name="citation_reference" content="citation_title=Generalized random forests;,citation_abstract=We propose generalized random forests, a method for nonparametric statistical estimation based on random forests (Breiman [Mach. Learn. 45 (2001) 5–32]) that can be used to fit any quantity of interest identified as the solution to a set of local moment equations. Following the literature on local maximum likelihood estimation, our method considers a weighted set of nearby training examples; however, instead of using classical kernel weighting functions that are prone to a strong curse of dimensionality, we use an adaptive weighting function derived from a forest designed to express heterogeneity in the specified quantity of interest. We propose a flexible, computationally efficient algorithm for growing generalized random forests, develop a large sample theory for our method showing that our estimates are consistent and asymptotically Gaussian and provide an estimator for their asymptotic variance that enables valid confidence intervals. We use our approach to develop new methods for three statistical tasks: nonparametric quantile regression, conditional average partial effect estimation and heterogeneous treatment effect estimation via instrumental variables. A software implementation, grf for R and C++, is available from CRAN.;,citation_author=Susan Athey;,citation_author=Julie Tibshirani;,citation_author=Stefan Wager;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_fulltext_html_url=https://arxiv.org/abs/1610.01271;,citation_issue=2;,citation_doi=10.1214/18-AOS1709;,citation_issn=00905364;,citation_volume=47;,citation_journal_title=Annals of Statistics;">
<meta name="citation_reference" content="citation_title=Machine Learning in Policy Evaluation: New Tools for Causal Inference;,citation_abstract=While machine learning (ML) methods have received a lot of attention in recent years, these methods are primarily for prediction. Empirical researchers conducting policy evaluations are, on the other hand, pre-occupied with causal problems, trying to answer counterfactual questions: what would have happened in the absence of a policy? Because these counterfactuals can never be directly observed (described as the &amp;amp;amp;quot;fundamental problem of causal inference&amp;quot;) prediction tools from the ML literature cannot be readily used for causal inference. In the last decade, major innovations have taken place incorporating supervised ML tools into estimators for causal parameters such as the average treatment effect (ATE). This holds the promise of attenuating model misspecification issues, and increasing of transparency in model selection. One particularly mature strand of the literature include approaches that incorporate supervised ML approaches in the estimation of the ATE of a binary treatment, under the $\backslash$textit{unconfoundedness} and positivity assumptions (also known as exchangeability and overlap assumptions). This article reviews popular supervised machine learning algorithms, including the Super Learner. Then, some specific uses of machine learning for treatment effect estimation are introduced and illustrated, namely (1) to create balance among treated and control groups, (2) to estimate so-called nuisance models (e.g. the propensity score, or conditional expectations of the outcome) in semi-parametric estimators that target causal parameters (e.g. targeted maximum likelihood estimation or the double ML estimator), and (3) the use of machine learning for variable selection in situations with a high number of covariates.;,citation_author=Noémi Kreif;,citation_author=Karla DiazOrdaz;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_fulltext_html_url=https://arxiv.org/abs/1903.00402;,citation_doi=10.1093/acrefore/9780190625979.013.256;,citation_journal_title=Oxford Research Encyclopedia of Economics and Finance;">
<meta name="citation_reference" content="citation_title=The central role of the propensity score in observational studies for causal effects;,citation_abstract=The propensity score is the conditional probability of assignment to a particular treatment given a vector of observed covariates. Both large and small sample theory show that adjustment for the scalar propensity score is sufficient to remove bias due to all observed covariates. Applications include: (i) matched sampling on the univariate propensity score, which is a generalization of discriminant matching, (ii) multivariate adjustment by subclassification on the propensity score where the same subclasses are used to estimate treatment effects for all outcome variables and in all subpopulations, and (iii) visual representation of multivariate covariance adjustment by a two-dimensional plot.;,citation_author=Paul R. Rosenbaum;,citation_author=Donald B. Rubin;,citation_publication_date=1983;,citation_cover_date=1983;,citation_year=1983;,citation_issue=1;,citation_doi=10.1017/CBO9780511810725.016;,citation_isbn=9780511810725;,citation_volume=70;,citation_journal_title=Biometrika;">
<meta name="citation_reference" content="citation_title=Toolkit for Weighting and Analysis of Nonequivalent Groups: A Tutorial for the R TWANG Package;,citation_abstract=The Toolkit for Weighting and Analysis of Nonequivalent Groups , twang, contains a set of functions and procedures to support causal modeling of observational data through the estimation and evaluation of propensity scores and associated weights. This package was ... $\backslash$n;,citation_author=Greg Ridgeway;,citation_author=Dan Mccaffrey;,citation_author=Andrew Morral;,citation_author=Matthew Cefalu;,citation_author=Lane Burgette;,citation_author=Beth Ann Griffin;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_doi=10.7249/tl136.1;">
<meta name="citation_reference" content="citation_title=Estimating individual treatment effect: Generalization bounds and algorithms;,citation_abstract=There is intense interest in applying machine learning to problems of causal inference in fields such as healthcare, economics and education. In particular, individual-level causal inference has important applications such as precision medicine. We give a new theoretical analysis and family of algorithms for predicting individual treatment effect (ITE) from observational data, under the assumption known as strong ignorability. The algorithms leam a &amp;amp;amp;quot;balanced&amp;quot; representation such that the induced treated and control distributions look similar, and we give a novel and intuitive generalization-error bound showing the expected ITE estimation error of a representation is bounded by a sum of the standard generalization-error of that representation and the distance between the treated and control distributions induced by the representation. We use Integral Probability Metrics to measure distances between distributions, deriving explicit bounds for the Wasserstein and Maximum Mean Discrepancy (MMD) distances. Experiments on real and simulated data show the new algorithms match or outperform the state-of-the-art.;,citation_author=Uri Shalit;,citation_author=Fredrik D. Johansson;,citation_author=David Sontag;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_fulltext_html_url=https://arxiv.org/abs/1606.03976;">
<meta name="citation_reference" content="citation_title=Causal inference in statistics: An overview;,citation_abstract=This review presents empirical researcherswith recent advances in causal inference, and stresses the paradigmatic shifts that must be undertaken in moving from traditional statistical analysis to causal analysis of multivariate data. Special emphasis is placed on the assumptions that underly all causal inferences, the languages used in formulating those assumptions, the conditional nature of all causal and counterfactual claims, and the methods that have been developed for the assessment of such claims. These advances are illustrated using a general theory of causation based on the Structural Causal Model (SCM) described in Pearl (2000a), which subsumes and unifies other approaches to causation, and provides a coherent mathematical foundation for the analysis of causes and counterfactuals. In particular, the paper surveys the development of mathematical tools for inferring (from a combination of data and assumptions) answers to three types of causal queries: (1) queries about the effects of potential interventions, (also called &amp;amp;amp;quot;causal effects&amp;quot; or &quot;policy evaluation&quot;) (2) queries about probabilities of counterfactuals, (including assessment of &quot;regret,&quot; &quot;attribution&quot; or &quot;causes of effects&quot;) and (3) queries about direct and indirect effects (also known as &quot;mediation&quot;). Finally, the paper defines the formal and conceptual relationships between the structural and potential-outcome frameworks and presents tools for a symbiotic analysis that uses the strong features of both.;,citation_author=Judea Pearl;,citation_publication_date=2009;,citation_cover_date=2009;,citation_year=2009;,citation_doi=10.1214/09-SS057;,citation_issn=19357516;,citation_volume=3;">
<meta name="citation_reference" content="citation_title=Excess of COVID-19 cases and deaths due to fine particulate matter exposure during the 2020 wildfires in the United States;,citation_abstract=The year 2020 brought unimaginable challenges in public health, with the confluence of the COVID-19 pandemic and wildfires across the western United States. Wildfires produce high levels of fine particulate matter (PM2.5). Recent studies reported that short-term exposure to PM2.5 is associated with increased risk of COVID-19 cases and deaths. We acquired and linked publicly available daily data on PM2.5, the number of COVID-19 cases and deaths, and other confounders for 92 western U.S. counties that were affected by the 2020 wildfires. We estimated the association between short-term exposure to PM2.5 during the wildfires and the epidemiological dynamics of COVID-19 cases and deaths. We adjusted for several time-varying confounding factors (e.g., weather, seasonality, long-term trends, mobility, and population size). We found strong evidence that wildfires amplified the effect of short-term exposure to PM2.5 on COVID-19 cases and deaths, although with substantial heterogeneity across counties.;,citation_author=Xiaodan Zhou;,citation_author=Kevin Josey;,citation_author=Leila Kamareddine;,citation_author=Miah C. Caine;,citation_author=Tianjia Liu;,citation_author=Loretta J. Mickley;,citation_author=Matthew Cooper;,citation_author=Francesca Dominici;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_issue=33;,citation_doi=10.1126/sciadv.abi8789;,citation_issn=23752548;,citation_pmid=34389545;,citation_volume=7;,citation_journal_title=Science Advances;">
<meta name="citation_reference" content="citation_title=A critical appraisal of propensity-score matching in the medical literature between 1996 and 2003;,citation_abstract=Propensity-score methods are increasingly being used to reduce the impact of treatment-selection bias in the estimation of treatment effects using observational data. Commonly used propensity-score methods include covariate adjustment using the propensity score, stratification on the propensity score, and propensityscore matching. Empirical and theoretical research has demonstrated that matching on the propensity score eliminates a greater proportion of baseline differences between treated and untreated subjects than does stratification on the propensity score. However, the analysis of propensity-score-matched samples requires statistical methods appropriate for matched-pairs data. We critically evaluated 47 articles that were published between 1996 and 2003 in the medical literature and that employed propensity-score matching. We found that only two of the articles reported the balance of baseline characteristics between treated and untreated subjects in the matched sample and used correct statistical methods to assess the degree of imbalance. Thirteen (28 per cent) of the articles explicitly used statistical methods appropriate for the analysis of matched data when estimating the treatment effect and its statistical significance. Common errors included using the log-rank test to compare Kaplan–Meier survival curves in the matched sample, using Cox regression, logistic regression, chi-squared tests, t-tests, and Wilcoxon rank sum tests in the matched sample, thereby failing to account for the matched nature of the data. We provide guidelines for the analysis and reporting of studies that employ propensity-score matching.;,citation_author=Peter C. Austin;,citation_publication_date=2008;,citation_cover_date=2008;,citation_year=2008;,citation_issue=April;,citation_doi=10.1002/sim.3150;,citation_volume=27;,citation_journal_title=Statistics in Medicine;">
<meta name="citation_reference" content="citation_title=The contribution of wildfire to PM2.5 trends in the USA;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://www.unep.org/resources/report/spreading-wildfire-rising-threat-extraordinary-landscape-fires?gad{\_}source=1{\&amp;amp;amp;}gclid=CjwKCAjwwr6wBhBcEiwAfMEQs4akEBSfMrNFii0aVgYlS-DOo-zlKl{\_}yb8q0JC5zm5LzDeC{\_}eM6YQxoCPSMQAvD{\_}BwE;">
<meta name="citation_reference" content="citation_title=A comparison of machine learning algorithms and covariate balance measures for propensity score matching and weighting;,citation_abstract=Propensity score matching (PSM) and propensity score weighting (PSW) are popular tools to estimate causal effects in observational studies. We address two open issues: how to estimate propensity scores and assess covariate balance. Using simulations, we compare the performance of PSM and PSW based on logistic regression and machine learning algorithms (CART; Bagging; Boosting; Random Forest; Neural Networks; naive Bayes). Additionally, we consider several measures of covariate balance (Absolute Standardized Average Mean (ASAM) with and without interactions; measures based on the quantile-quantile plots; ratio between variances of propensity scores; area under the curve (AUC)) and assess their ability in predicting the bias of PSM and PSW estimators. We also investigate the importance of tuning of machine learning parameters in the context of propensity score methods. Two simulation designs are employed. In the first, the generating processes are inspired to birth register data used to assess the effect of labor induction on the occurrence of caesarean section. The second exploits more general generating mechanisms. Overall, among the different techniques, random forests performed the best, especially in PSW. Logistic regression and neural networks also showed an excellent performance similar to that of random forests. As for covariate balance, the simplest and commonly used metric, the ASAM, showed a strong correlation with the bias of causal effects estimators. Our findings suggest that researchers should aim at obtaining an ASAM lower than 10% for as many variables as possible. In the empirical study we found that labor induction had a small and not statistically significant impact on caesarean section.;,citation_author=Massimo Cannas;,citation_author=Bruno Arpino;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_issue=4;,citation_doi=10.1002/bimj.201800132;,citation_issn=15214036;,citation_pmid=31090108;,citation_volume=61;,citation_journal_title=Biometrical Journal;">
<meta name="citation_reference" content="citation_title=Causal Inference : 4 Potential Outcomes Causal Model;,citation_author=Scott Cunningham;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_doi=https://doi.org/10.2307/j.ctv1c29t27;,citation_isbn=9780300255881;,citation_inbook_title=undefined;">
<meta name="citation_reference" content="citation_title=Methamphetamine use and HIV risk behavior among men who inject drugs: Causal inference using coarsened exact matching;,citation_abstract=Background: Understanding the association between methamphetamine (MA) use and HIV risk behavior among people who inject drugs (PWID) will assist policy-makers and program managers to sharpen the focus of HIV prevention interventions. This study examines the relationship between MA use and HIV risk behavior among men who inject drugs (MWID) in Tehran, Iran, using coarsened exact matching (CEM). Methods: Data for these analyses were derived from a cross-sectional study conducted between June and July 2016. We assessed three outcomes of interest - all treated as binary variables, including distributive and receptive needle and syringe (NS) sharing and condomless sex during the month before interview. Our primary exposure of interest was whether study participants reported any MA use in the month prior to the interview. Firstly, we report the descriptive statistics for the pooled samples and matched sub-samples using CEM. The pooled and matched estimates of the associations and their 95% CI were estimated using a logistic regression model. Results: Overall, 500 MWID aged between 18 and 63 years (mean = 28.44, SD = 7.22) were recruited. Imbalances in the measured demographic characteristics and risk behaviors between MA users and non-users were attenuated using matching. In the matched samples, the regression models showed participants who reported MA use were 1.82 times more likely to report condomless sex (OR = 1.82 95% CI 1.51, 4.10; P = 0.031), and 1.35 times more likely to report distributive NS sharing in the past 30 days, as compared to MA non-users (OR = 1.35 95% CI 1.15-1.81). Finally, there was a statistically significant relationship between MA use and receptive NS sharing in the past month. People who use MA in the last month had higher odds of receptive NS sharing when compared to MA non-users (OR = 4.2 95% CI 2.7, 7.5; P = 0.013). Conclusions: Our results show a significant relationship between MA use and HIV risk behavior among MWID in Tehran, Iran. MA use was related with increased NS sharing, which is associated with higher risk for HIV exposure and transmission.;,citation_author=Mehdi Noroozi;,citation_author=Peter Higgs;,citation_author=Alireza Noroozi;,citation_author=Bahram Armoon;,citation_author=Bentolhoda Mousavi;,citation_author=Rosa Alikhani;,citation_author=Mohammad Rafi Bazrafshan;,citation_author=Ali Nazeri Astaneh;,citation_author=Azadeh Bayani;,citation_author=Ladan Fattah Moghaddam;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_issue=66;,citation_doi=10.1186/s12954-020-00411-1;,citation_issn=14777517;,citation_pmid=32957982;,citation_volume=17;,citation_journal_title=Harm Reduction Journal;,citation_publisher=Harm Reduction Journal;">
<meta name="citation_reference" content="citation_title=Model-Based Direct Ad justment;,citation_abstract=Direct adjustment or standardization applies population weights to sub- class means in an effort to estimate population quantities from a sample that is not representative of the population. Direct adjustment has several attractive features, but when there are many subclasses it can attach large weights to small quantities of data, often in a fairly erratic manner. In the extreme, direct adjustment can attach infinite weight to nonexistent data, a noticeable inconvenience in practice. This article proposes a method of model-based direct adjustment that preserves the attractive features of conventional direct adjustment while stabilizing the weights attached to small subclasses. The sample mean and conventional direct adjustment are both special cases of model-based direct adjustment under two different extreme models for the subclass-specific selection proba- bilities. The discussion of this method provides some insights into the behavior of true and estimated propensity scores: the estimated scores are better than the true ones for almost the same reason that direct adjustment can outperform the sample mean in a simple random sample. The method is applied to a nonrandom sample in an effort to estimate a discrete distribution of essay scores in the College Board’s Advanced Placement Examination in Biology.;,citation_author=Paul R Rosenbaum;,citation_publication_date=1987;,citation_cover_date=1987;,citation_year=1987;,citation_issue=398;,citation_volume=82;">
<meta name="citation_reference" content="citation_title=Causal Inference: What If;,citation_author=A. Miguel Hernan;,citation_author=M. James Robins;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_fulltext_html_url=https://doi.org/10.1201/9781315374932;,citation_isbn=9781315374932;">
<meta name="citation_reference" content="citation_title=Causal inference using regression on the treatment variable;,citation_abstract=9.1 Causal inference and predictive comparisons So far, we have been interpreting regressions predictively: given the values of several inputs, the fitted model allows us to predict y, considering the n data points as a simple random sample from a hypothetical infinite &amp;amp;amp;quot; superpopulation &amp;quot; or probability distribution. Then we can make comparisons across different combinations of values for these inputs. This chapter and the next consider causal inference, which concerns what would happen to an outcome y as a result of a hypothesized &quot; treatment &quot; or intervention. In a regression framework, the treatment can be written as a variable T : 1 T i = 1 if unit i receives the &quot; treatment &quot; 0 if unit i receives the &quot; control, &quot; or, for a continuous treatment, T i = level of the &quot; treatment &quot; assigned to unit i. In the usual regression context, predictive inference relates to comparisons between units, whereas causal inference addresses comparisons of different treatments if applied to the same units. More generally, causal inference can be viewed as a special case of prediction in which the goal is to predict what would have happened under different treatment options. We shall discuss this theoretical framework more thoroughly in Section 9.2. Causal interpretations of regression coefficients can only be justified by relying on much stricter assumptions than are needed for predictive inference. To motivate the detailed study of regression models for causal effects, we present two simple examples in which predictive comparisons do not yield appropriate causal inferences. Hypothetical example of zero causal effect but positive predictive comparison;,citation_author=Andrew Gelman;,citation_author=Jennifer Hill;,citation_publication_date=2010;,citation_cover_date=2010;,citation_year=2010;,citation_doi=10.1017/cbo9780511790942.012;,citation_journal_title=Data Analysis Using Regression and Multilevel/Hierarchical Models;">
<meta name="citation_reference" content="citation_title=Random Forests;,citation_abstract=Random forests are a combination of tree predictors such that each tree depends on the values of a random vector sampled independently and with the same The distribution for all trees in the forest. generalization error for forests converges a.s. to a limit as the number of trees in the forest becomes large. The generalization error of a forest of tree classifiers depends on the strength of the individual trees in the forest and the correlation between them. Using a random selection of features to split each node yields error rates that compare favorably to Adaboost (Freund and Schapire[1996]), but are more robust with respect to noise. Internal estimates monitor error, strength, and correlation and these are used to show the response to increasing the number of features used in the splitting. Internal estimates are also used to measure variable importance. These ideas are also applicable to regression.;,citation_author=Leo Brieman;,citation_publication_date=2001;,citation_cover_date=2001;,citation_year=2001;,citation_doi=https://doi.org/10.1023/A:1010933404324;,citation_issn=2158107X;,citation_volume=45;,citation_journal_title=Machine Learning;">
<meta name="citation_reference" content="citation_title=The health effects of ambient PM2.5 and potential mechanisms;,citation_abstract=The impacts of ambient PM2.5 on public health have become great concerns worldwide, especially in the developing countries. Epidemiological and toxicological studies have shown that PM2.5 does not only induce cardiopulmonary disorders and/or impairments, but also contributes to a variety of other adverse health effects, such as driving the initiation and progression of diabetes mellitus and eliciting adverse birth outcomes. Of note, recent findings have demonstrated that PM2.5 may still pose a hazard to public health even at very low levels (far below national standards) of exposure. The proposed underlying mechanisms whereby PM2.5 causes adverse effects to public health include inducing intracellular oxidative stress, mutagenicity/genotoxicity and inflammatory responses. The present review aims to provide an brief overview of new insights into the molecular mechanisms linking ambient PM2.5 exposure and health effects, which were explored with new technologies in recent years.;,citation_author=Shaolong Feng;,citation_author=Dan Gao;,citation_author=Fen Liao;,citation_author=Furong Zhou;,citation_author=Xinming Wang;,citation_publication_date=2016;,citation_cover_date=2016;,citation_year=2016;,citation_fulltext_html_url=http://dx.doi.org/10.1016/j.ecoenv.2016.01.030;,citation_doi=10.1016/j.ecoenv.2016.01.030;,citation_issn=10902414;,citation_pmid=26896893;,citation_volume=128;,citation_journal_title=Ecotoxicology and Environmental Safety;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Do production contracts raise farm productivity? an instrumental variables approach;,citation_abstract=Estimating how the use of production contracts affects farm productivity is difficult when unobservable factors are correlated with both the decision to contract and productivity. To account for potential selection bias, this study uses the local availability of production contracts as an instrument for whether a farm uses a contract in order to estimate the impact of contract use on total factor productivity. Results indicate that use of a production contract is associated with a large increase in productivity for feeder-to-finish hog farms in the United States. The instrumental variable method makes it credible to assert that the observed association is a causal relationship rather than simply a correlation. Copyright 2008 Northeastern Agricultural and Resource Economics Association.;,citation_author=Nigel Key;,citation_author=William D. McBride;,citation_publication_date=2008;,citation_cover_date=2008;,citation_year=2008;,citation_issue=2;,citation_doi=10.1017/S1068280500002987;,citation_issn=10682805;,citation_volume=37;,citation_journal_title=Agricultural and Resource Economics Review;">
<meta name="citation_reference" content="citation_title=Minimum Wages and Employment: A Case Study of the Fast-Food Industry in New Jersey and Pennsylvania;,citation_abstract=On April 1, 1992, New Jersey’s minimum wage rose from $4.25 to $5.05 per hour. To evaluate the impact of the law we surveyed 410 fast-food restaurants in New Jersey and eastern Pennsylvania before and after the rise. Comparisons of employment growth at stores in New Jersey and Pennsylvania (where the minimum wage was constant) provide simple estimates of the effect of the higher minimum wage. We also compare employment changes at stores in New Jersey that were initially paying high wages (above $5) to the changes at lower-wage stores. We find no indication that the rise in the minimum wage reduced employment.;,citation_author=David Card;,citation_author=Alan B Krueger;,citation_publication_date=1994;,citation_cover_date=1994;,citation_year=1994;,citation_issue=4;,citation_doi=10.3386/w4509;,citation_volume=84;,citation_journal_title=American Economic Review;">
<meta name="citation_reference" content="citation_title=Greedy Function Approximation: A Gradient Boosting Machine;,citation_author=Jerome H. Friedman;,citation_publication_date=2001;,citation_cover_date=2001;,citation_year=2001;,citation_fulltext_html_url=https://www.jstor.org/stable/2699986;,citation_issue=5;,citation_volume=29;,citation_journal_title=The Annals of Statistics;">
<meta name="citation_reference" content="citation_title=Confidence intervals for random forests: The jackknife and the infinitesimal jackknife;,citation_abstract=We study the variability of predictions made by bagged learners and random forests, and show how to estimate standard errors for these methods. Our work builds on variance estimates for bagging proposed by Efron (1992, 2013) that are based on the jackknife and the infinitesimal jackknife (IJ). In practice, bagged predictors are computed using a finite number B of bootstrap replicates, and working with a large B can be computationally expensive. Direct applications of jackknife and IJ estimators to bagging require B = ⊖(n1.5) bootstrap replicates to converge, where n is the size of the training set. We propose improved versions that only require B = ⊖(n) replicates. Moreover, we show that the IJ estimator requires 1.7 times less bootstrap replicates than the jackknife to achieve a given accuracy. Finally, we study the sampling distributions of the jackknife and IJ variance estimates themselves. We illustrate our findings with multiple experiments and simulation studies.  2014 Stefan Wager, Trevor Hastie and Bradley Efron.;,citation_author=Stefan Wager;,citation_author=Trevor Hastie;,citation_author=Bradley Efron;,citation_publication_date=2014;,citation_cover_date=2014;,citation_year=2014;,citation_fulltext_html_url=https://arxiv.org/abs/1311.4555;,citation_issn=15337928;,citation_pmid=25580094;,citation_volume=15;,citation_journal_title=Journal of Machine Learning Research;">
<meta name="citation_reference" content="citation_title=Metalearners for estimating heterogeneous treatment effects using machine learning;,citation_abstract=There is growing interest in estimating and analyzing heterogeneous treatment effects in experimental and observational studies. We describe a number of metaalgorithms that can take advantage of any supervised learning or regression method in machine learning and statistics to estimate the conditional average treatment effect (CATE) function. Metaalgorithms build on base algorithms—such as random forests (RFs), Bayesian additive regression trees (BARTs), or neural networks—to estimate the CATE, a function that the base algorithms are not designed to estimate directly. We introduce a metaalgorithm, the X-learner, that is provably efficient when the number of units in one treatment group is much larger than in the other and can exploit structural properties of the CATE function. For example, if the CATE function is linear and the response functions in treatment and control are Lipschitz-continuous, the X-learner can still achieve the parametric rate under regularity conditions. We then introduce versions of the X-learner that use RF and BART as base learners. In extensive simulation studies, the X-learner performs favorably, although none of the metalearners is uniformly the best. In two persuasion field experiments from political science, we demonstrate how our X-learner can be used to target treatment regimes and to shed light on underlying mechanisms. A software package is provided that implements our methods.;,citation_author=Sören R. Künzel;,citation_author=Jasjeet S. Sekhon;,citation_author=Peter J. Bickel;,citation_author=Bin Yu;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_fulltext_html_url=https://arxiv.org/abs/1706.03461;,citation_issue=10;,citation_doi=10.1073/pnas.1804597116;,citation_issn=10916490;,citation_pmid=30770453;,citation_volume=116;,citation_journal_title=Proceedings of the National Academy of Sciences of the United States of America;">
<meta name="citation_reference" content="citation_title=Causal Inference of Human Resources Key Performance Indicators;,citation_abstract=The purpose of this study is to examine the relationship between attrition rates and key per- formance indicators in a corporate workforce by using the propensity score (PS) matching. The study shows the possibilities of using logistic regression and propensity score matching methods in human capital strategic decisions. The data used here was from a fictional data set created by IBM data scientists based on active and separated employees to uncover the factors that lead to employee attrition. For each of the 1,470 employee records, information was generated about de- mographic characteristics such as age, gender, marital status, education level, employment status and culture, compensation, and performance factors. Two logistic equations are defined for two key performance objectives, culture and work life balance. A logistic regression analysis on each equation, with support from contrast estimation, reveals a comparison between the most and least favorable responses to key performance indicators is most significant. After successfully balancing a treatment and control group using the nearest neighbor matching technique on propensity score estimates from the logistic regression, a paired t-test reveals a statistically significant difference for the work life balance key performance indi- cator. This result is interpreted as having the highest probability of successfully reducing attrition when the focus is on increasing employee responses to satisfaction levels of work life balance in comparison to other key performance indicators.;,citation_author=Matthew Kovach;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_fulltext_html_url=https://www.ibm.com/communities/analytics/watson-analytics-blog/hr-employee-attrition/;,citation_dissertation_institution=Bowling Green State University;">
<meta name="citation_reference" content="citation_title=Machine Learning for Causal Inference;,citation_author=Sheng Li;,citation_author=Zhixuan Chu;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_doi=10.1007/978-3-031-35051-1;,citation_isbn=9783031350504;">
<meta name="citation_reference" content="citation_title=Joint culpability: The effects of medical marijuana laws on crime;,citation_abstract=Most U.S. states have passed medical marijuana laws. In this paper, we study the effects of these laws on violent and property crime. We first estimate models that control for city fixed effects and flexible city-specific time trends. To supplement this regression analysis, we use the synthetic control method which can relax the parallel trend assumption and better account for heterogeneous policy effects. Both the regression analysis and the synthetic control method suggest no causal effects of medical marijuana laws on violent or property crime at the national level. We also find no strong effects within individual states, except for in California where the medical marijuana law reduced both violent and property crime by 20%.;,citation_author=Yu-Wei Luke Chu;,citation_author=Wilbur Townsend;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_fulltext_html_url=https://doi.org/10.1016/j.jebo.2018.07.003;,citation_doi=10.1016/j.jebo.2018.07.003;,citation_issn=01672681;,citation_volume=159;,citation_journal_title=Journal of Economic Behavior and Organization;,citation_publisher=Elsevier B.V.;">
<meta name="citation_reference" content="citation_title=Air pollution and COVID-19 mortality in the United States: Strengths and limitations of an ecological regression analysis;,citation_abstract=Assessing whether long-term exposure to air pollution increases the severity of COVID-19 health outcomes, including death, is an important public health objective. Limitations in COVID-19 data availability and quality remain obstacles to conducting conclusive studies on this topic. At present, publicly available COVID-19 outcome data for representative populations are available only as area-level counts. Therefore, studies of long-term exposure to air pollution and COVID-19 outcomes using these data must use an ecological regression analysis, which precludes controlling for individual-level COVID-19 risk factors. We describe these challenges in the context of one of the first preliminary investigations of this question in the United States, where we found that higher historical PM2.5 exposures are positively associated with higher county-level COVID-19 mortality rates after accounting for many area-level confounders. Motivated by this study, we lay the groundwork for future research on this important topic, describe the challenges, and outline promising directions and opportunities.;,citation_author=X. Wu;,citation_author=R. C. Nethery;,citation_author=M. B. Sabath;,citation_author=D. Braun;,citation_author=F. Dominici;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_issue=45;,citation_doi=10.1126/SCIADV.ABD4049;,citation_issn=23752548;,citation_pmid=33148655;,citation_volume=6;,citation_journal_title=Science Advances;">
<meta name="citation_reference" content="citation_title=The state of applied econometrics: Causality and policy evaluation;,citation_author=Susan Athey;,citation_author=Guido W. Imbens;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_fulltext_html_url=https://arxiv.org/abs/1607.00699;,citation_issue=2;,citation_doi=10.1257/jep.31.2.3;,citation_issn=08953309;,citation_volume=31;,citation_journal_title=Journal of Economic Perspectives;">
<meta name="citation_reference" content="citation_title=Reflection on modern methods: When worlds collide - Prediction, machine learning and causal inference;,citation_abstract=Causal inference requires theory and prior knowledge to structure analyses, and is not usuallythought of as an arena for the application of prediction modelling. However, contemporary causal inference methods, premised on counterfactual or potential outcomes approaches, often include processing steps before the final estimation step. The purposes of this paper are: (i) to overview the recent emergence of prediction underpinning steps in contemporary causal inference methods as a usefulperspective on contemporary causal inference methods, and (ii) explore the role of machine learning(as one approach to ’best prediction’) in causal inference. Causal inference methods covered include propensity scores, inverse probability of treatment weights (IPTWs), G computation and targeted maximum likelihood estimation (TMLE). Machine learning has been used more for propensity scores and TMLE, and there is potential for increased use in G computation and estimation of IPTWs.;,citation_author=Tony Blakely;,citation_author=John Lynch;,citation_author=Koen Simons;,citation_author=Rebecca Bentley;,citation_author=Sherri Rose;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_issue=6;,citation_doi=10.1093/ije/dyz132;,citation_issn=14643685;,citation_pmid=31298274;,citation_volume=49;,citation_journal_title=International Journal of Epidemiology;">
<meta name="citation_reference" content="citation_title=A tutorial on propensity score estimation for multiple treatments using generalized boosted models;,citation_abstract=The use of propensity scores to control for pretreatment imbalances on observed variables in non-randomized or observational studies examining the causal effects of treatments or interventions has become widespread over the past decade. For settings with two conditions of interest such as a treatment and a control, inverse probability of treatment weighted estimation with propensity scores estimated via boosted models has been shown in simulation studies to yield causal effect estimates with desirable properties. There are tools (e.g., the twang package in R) and guidance for implementing this method with two treatments. However, there is not such guidance for analyses of three or more treatments. The goals of this paper are twofold: (1) to provide step-by-step guidance for researchers who want to implement propensity score weighting for multiple treatments and (2) to propose the use of generalized boosted models (GBM) for estimation of the necessary propensity score weights. We define the causal quantities that may be of interest to studies of multiple treatments and derive weighted estimators of those quantities. We present a detailed plan for using GBM to estimate propensity scores and using those scores to estimate weights and causal effects. We also provide tools for assessing balance and overlap of pretreatment variables among treatment groups in the context of multiple treatments. A case study examining the effects of three treatment programs for adolescent substance abuse demonstrates the methods.  2013 John Wiley &amp;amp;amp; Sons, Ltd.;,citation_author=Daniel F. Mccaffrey;,citation_author=Beth Ann Griffin;,citation_author=Daniel Almirall;,citation_author=Mary Ellen Slaughter;,citation_author=Rajeev Ramchand;,citation_author=Lane F. Burgette;,citation_publication_date=2013;,citation_cover_date=2013;,citation_year=2013;,citation_issue=19;,citation_doi=10.1002/sim.5753;,citation_issn=02776715;,citation_pmid=23508673;,citation_volume=32;,citation_journal_title=Statistics in Medicine;">
<meta name="citation_reference" content="citation_title=Group Average Treatment Effects for Observational Studies;,citation_abstract=The paper proposes an estimator to make inference of heterogeneous treatment effects sorted by impact groups (GATES) for non-randomised experiments. The groups can be understood as a broader aggregation of the conditional average treatment effect (CATE) where the number of groups is set in advance. In economics, this approach is similar to pre-analysis plans. Observational studies are standard in policy evaluation from labour markets, educational surveys and other empirical studies. To control for a potential selection-bias, we implement a doubly-robust estimator in the first stage. We use machine learning methods to learn the conditional mean functions as well as the propensity score. The group average treatment effect is then estimated via a linear projection model. The linear model is easy to interpret, provides p-values and confidence intervals, and limits the danger of finding spurious heterogeneity due to small subgroups in the CATE. To control for confounding in the linear model, we use Neyman-orthogonal moments to partial out the effect that covariates have on both, the treatment assignment and the outcome. The result is a best linear predictor for effect heterogeneity based on impact groups. We find that our proposed method has lower absolute errors as well as smaller bias than the benchmark doubly-robust estimator. We further introduce a bagging type averaging for the CATE function for each observation to avoid biases through sample splitting. The advantage of the proposed method is a robust linear estimation of heterogeneous group treatment effects in observational studies.;,citation_author=Daniel Jacob;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_fulltext_html_url=http://arxiv.org/abs/1911.02688;">
<meta name="citation_reference" content="citation_title=Recursive partitioning for heterogeneous causal effects;,citation_abstract=In this paper we propose methods for estimating heterogeneity in causal effects in experimental and observational studies and for conducting hypothesis tests about the magnitude of differences in treatment effects across subsets of the population. We provide a data-driven approach to partition the data into subpopulations that differ in the magnitude of their treatment effects. The approach enables the construction of valid confidence intervals for treatment effects, even with many covariates relative to the sample size, and without &amp;amp;amp;quot;sparsity&amp;quot; assumptions. We propose an &quot;honest&quot; approach to estimation, whereby one sample is used to construct the partition and another to estimate treatment effects for each subpopulation. Our approach builds on regression tree methods, modified to optimize for goodness of fit in treatment effects and to account for honest estimation. Our model selection criterion anticipates that bias will be eliminated by honest estimation and also accounts for the effect of making additional splits on the variance of treatment effect estimates within each subpopulation. We address the challenge that the &quot;ground truth&quot; for a causal effect is not observed for any individual unit, so that standard approaches to cross-validation must be modified. Through a simulation study, we show that for our preferred method honest estimation results in nominal coverage for 90% confidence intervals, whereas coverage ranges between 74% and 84% for nonhonest approaches. Honest estimation requires estimating the model with a smaller sample size; the cost in terms of mean squared error of treatment effects for our preferred method ranges between 7-22%.;,citation_author=Susan Athey;,citation_author=Guido Imbens;,citation_publication_date=2016;,citation_cover_date=2016;,citation_year=2016;,citation_fulltext_html_url=https://arxiv.org/abs/1504.01132;,citation_issue=27;,citation_doi=10.1073/pnas.1510489113;,citation_issn=10916490;,citation_pmid=27382149;,citation_volume=113;,citation_journal_title=Proceedings of the National Academy of Sciences of the United States of America;">
<meta name="citation_reference" content="citation_title=RFRSF: Employee Turnover Prediction Based on Random Forests and Survival Analysis;,citation_abstract=In human resource management, employee turnover problem is heavily concerned by managers since the leave of key employees can bring great loss to the company. However, most existing researches are employee-centered, which ignored the historical events of turnover behaviors or the longitudinal data of job records. In this paper, from an event-centered perspective, we design a hybrid model based on survival analysis and machine learning, and propose a turnover prediction algorithm named RFRSF, which combines survival analysis for censored data processing and ensemble learning for turnover behavior prediction. In addition, we take strategies to handle employees with multiple turnover records so as to construct survival data with censored records. We compare RFRSF with several baseline methods on a real dataset crawled from one of the biggest online professional social platforms of China. The results show that the survival analysis model can significantly benefit the employee turnover prediction performance.;,citation_author=Ziwei Jin;,citation_author=Jiaxing Shang;,citation_author=Qianwen Zhu;,citation_author=Chen Ling;,citation_author=Wu Xie;,citation_author=Baohua Qiang;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_doi=10.1007/978-3-030-62008-0_35;,citation_isbn=9783030620073;,citation_issn=16113349;,citation_volume=12343 LNCS;,citation_journal_title=Lecture Notes in Computer Science (including subseries Lecture Notes in Artificial Intelligence and Lecture Notes in Bioinformatics);">
<meta name="citation_reference" content="citation_title=Propensity score estimation with boosted regression for evaluating causal effects in observational studies;,citation_abstract=Causal effect modeling with naturalistic rather than experimental data is challenging. In observational studies participants in different treatment conditions may also differ on pre-treatment characteristics that influence outcomes. Propensity score methods can theoretically eliminate these confounds for all observed covariates, but accurate estimation of propensity scores is impeded by large numbers of covariates, uncertain functional forms for their associations with treatment selection, and other problems. This article demonstrates that boosting, a modern statistical technique, can overcome many of these obstacles. The authors illustrate this approach with a study of adolescent probationers in substance abuse treatment programs. Propensity score weights estimated using boosting eliminate most pretreatment group differences and substantially alter the apparent relative effects of adolescent substance abuse treatment.;,citation_author=Daniel F. McCaffrey;,citation_author=Greg Ridgeway;,citation_author=Andrew R. Morral;,citation_publication_date=2004;,citation_cover_date=2004;,citation_year=2004;,citation_issue=4;,citation_doi=10.1037/1082-989X.9.4.403;,citation_issn=1082989X;,citation_pmid=15598095;,citation_volume=9;,citation_journal_title=Psychological Methods;">
<meta name="citation_reference" content="citation_title=Bagging predictors;,citation_author=Leo Breiman;,citation_publication_date=1996;,citation_cover_date=1996;,citation_year=1996;,citation_doi=10.3390/risks8030083;,citation_issn=22279091;,citation_volume=24;,citation_journal_title=Machine Learning;">
<meta name="citation_reference" content="citation_title=Estimation and Inference of Heterogeneous Treatment Effects using Random Forests;,citation_abstract=Many scientific and engineering challenges—ranging from personalized medicine to customized marketing recommendations—require an understanding of treatment effect heterogeneity. In this article, we develop a nonparametric causal forest for estimating heterogeneous treatment effects that extends Breiman’s widely used random forest algorithm. In the potential outcomes framework with unconfoundedness, we show that causal forests are pointwise consistent for the true treatment effect and have an asymptotically Gaussian and centered sampling distribution. We also discuss a practical method for constructing asymptotic confidence intervals for the true treatment effect that are centered at the causal forest estimates. Our theoretical results rely on a generic Gaussian theory for a large family of random forest algorithms. To our knowledge, this is the first set of results that allows any type of random forest, including classification and regression forests, to be used for provably valid statistical inference. In experiments, we find causal forests to be substantially more powerful than classical methods based on nearest-neighbor matching, especially in the presence of irrelevant covariates.;,citation_author=Stefan Wager;,citation_author=Susan Athey;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_fulltext_html_url=https://doi.org/10.1080/01621459.2017.1319839;,citation_issue=523;,citation_doi=10.1080/01621459.2017.1319839;,citation_issn=1537274X;,citation_volume=113;,citation_journal_title=Journal of the American Statistical Association;,citation_publisher=Taylor &amp;amp;amp; Francis;">
<meta name="citation_reference" content="citation_title=The contribution of wildfire to PM2.5 trends in the USA;,citation_abstract=Steady improvements in ambient air quality in the USA over the past several decades, in part a result of public policy1,2, have led to public health benefits1–4. However, recent trends in ambient&nbsp;concentrations of&nbsp;particulate matter with diameters less than 2.5 $\mu$m (PM2.5), a pollutant regulated under the Clean Air Act1, have stagnated or begun to reverse throughout much of the USA5. Here we use a combination of ground- and satellite-based air pollution data from 2000 to 2022 to quantify the contribution of wildfire smoke to these PM2.5 trends. We find that since at least 2016, wildfire smoke has influenced trends in average annual PM2.5 concentrations in nearly three-quarters of states in the contiguous USA, eroding about 25% of previous multi-decadal progress in reducing PM2.5 concentrations on average in those states, equivalent to 4 years of air quality progress, and more than 50% in many western states. Smoke influence on trends in the number of days with extreme PM2.5 concentrations is detectable by 2011, but the influence can be detected primarily in western and mid-western states. Wildfire-driven increases in ambient PM2.5 concentrations are unregulated under current air pollution law6 and, in the absence of further interventions, we show that the contribution&nbsp;of wildfire to regional and national air quality trends is likely to grow as the climate continues to warm.;,citation_author=Marshall Burke;,citation_author=Marissa L. Childs;,citation_author=Brandon Cuesta;,citation_author=Minghao Qiu;,citation_author=Jessica Li;,citation_author=Carlos F. Gould;,citation_author=Sam Heft-Neal;,citation_author=Michael Wara;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_issue=7984;,citation_doi=10.1038/s41586-023-06522-6;,citation_issn=14764687;,citation_pmid=37730996;,citation_volume=622;,citation_journal_title=Nature;,citation_publisher=Springer US;">
<meta name="citation_reference" content="citation_title=Marginal structural models in clinical research: When and how to use them?;,citation_abstract=Marginal structural models are a multi-step estimation procedure designed to control for the effect of confounding variables that change over time, and are affected by previous treatment. When a time-varying confounder is affected by prior treatment standard methods for confounding control are inappropriate, because over time the covariate plays both the role of confounder and mediator of the effect of treatment on outcome. Marginal structural models first calculate a weight to assign to each observation. These weights reflect the extent to which observations with certain characteristics (covariate values) are under-represented or over-represented in the sample with the respect to a target population in which these characteristics are balanced across treatment groups. Then, marginal structural models estimate the outcome of interest taking into account these weights. Marginal structural models are a powerful method for confounding control in longitudinal study designs that collect time-varying information on exposure, outcome and other covariates.;,citation_author=Tyler Williamson;,citation_author=Pietro Ravani;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_issue=February;,citation_doi=10.1093/ndt/gfw341;,citation_issn=14602385;,citation_pmid=28201767;,citation_volume=32;,citation_journal_title=Nephrology Dialysis Transplantation;">
<meta name="citation_reference" content="citation_title=Optimizing variance-bias trade-off in the TWANG package for estimation of propensity scores;,citation_abstract=While propensity score weighting has been shown to reduce bias in treatment effect estimation when selection bias is present, it has also been shown that such weighting can perform poorly if the estimated propensity score weights are highly variable. Various approaches have been proposed which can reduce the variability of the weights and the risk of poor performance, particularly those based on machine learning methods. In this study, we closely examine approaches to fine-tune one machine learning technique [generalized boosted models (GBM)] to select propensity scores that seek to optimize the variance-bias trade-off that is inherent in most propensity score analyses. Specifically, we propose and evaluate three approaches for selecting the optimal number of trees for the GBM in the twang package in R. Normally, the twang package in R iteratively selects the optimal number of trees as that which maximizes balance between the treatment groups being considered. Because the selected number of trees may lead to highly variable propensity score weights, we examine alternative ways to tune the number of trees used in the estimation of propensity score weights such that we sacrifice some balance on the pre-treatment covariates in exchange for less variable weights. We use simulation studies to illustrate these methods and to describe the potential advantages and disadvantages of each method. We apply these methods to two case studies: one examining the effect of dog ownership on the owner’s general health using data from a large, population-based survey in California, and a second investigating the relationship between abstinence and a long-term economic outcome among a sample of high-risk youth.;,citation_author=Layla Parast;,citation_author=Daniel F. McCaffrey;,citation_author=Lane F. Burgette;,citation_author=Fernando Hoces Guardia;,citation_author=Daniela Golinelli;,citation_author=Jeremy N. V. Miles;,citation_author=Beth Ann Griffin;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_issue=3-4;,citation_doi=10.1007/s10742-016-0168-2;,citation_issn=15729400;,citation_volume=17;,citation_journal_title=Health Services and Outcomes Research Methodology;,citation_publisher=Springer US;">
<meta name="citation_reference" content="citation_title=We are all social scientists now: How big data, machine learning, and causal inference work together;,citation_author=Justin Grimmer;,citation_publication_date=2015;,citation_cover_date=2015;,citation_year=2015;,citation_issue=1;,citation_doi=10.1017/S1049096514001784;,citation_issn=15375935;,citation_volume=48;,citation_journal_title=American Political Science Association;">
<meta name="citation_reference" content="citation_title=Recent developments in the econometrics of program evaluation;,citation_abstract=Many empirical questions in economics and other social sciences depend on causal effects of programs or policies. In the last two decades, much research has been done on the econometric and statistical analysis of such causal effects. This recent theoretical literature has built on, and combined features of earlier work in both the statistics and econometrics literatures. It has by now reached a level of maturity that makes it an important tool in many areas of empirical research in economics, including labor economics, public finance, development economics, industrial organization, and other areas of empirical microeconomics. In this review, we discuss some of the recent developments. We focus primarily on practical issues for empirical researchers, as well as provide a historical overview of the area and give references to more technical research.;,citation_author=Guido W. Imbens;,citation_author=Jeffrey M. Wooldridge;,citation_publication_date=2009;,citation_cover_date=2009;,citation_year=2009;,citation_issue=1;,citation_doi=10.1257/jel.47.1.5;,citation_issn=00220515;,citation_volume=47;,citation_journal_title=Journal of Economic Literature;">
<meta name="citation_reference" content="citation_title=Agricultural extension and technology adoption for food security: Evidence from Uganda;,citation_abstract=We evaluate causal impacts of a large-scale agricultural extension program for smallholder women farmers on technology adoption and food security in Uganda through a regression discontinuity design that exploits an arbitrary distance-to-branch threshold for village program eligibility. We find eligible farmers used better basic cultivation methods, achieved improved food security. Given minimal changes in adoption of relatively expensive inputs, we attribute these gains to improved cultivation methods that require low upfront monetary investment. Farmers also modified their shockcoping methods. These results highlight the role of information and training in boosting agricultural productivity among poor farmers and, indirectly, improving food security.;,citation_author=Yao Pan;,citation_author=Stephen C. Smith;,citation_author=Munshi Sulaiman;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_issue=4;,citation_doi=10.1093/ajae/aay012;,citation_issn=14678276;,citation_volume=100;,citation_journal_title=American Journal of Agricultural Economics;">
<meta name="citation_reference" content="citation_title=Practical Guide to Honest Causal Forests for Identifying Heterogeneous Treatment Effects;,citation_abstract=&amp;amp;amp;quot;Heterogeneous treatment effects&amp;quot;is a term which refers to conditional average treatment effects (i.e., CATEs) that vary across population subgroups. Epidemiologists are often interested in estimating such effects because they can help detect populations that may particularly benefit from or be harmed by a treatment. However, standard regression approaches for estimating heterogeneous effects are limited by preexisting hypotheses, test a single effect modifier at a time, and are subject to the multiple-comparisons problem. In this article, we aim to offer a practical guide to honest causal forests, an ensemble tree-based learning method which can discover as well as estimate heterogeneous treatment effects using a data-driven approach. We discuss the fundamentals of tree-based methods, describe how honest causal forests can identify and estimate heterogeneous effects, and demonstrate an implementation of this method using simulated data. Our implementation highlights the steps required to simulate data sets, build honest causal forests, and assess model performance across a variety of simulation scenarios. Overall, this paper is intended for epidemiologists and other population health researchers who lack an extensive background in machine learning yet are interested in utilizing an emerging method for identifying and estimating heterogeneous treatment effects.;,citation_author=Neal Jawadekar;,citation_author=Katrina Kezios;,citation_author=Michelle C. Odden;,citation_author=Jeanette A. Stingone;,citation_author=Sebastian Calonico;,citation_author=Kara Rudolph;,citation_author=Adina Zeki Al Hazzouri;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_issue=7;,citation_doi=10.1093/aje/kwad043;,citation_issn=14766256;,citation_pmid=36843042;,citation_volume=192;,citation_journal_title=American Journal of Epidemiology;">
<meta name="citation_reference" content="citation_title=Does the estimation of the propensity score by machine learning improve matching estimation? The case of Germany’s programmes for long term unemployed;,citation_abstract=Matching-type estimators using the propensity score are the major workhorse in active labour market policy evaluation. This work investigates if machine learning algorithms for estimating the propensity score lead to more credible estimation of average treatment effects on the treated using a radius matching framework. Considering two popular methods, the results are ambiguous: We find that using LASSO based logit models to estimate the propensity score delivers more credible results than conventional methods in small and medium sized high dimensional datasets. However, the usage of Random Forests to estimate the propensity score may lead to a deterioration of the performance in situations with a low treatment share. The application reveals a positive effect of the training programme on days in employment for long-term unemployed. While the choice of the “first stage” is highly relevant for settings with low number of observations and few treated, machine learning and conventional estimation becomes more similar in larger samples and higher treatment shares.;,citation_author=Daniel Goller;,citation_author=Michael Lechner;,citation_author=Andreas Moczall;,citation_author=Joachim Wolff;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_issue=March;,citation_doi=10.1016/j.labeco.2020.101855;,citation_issn=09275371;,citation_volume=65;,citation_journal_title=Labour Economics;,citation_publisher=Elsevier B.V.;">
<meta name="citation_reference" content="citation_title=Machine Learning Methods Economists Should Know Athey and Imbens 2019;,citation_abstract=We discuss the relevance of the recent Machine Learning (ML) literature for eco- nomics and econometrics. First we discuss the differences in goals, methods and settings between the ML literature and the traditional econometrics and statistics literatures. Then we discuss some specific methods from the machine learning literature that we view as important for empirical researchers in economics. These include supervised learning methods for regression and classification, unsupervised learning methods, as well as matrix completion methods. Finally, we highlight newly developed methods at the intersection of ML and econometrics, methods that typically perform better than either off-the-shelf ML or more traditional econometric methods when applied to particular classes of problems, problems that include causal inference for average treat- ment effects, optimal policy estimation, and estimation of the counterfactual effect of price changes in consumer choice models.;,citation_author=Susan Athey;,citation_author=Guido W Imbens;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_fulltext_html_url=https://www.annualreviews.org/content/journals/10.1146/annurev-economics-080217-053433;,citation_doi=10.1146/annurev-economics-080217-053433;,citation_volume=11;,citation_journal_title=Annual Review of Economics;">
<meta name="citation_reference" content="citation_title=Estimating Causal Effects of Treatments in Experimental and Observational Studies;,citation_abstract=A discussion of matching, randomization, random sampling, and other methods of controlling extraneous variation is presented. The objective is to specify the benefits of randomization in estimating causal effects of treatments. The basic conclusion is that randomization should be employed whenever possible, but the use of carefully controlled nonrandomized data to estimate causal effects is a reasonable and necessary procedure in many cases.;,citation_author=Donald B. Rubin;,citation_publication_date=1974;,citation_cover_date=1974;,citation_year=1974;,citation_issue=5;,citation_doi=10.1002/j.2333-8504.1972.tb00631.x;,citation_issn=0424-6144;,citation_volume=66;,citation_journal_title=Journal of Educational Psychology;">
<meta name="citation_reference" content="citation_title=TDS: Heterogeneous Treatment Effect and Meta Learners;,citation_author=Zain Ahmed;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;">
<meta name="citation_reference" content="citation_title=An experiment in cotwin control: Adaptation to space travel;,citation_abstract=Monozygotic (MZ) twins who experience different environmental exposures offer an informative, naturally occurring cotwin control design. Given their genetic identity, differences in their physical, medical, and behavioral outcomes can be linked to their experiential differences. In space research, a broad range of ethological studies has been conducted on the effects of microgravity on sensorimotor activity, as well as on social group behavior during orbital flights, in a large array of isolated and confined environments, both for short-term, mid-term, and long-term missions. The study of MZ twin astronaut Scott Kelly, who spent almost 1-year at the International Space Station, while his cotwin Mark Kelly stayed on earth, is a unique opportunity to identify factors affecting astronauts’ health. This experiment of nature can also reveal the extent to which a space mission modifies different adaptive systems at the genetic and epigenetic levels.;,citation_author=Carole Tafforin;,citation_author=Nancy L. Segal;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://www.sciencedirect.com/book/9780128215142/twin-research-for-everyone?via=ihub=;,citation_doi=https://doi.org/10.1016/C2019-0-02208-X;,citation_isbn=9780128215159;,citation_inbook_title=Twin research for everyone;">
<meta name="citation_reference" content="citation_title=Why Propensity Scores Should Not Be Used for Matching;,citation_abstract=We show that propensity score matching (PSM), an enormously popular method of preprocessing data for causal inference, often accomplishes the opposite of its intended goal - thus increasing imbalance, inefficiency, model dependence, and bias. The weakness of PSM comes from its attempts to approximate a completely randomized experiment, rather than, as with other matching methods, a more efficient fully blocked randomized experiment. PSM is thus uniquely blind to the often large portion of imbalance that can be eliminated by approximating full blocking with other matching methods. Moreover, in data balanced enough to approximate complete randomization, either to begin with or after pruning some observations, PSM approximates random matching which, we show, increases imbalance even relative to the original data. Although these results suggest researchers replace PSM with one of the other available matching methods, propensity scores have other productive uses.;,citation_author=Gary King;,citation_author=Richard Nielsen;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_issue=4;,citation_doi=10.1017/pan.2019.11;,citation_issn=14764989;,citation_volume=27;,citation_journal_title=Political Analysis;">
<meta name="citation_reference" content="citation_title=Using synthetic controls: Feasibility, data requirements, and methodological aspects;,citation_abstract=Probably because of their interpretability and transparent nature, synthetic controls have become widely applied in empirical research in economics and the social sciences. This article aims to provide practical guidance to researchers employing synthetic control methods. The article starts with an overview and an introduction to synthetic control estimation. The main sections discuss the advantages of the synthetic control framework as a research design, and describe the settings where synthetic controls provide reliable estimates and those where they may fail. The article closes with a discussion of recent extensions, related methods, and avenues for future research.;,citation_author=Alberto Abadie;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_issue=2;,citation_doi=10.1257/jel.20191450;,citation_issn=00220515;,citation_volume=59;,citation_journal_title=Journal of Economic Literature;">
<meta name="citation_reference" content="citation_title=R: A language and environment for statistical computing;,citation_author=R Core Team;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://www.R-project.org/;">
<meta name="citation_reference" content="citation_title=causaldata: Example data sets for causal inference textbooks;,citation_author=Nick Huntington-Klein;,citation_author=Malcolm Barrett;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_fulltext_html_url=https://CRAN.R-project.org/package=causaldata;">
<meta name="citation_reference" content="citation_title=cobalt: Covariate balance tables and plots;,citation_author=Noah Greifer;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://CRAN.R-project.org/package=cobalt;">
<meta name="citation_reference" content="citation_title=data.table: Extension of “data.frame”;,citation_author=Tyson Barrett;,citation_author=Matt Dowle;,citation_author=Arun Srinivasan;,citation_author=Jan Gorecki;,citation_author=Michael Chirico;,citation_author=Toby Hocking;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://CRAN.R-project.org/package=data.table;">
<meta name="citation_reference" content="citation_title=gbm: Generalized boosted regression models;,citation_author=Greg Ridgeway;,citation_author=GBM Developers;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://CRAN.R-project.org/package=gbm;">
<meta name="citation_reference" content="citation_title=kableExtra: Construct complex table with “kable” and pipe syntax;,citation_author=Hao Zhu;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://CRAN.R-project.org/package=kableExtra;">
<meta name="citation_reference" content="citation_title=knitr: A general-purpose package for dynamic report generation in r;,citation_author=Yihui Xie;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://yihui.org/knitr/;">
<meta name="citation_reference" content="citation_title=Dynamic documents with R and knitr;,citation_author=Yihui Xie;,citation_publication_date=2015;,citation_cover_date=2015;,citation_year=2015;,citation_fulltext_html_url=https://yihui.org/knitr/;">
<meta name="citation_reference" content="citation_title=knitr: A comprehensive tool for reproducible research in R;,citation_author=Yihui Xie;,citation_editor=Victoria Stodden;,citation_editor=Friedrich Leisch;,citation_editor=Roger D. Peng;,citation_publication_date=2014;,citation_cover_date=2014;,citation_year=2014;,citation_inbook_title=Implementing reproducible computational research;">
<meta name="citation_reference" content="citation_title=How to interpret statistical models using marginaleffects in R and Python;,citation_author=Vincent Arel-Bundock;,citation_author=Noah Greifer;,citation_author=Andrew Heiss;,citation_journal_title=Journal of Statistical Software;">
<meta name="citation_reference" content="citation_title=MatchIt: Nonparametric preprocessing for parametric causal inference;,citation_author=Daniel E. Ho;,citation_author=Kosuke Imai;,citation_author=Gary King;,citation_author=Elizabeth A. Stuart;,citation_publication_date=2011;,citation_cover_date=2011;,citation_year=2011;,citation_issue=8;,citation_doi=10.18637/jss.v042.i08;,citation_volume=42;,citation_journal_title=Journal of Statistical Software;">
<meta name="citation_reference" content="citation_title=patchwork: The composer of plots;,citation_author=Thomas Lin Pedersen;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://CRAN.R-project.org/package=patchwork;">
<meta name="citation_reference" content="citation_title=Classification and regression by randomForest;,citation_author=Andy Liaw;,citation_author=Matthew Wiener;,citation_publication_date=2002;,citation_cover_date=2002;,citation_year=2002;,citation_fulltext_html_url=https://CRAN.R-project.org/doc/Rnews/;,citation_issue=3;,citation_volume=2;,citation_journal_title=R News;">
<meta name="citation_reference" content="citation_title=renv: Project environments;,citation_author=Kevin Ushey;,citation_author=Hadley Wickham;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://CRAN.R-project.org/package=renv;">
<meta name="citation_reference" content="citation_title=rmarkdown: Dynamic documents for r;,citation_author=JJ Allaire;,citation_author=Yihui Xie;,citation_author=Christophe Dervieux;,citation_author=Jonathan McPherson;,citation_author=Javier Luraschi;,citation_author=Kevin Ushey;,citation_author=Aron Atkins;,citation_author=Hadley Wickham;,citation_author=Joe Cheng;,citation_author=Winston Chang;,citation_author=Richard Iannone;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://github.com/rstudio/rmarkdown;">
<meta name="citation_reference" content="citation_title=R markdown: The definitive guide;,citation_author=Yihui Xie;,citation_author=J. J. Allaire;,citation_author=Garrett Grolemund;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_fulltext_html_url=https://bookdown.org/yihui/rmarkdown;,citation_isbn=9781138359338;">
<meta name="citation_reference" content="citation_title=R markdown cookbook;,citation_author=Yihui Xie;,citation_author=Christophe Dervieux;,citation_author=Emily Riederer;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_fulltext_html_url=https://bookdown.org/yihui/rmarkdown-cookbook;,citation_isbn=9780367563837;">
<meta name="citation_reference" content="citation_title=showtext: Using fonts more easily in r graphs;,citation_author=Yixuan Qiu;,citation_author=undefined See file AUTHORS for details.;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://CRAN.R-project.org/package=showtext;">
<meta name="citation_reference" content="citation_title=WeightIt: Weighting for covariate balance in observational studies;,citation_author=Noah Greifer;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://CRAN.R-project.org/package=WeightIt;">
<meta name="citation_reference" content="citation_title=Welcome to the tidyverse;,citation_author=Hadley Wickham;,citation_author=Mara Averick;,citation_author=Jennifer Bryan;,citation_author=Winston Chang;,citation_author=Lucy D’Agostino McGowan;,citation_author=Romain François;,citation_author=Garrett Grolemund;,citation_author=Alex Hayes;,citation_author=Lionel Henry;,citation_author=Jim Hester;,citation_author=Max Kuhn;,citation_author=Thomas Lin Pedersen;,citation_author=Evan Miller;,citation_author=Stephan Milton Bache;,citation_author=Kirill Müller;,citation_author=Jeroen Ooms;,citation_author=David Robinson;,citation_author=Dana Paige Seidel;,citation_author=Vitalie Spinu;,citation_author=Kohske Takahashi;,citation_author=Davis Vaughan;,citation_author=Claus Wilke;,citation_author=Kara Woo;,citation_author=Hiroaki Yutani;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_issue=43;,citation_doi=10.21105/joss.01686;,citation_volume=4;,citation_journal_title=Journal of Open Source Software;">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/coffee_replication.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Replication Case Study</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Machine Learning and the Propensity Score</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/mitchellcameron123/ML-PS.git" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="../Machine-Learning-and-the-Propensity-Score.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
    <a href="https://www.facebook.com/sharer/sharer.php?u=|url|" title="Facebook" class="quarto-navigation-tool px-1" aria-label="Facebook"><i class="bi bi-facebook"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/intro_background.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction and Background</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/pscore_theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Propensity Scores and Machine Learning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/implimentation_workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Tutorial: Implimentation, Workflow, and Example with <code>WeightIt</code> and<code>gbm</code> in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/coffee_replication.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Replication Case Study</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Conclusion and Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/appendix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Appendix</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#replication-of-original-results" id="toc-replication-of-original-results" class="nav-link active" data-scroll-target="#replication-of-original-results"><span class="header-section-number">4.1</span> Replication of Original Results</a></li>
  <li><a href="#further-modelling" id="toc-further-modelling" class="nav-link" data-scroll-target="#further-modelling"><span class="header-section-number">4.2</span> Further Modelling</a></li>
  <li><a href="#comparison-of-methods" id="toc-comparison-of-methods" class="nav-link" data-scroll-target="#comparison-of-methods"><span class="header-section-number">4.3</span> Comparison of Methods</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results"><span class="header-section-number">4.4</span> Results</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/mitchellcameron123/ML-PS.git/edit/main/chapters/coffee_replication.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Replication Case Study</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>The replication study focuses on a paper titled <em>The Impact of Coffee Certification on Small-Scale Producers’ Livelihoods: A Case Study from the Jimma Zone, Ethiopia</em> published in Agricultural Economics (2012) by Pradyot Ranjan Jena, Bezawit Beyene Chichaibelu, Till Stellmacher, and Ulrike Grote. This paper explores the effects of coffee certification schemes on the economic wellbeing of small-scale coffee farmers in Ethiopia, particularly examining whether these schemes contribute to poverty reduction and improved livelihoods among smallholders.</p>
<p>The central theme of the paper is the evaluation of certification schemes, such as Fairtrade and organic certification, as tools for enhancing the income stability and economic resilience of small-scale coffee producers. Certification is seen as a potential tool for economic growth and and environmental sustainability and so it is important to understand the impact on small-scale farmers. <a href="#tbl-coffee-var-summary" class="quarto-xref">Table&nbsp;<span>4.1</span></a> summarises the variables used in the propensity score model.</p>
<div class="cell">
<details class="code-fold">
<summary>Code: Create <a href="#tbl-coffee-var-summary">Table 4.1</a></summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<details class="code-fold">
<summary>Code: Create <a href="#tbl-coffee-var-summary">Table 4.1</a></summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'kableExtra'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    group_rows</code></pre>
</div>
<details class="code-fold">
<summary>Code: Create <a href="#tbl-coffee-var-summary">Table 4.1</a></summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>coffee_variable_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Name =</span> <span class="fu">c</span>(<span class="st">"Per Capita Income"</span>, <span class="st">"Certification (Treatment/ Control)"</span>, </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Household Age"</span>, <span class="st">"Squared Household Age"</span>, <span class="st">"Gender"</span>, </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Dependency Ratio"</span>, <span class="st">"Education Level"</span>, </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Years of Coffee Production"</span>, </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Log Total Land"</span>, <span class="st">"Access to Credit"</span>, </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Bad Weather"</span>, <span class="st">"Non-farm Income Access"</span>),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Codename =</span> <span class="fu">c</span>(<span class="st">"`percapitaincome_day_maleeq`"</span>, <span class="st">"`certified`"</span>, <span class="st">"`age_hh`"</span>, </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">"`agesq`"</span>, <span class="st">"`gender`"</span>, <span class="st">"`depratio`"</span>, <span class="st">"`edu`"</span>, </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">"`years_cofeproduction`"</span>, <span class="st">"`logtotal_land`"</span>, <span class="st">"`access_credit`"</span>,  </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">"`badweat`"</span>, <span class="st">"`nonfarmincome_access`"</span>),</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">Description =</span> <span class="fu">c</span>(<span class="st">"Average income earned per person within a farming household"</span>, </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"If the farming household is certified (=1) or otherwise (=0)"</span>, </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Age of the head of the household in years"</span>, </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Age of the head of the household squared"</span>, </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Gender of the head of household (male = 1 and female = 0)"</span>, </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Household members below 14 and above 65 years divided by </span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="st">                    rest of the household member"</span>, </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Education of the head of household in years"</span>,</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Years of experience in coffee farming"</span>,</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Logarithm of total land size in hectares"</span>,</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Household has access to credit (yes = 1, otherwise = 0)"</span>,</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"If the household was affected by floods/droughts during the </span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="st">                    last year (2008–2009)"</span>,</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"If the household has access to nonfarm income"</span>)</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(coffee_variable_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-coffee-var-summary" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-coffee-var-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.1: List of covaraites in <span class="citation" data-cites="Jena2012">Jena et al. (<a href="references.html#ref-Jena2012" role="doc-biblioref">2012</a>)</span>. Per capita income is the outcome and certification is the treatment. Other covariates are used in the propensity score model.
</figcaption>
<div aria-describedby="tbl-coffee-var-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 20%">
<col style="width: 17%">
<col style="width: 62%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Codename</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Per Capita Income</td>
<td style="text-align: left;"><code>percapitaincome_day_maleeq</code></td>
<td style="text-align: left;">Average income earned per person within a farming household</td>
</tr>
<tr class="even">
<td style="text-align: left;">Certification (Treatment/ Control)</td>
<td style="text-align: left;"><code>certified</code></td>
<td style="text-align: left;">If the farming household is certified (=1) or otherwise (=0)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Household Age</td>
<td style="text-align: left;"><code>age_hh</code></td>
<td style="text-align: left;">Age of the head of the household in years</td>
</tr>
<tr class="even">
<td style="text-align: left;">Squared Household Age</td>
<td style="text-align: left;"><code>agesq</code></td>
<td style="text-align: left;">Age of the head of the household squared</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Gender</td>
<td style="text-align: left;"><code>gender</code></td>
<td style="text-align: left;">Gender of the head of household (male = 1 and female = 0)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Dependency Ratio</td>
<td style="text-align: left;"><code>depratio</code></td>
<td style="text-align: left;">Household members below 14 and above 65 years divided by</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rest of the household member</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Education Level</td>
<td style="text-align: left;"><code>edu</code></td>
<td style="text-align: left;">Education of the head of household in years</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Years of Coffee Production</td>
<td style="text-align: left;"><code>years_cofeproduction</code></td>
<td style="text-align: left;">Years of experience in coffee farming</td>
</tr>
<tr class="even">
<td style="text-align: left;">Log Total Land</td>
<td style="text-align: left;"><code>logtotal_land</code></td>
<td style="text-align: left;">Logarithm of total land size in hectares</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Access to Credit</td>
<td style="text-align: left;"><code>access_credit</code></td>
<td style="text-align: left;">Household has access to credit (yes = 1, otherwise = 0)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bad Weather</td>
<td style="text-align: left;"><code>badweat</code></td>
<td style="text-align: left;">If the household was affected by floods/droughts during the</td>
</tr>
<tr class="odd">
<td style="text-align: left;">last year (2008–2009)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Non-farm Income Access</td>
<td style="text-align: left;"><code>nonfarmincome_access</code></td>
<td style="text-align: left;">If the household has access to nonfarm income</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<!-- the names start to overlap in the pdf output. fix the pdf sizing  -->
<p><span class="citation" data-cites="Jena2012">Jena et al. (<a href="references.html#ref-Jena2012" role="doc-biblioref">2012</a>)</span> define livelihood as a combination of per capita income, total income, per capita consumption, and yield per hectare. For simplicity, this replication will only use per capita income as a dependent variable. This measure is selected as per capita income is a direct measurement of the income of those potentially impacted by certification. Additionally, the replication uses the same variables as the original paper so any difference in estimates or covariate balance can be attributed to the propensity score model.</p>
<p>Randomisation into certified and uncertified is not possible and it is likely that farmers who seek certification are different than farmers who don’t. Thus, there is selection bias leading to structural differences between groups so a contrast in means between the certified (treated) and uncertified (control) farmers would be biased. Propensity scores are used to create covariate balance and reduce bias of the estimated treatment effect. The paper did not assess the balance of covariates. However, this provides a good opportunity to assess covariate balance in the initial paper and the repeat the analysis using a machine learning propensity model.</p>
<section id="replication-of-original-results" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="replication-of-original-results"><span class="header-section-number">4.1</span> Replication of Original Results</h2>
<p><span class="citation" data-cites="Jena2012">Jena et al. (<a href="references.html#ref-Jena2012" role="doc-biblioref">2012</a>)</span> provides a replication package including Stata code that uses Stata’s psmatch2 package to perform nearest neighbour matching with replacement and common support trimming. Common support trimming means that any observations outside the commonly overlapping are are discarded. The results of the paper are be fully replicated using the <code>MatchIt</code> package inside R.</p>
<div class="cell">
<details class="code-fold">
<summary>Code: Create <a href="#tbl-replicated-result">Table 4.2</a></summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MatchIt)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MatchItSE)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marginaleffects)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>coffee_formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(certified <span class="sc">~</span> age_hh <span class="sc">+</span> agesq <span class="sc">+</span> nonfarmincome_access <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                             depratio <span class="sc">+</span> logtotal_land <span class="sc">+</span> badweat <span class="sc">+</span> edu <span class="sc">+</span> gender <span class="sc">+</span> </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                             years_cofeproduction <span class="sc">+</span> access_credit)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>coffee_rep_pmodel <span class="ot">&lt;-</span> <span class="fu">matchit</span>(coffee_formula, <span class="at">data =</span> coffee_data, </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>                             <span class="at">distance =</span> <span class="st">"glm"</span>, <span class="at">method =</span> <span class="st">"nearest"</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>                             <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">estimand =</span> <span class="st">"ATT"</span>, <span class="at">discard =</span> <span class="st">"both"</span>) </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>coffee_logit_md <span class="ot">&lt;-</span> <span class="fu">match.data</span>(coffee_rep_pmodel)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>coffee_rep_fit<span class="ot">&lt;-</span> <span class="fu">lm</span>(percapitaincome_day_maleeq <span class="sc">~</span> certified,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> coffee_logit_md, <span class="at">weights =</span> weights)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>replicated_result <span class="ot">&lt;-</span> <span class="fu">avg_comparisons</span>(coffee_rep_fit, <span class="at">variables =</span> <span class="st">"certified"</span>,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">vcov =</span> <span class="cn">NULL</span>, </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">newdata =</span> <span class="fu">subset</span>(coffee_logit_md, </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>                                                      certified <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">wts =</span> <span class="st">"weights"</span>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>ai_se <span class="ot">&lt;-</span> <span class="fu">abadie_imbens_se</span>(<span class="at">obj =</span> coffee_rep_pmodel, </span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Y =</span> coffee_data<span class="sc">$</span>percapitaincome_day_maleeq)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>replicated_result_tbl <span class="ot">&lt;-</span> <span class="fu">extract_comparison_results</span>(replicated_result)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>replicated_result_tbl<span class="sc">$</span>SE <span class="ot">&lt;-</span> ai_se</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(replicated_result_tbl) <span class="ot">&lt;-</span> <span class="st">"Replicated Result"</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(replicated_result_tbl, <span class="at">digits =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-replicated-result" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-replicated-result-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.2: Replication of results in <span class="citation" data-cites="Jena2012">Jena et al. (<a href="references.html#ref-Jena2012" role="doc-biblioref">2012</a>)</span>. Note a slight difference in standard error which should be <span class="math inline">\(1.1\)</span> as the <code>MatchItSE</code> package uses a trivially different method than psmatch2 in Stata <span class="citation" data-cites="Abadie2006">(see <a href="references.html#ref-Abadie2006" role="doc-biblioref">Abadie and Imbens 2006</a>)</span>. Matching is performed by <code>matchit()</code> from the <code>MatchIt</code> package.
</figcaption>
<div aria-describedby="tbl-replicated-result-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Estimate</th>
<th style="text-align: right;">SE</th>
<th style="text-align: right;">P.Value</th>
<th style="text-align: right;">Lower.CI</th>
<th style="text-align: right;">Upper.CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Replicated Result</td>
<td style="text-align: right;">-0.1538</td>
<td style="text-align: right;">0.9898</td>
<td style="text-align: right;">0.835</td>
<td style="text-align: right;">-1.6009</td>
<td style="text-align: right;">1.2934</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p><a href="#tbl-replicated-result" class="quarto-xref">Table&nbsp;<span>4.2</span></a> shows the replicated result obtained by <span class="citation" data-cites="Jena2012">Jena et al. (<a href="references.html#ref-Jena2012" role="doc-biblioref">2012</a>)</span>. The intriguing finding of the paper is that the average treatment effect on the treated (ATT) is negative. That is, of the farmers that become certified, their per capita income is expected to decrease by <span class="math inline">\(\$0.15\)</span> per day. Intuition and proponents of certification schemes suggest that certification leads to an increase of income. If certification negatively impacts income, it would call into question a significant effort to engage in certification and fair trade practices.</p>
<p><span class="citation" data-cites="Jena2012">Jena et al. (<a href="references.html#ref-Jena2012" role="doc-biblioref">2012</a>)</span> does not perform any discussion or consideration of balance in their paper and so it is unclear if propensity score matching results in covariate balance. The <code>cobalt</code> package creates balance tables using <code>bal.tab()</code> and a visualisation using <code>love.plot()</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code: Create <a href="#tbl-coffee-balance">Table 4.3</a></summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cobalt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code> cobalt (Version 4.5.5, Build Date: 2024-04-02)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'cobalt'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:MatchIt':

    lalonde</code></pre>
</div>
<details class="code-fold">
<summary>Code: Create <a href="#tbl-coffee-balance">Table 4.3</a></summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>coffee_rep_btab <span class="ot">&lt;-</span> <span class="fu">bal.tab</span>(coffee_rep_pmodel, </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> coffee_data, </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">stats =</span> <span class="fu">c</span>(<span class="st">"mean.diffs"</span>,<span class="st">"variance.ratios"</span>),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">binary =</span> <span class="st">"std"</span>, <span class="at">continuous =</span> <span class="st">"std"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">thresholds =</span> <span class="fu">c</span>(<span class="at">mean.diffs =</span> <span class="fl">0.1</span>),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">s.d.denom =</span> <span class="st">"treated"</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>coffee_rep_btab_ss <span class="ot">&lt;-</span> coffee_rep_btab<span class="sc">$</span>Observations</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>coffee_rep_btab <span class="ot">&lt;-</span> coffee_rep_btab<span class="sc">$</span>Balance[<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>)]</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>rowlabels <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Household Age"</span>, <span class="st">"Squared Household Age"</span>, <span class="st">"Non-farm Income Access"</span>, </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Log Total Land"</span>, <span class="st">"Dependency Ratio"</span>, <span class="st">"Bad Weather"</span>,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Education Level"</span>, <span class="st">"Gender"</span>, <span class="st">"Years of Coffee Production"</span>, </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Access to Credit"</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>colnames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Variable"</span>,<span class="st">"Type"</span>, <span class="st">"SMD"</span>, <span class="st">"Balance Threshold"</span>, <span class="st">"Variance Ratio"</span>)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(coffee_rep_btab) <span class="ot">&lt;-</span> rowlabels</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>coffee_rep_btab[,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>          coffee_rep_btab[,<span class="dv">3</span>] <span class="sc">&gt;=</span> <span class="st">"Not Balanced, &gt;0.1"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(coffee_rep_btab, <span class="at">digits =</span> <span class="dv">4</span>, <span class="at">align =</span> <span class="st">"c"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-coffee-balance" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-coffee-balance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.3: The standardised mean difference (SMD) for each covariate in <span class="citation" data-cites="Jena2012">Jena et al. (<a href="references.html#ref-Jena2012" role="doc-biblioref">2012</a>)</span> using a logistic regression propensity model and propensity score matching. Across each of the covariates, a balance threshold is set at <span class="math inline">\(0.1\)</span> to indicate if a covariate is balanced. Binary and continuous variables are both standardised over the treatment group. SMDs are computed using <code>bal.tab()</code> from the <code>cobalt</code> package.
</figcaption>
<div aria-describedby="tbl-coffee-balance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 37%">
<col style="width: 12%">
<col style="width: 13%">
<col style="width: 18%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Type</th>
<th style="text-align: center;">Diff.Adj</th>
<th style="text-align: center;">M.Threshold</th>
<th style="text-align: center;">V.Ratio.Adj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Household Age</td>
<td style="text-align: center;">Contin.</td>
<td style="text-align: center;">-0.2723</td>
<td style="text-align: center;">No</td>
<td style="text-align: center;">1.0728</td>
</tr>
<tr class="even">
<td style="text-align: left;">Squared Household Age</td>
<td style="text-align: center;">Contin.</td>
<td style="text-align: center;">-0.2552</td>
<td style="text-align: center;">No</td>
<td style="text-align: center;">1.1430</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Non-farm Income Access</td>
<td style="text-align: center;">Binary</td>
<td style="text-align: center;">0.3005</td>
<td style="text-align: center;">No</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Log Total Land</td>
<td style="text-align: center;">Contin.</td>
<td style="text-align: center;">0.2597</td>
<td style="text-align: center;">No</td>
<td style="text-align: center;">1.2969</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dependency Ratio</td>
<td style="text-align: center;">Contin.</td>
<td style="text-align: center;">-0.3996</td>
<td style="text-align: center;">No</td>
<td style="text-align: center;">0.9789</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bad Weather</td>
<td style="text-align: center;">Binary</td>
<td style="text-align: center;">0.2016</td>
<td style="text-align: center;">No</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Education Level</td>
<td style="text-align: center;">Contin.</td>
<td style="text-align: center;">0.2443</td>
<td style="text-align: center;">No</td>
<td style="text-align: center;">1.0338</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gender</td>
<td style="text-align: center;">Binary</td>
<td style="text-align: center;">-0.1324</td>
<td style="text-align: center;">No</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Years of Coffee Production</td>
<td style="text-align: center;">Contin.</td>
<td style="text-align: center;">-0.3400</td>
<td style="text-align: center;">No</td>
<td style="text-align: center;">0.9111</td>
</tr>
<tr class="even">
<td style="text-align: left;">Access to Credit</td>
<td style="text-align: center;">Binary</td>
<td style="text-align: center;">0.1949</td>
<td style="text-align: center;">No</td>
<td style="text-align: center;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code: Create <a href="#fig-coffee-replication-lplot">Figure 4.1</a></summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add render info for showtext to yaml. also chang legend to be more informative.  </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">love.plot</span>(coffee_formula, <span class="at">data =</span> coffee_data, </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">weights =</span> <span class="fu">list</span>(<span class="at">Replication =</span> coffee_rep_pmodel),</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">sample.names =</span> <span class="fu">c</span>(<span class="st">"Unadjusted"</span>, <span class="st">"Replication"</span>),</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">var.order =</span> <span class="st">"unadjusted"</span>, <span class="at">binary =</span> <span class="st">"std"</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">abs =</span> <span class="cn">TRUE</span>, <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"#333333"</span>, <span class="st">"#2780e3"</span>), </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">shapes =</span> <span class="fu">c</span>(<span class="st">"circle filled"</span>, <span class="st">"circle filled"</span>),</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">line =</span> <span class="cn">TRUE</span>, <span class="at">thresholds =</span> <span class="fl">0.1</span>, <span class="at">s.d.denom =</span> <span class="st">"treated"</span>) <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Variable Balance of Replication"</span>,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Absolute Standardised Mean Differences"</span>, <span class="at">fill =</span> <span class="st">"Method"</span>) <span class="sc">+</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">0.6</span>,<span class="at">length.out=</span><span class="dv">7</span>),</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  custom_ggplot_theme </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for x is already present.
Adding another scale for x, which will replace the existing scale.</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-coffee-replication-lplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-coffee-replication-lplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="coffee_replication_files/figure-html/fig-coffee-replication-lplot-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure&nbsp;4.1: A visual representation of Table&nbsp;tbl-coffee-balance called a love plot. Additionally, the unadjusted (raw data) SMDs are displayed for comparison. Variables are ordered by the SMD in the unadjusted data. Plot is created using love.plot() from the cobalt package."><img src="coffee_replication_files/figure-html/fig-coffee-replication-lplot-1.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-coffee-replication-lplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.1: A visual representation of <a href="#tbl-coffee-balance" class="quarto-xref">Table&nbsp;<span>4.3</span></a> called a love plot. Additionally, the unadjusted (raw data) SMDs are displayed for comparison. Variables are ordered by the SMD in the unadjusted data. Plot is created using <code>love.plot()</code> from the <code>cobalt</code> package.
</figcaption>
</figure>
</div>
</div>
</div>
<!-- the sizing of this vs the other loveplot is inconsistent in pdf output -->
<p><a href="#tbl-coffee-balance" class="quarto-xref">Table&nbsp;<span>4.3</span></a> and <a href="#fig-coffee-replication-lplot" class="quarto-xref">Figure&nbsp;<span>4.1</span></a> show that propensity score matching has obtained very poor balance. Based on the <span class="math inline">\(10\%\)</span> rule discussed in <a href="pscore_theory.html#sec-assessing-balance" class="quarto-xref"><span>Section 2.1.1</span></a>, not a single variable is balanced and so the estimate of the treatment effect is likely to be biased by structural differences between control and certified.</p>
<p>Four key variables: <em>age</em>, <em>gender</em>, <em>education</em>, and <em>access to credit</em> all exhibit poor balance. These variables are strong confounders in theory and so emphasising balance in these variables is critical to making a robust causal inference. Perhaps there is gender or age discrimination in the certification process. Perhaps, those with lesser education may struggle to obtain certification. Perhaps those who have less access to credit are unable to afford to become certified. Moving forward, these variables must exhibit better covariate balance to make a robust conclusion.</p>
<p><a href="#fig-replication-pscore" class="quarto-xref">Figure&nbsp;<span>4.2</span></a> shows the effect of common support trimming. <a href="#tbl-coffee-replication-ss" class="quarto-xref">Table&nbsp;<span>4.4</span></a> shows 34 total observations are dropped of which 33 are treated and 1 are control. By dropping these observations, PSM avoids making poor matching which should lead to better covariate balance. When observations are discarded, the estimand is no longer the ATT. Instead, it is refereed to as the average treatment effect on the matched or ATM. There is a significant reduction in the effective sample size in the control group from <span class="math inline">\(82\)</span> to <span class="math inline">\(21\)</span> individuals.</p>
<div class="cell">
<details class="code-fold">
<summary>Code: Create <a href="#fig-replication-pscore">Figure 4.2</a></summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#check if we acutally using these</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>discarded_scores <span class="ot">&lt;-</span> coffee_rep_pmodel<span class="sc">$</span>distance[coffee_rep_pmodel<span class="sc">$</span>discarded]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>discard_min <span class="ot">&lt;-</span> <span class="fu">min</span>(discarded_scores, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>discard_max <span class="ot">&lt;-</span> <span class="fu">max</span>(discarded_scores, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(coffee_data, <span class="fu">aes</span>(<span class="at">x =</span> coffee_rep_pmodel<span class="sc">$</span>distance, </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">fill =</span> <span class="fu">factor</span>(certified))) <span class="sc">+</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#e5e5e5"</span>, <span class="st">"#2780e3"</span>), </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Certified"</span>)) <span class="sc">+</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Propensity Scores in Replication"</span>, </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Propensity Scores"</span>, <span class="at">y =</span> <span class="st">"Density"</span>, <span class="at">fill =</span> <span class="st">"Group:"</span>) <span class="sc">+</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> discard_max, <span class="at">color =</span> <span class="st">"#333333"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> <span class="dv">0</span>, <span class="at">xmax =</span> discard_min, <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>, </span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">"#333333"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> discard_max, <span class="at">xmax =</span> <span class="dv">1</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>, </span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">"#333333"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.02</span>, <span class="at">y =</span> <span class="fl">1.5</span>, </span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Discarded Range"</span>, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">1.5</span>, <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">color =</span> <span class="st">"#333333"</span>) <span class="sc">+</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  custom_ggplot_theme</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-replication-pscore" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-replication-pscore-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="coffee_replication_files/figure-html/fig-replication-pscore-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure&nbsp;4.2: Density estimates of the propensity scores from @Jena2012 using logistic regression. Propensity score matching discards some observations as displayed by the discarded range on the left. A single observation is discarded on the right."><img src="coffee_replication_files/figure-html/fig-replication-pscore-1.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-replication-pscore-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.2: Density estimates of the propensity scores from <span class="citation" data-cites="Jena2012">Jena et al. (<a href="references.html#ref-Jena2012" role="doc-biblioref">2012</a>)</span> using logistic regression. Propensity score matching discards some observations as displayed by the discarded range on the left. A single observation is discarded on the right.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code: Create <a href="#tbl-coffee-replication-ss">Table 4.4</a></summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coffee_rep_btab_ss) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Certified"</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(coffee_rep_btab_ss, <span class="at">digits=</span><span class="dv">0</span>, <span class="at">align =</span> <span class="st">"c"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-coffee-replication-ss" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-coffee-replication-ss-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.4: The effective sample size resulting from the use of propensity score matching in <span class="citation" data-cites="Jena2012">Jena et al. (<a href="references.html#ref-Jena2012" role="doc-biblioref">2012</a>)</span>. The effective sample size (ESS) is displayed in the unweighted (raw) and matched data as well as the number of disarded observations. Computed using <code>bal.tab()</code> from the <code>cobalt</code> package.
</figcaption>
<div aria-describedby="tbl-coffee-replication-ss-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Control</th>
<th style="text-align: center;">Certified</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">All (ESS)</td>
<td style="text-align: center;">82</td>
<td style="text-align: center;">164</td>
</tr>
<tr class="even">
<td style="text-align: left;">All (Unweighted)</td>
<td style="text-align: center;">82</td>
<td style="text-align: center;">164</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Matched (ESS)</td>
<td style="text-align: center;">21</td>
<td style="text-align: center;">131</td>
</tr>
<tr class="even">
<td style="text-align: left;">Matched (Unweighted)</td>
<td style="text-align: center;">42</td>
<td style="text-align: center;">131</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Unmatched</td>
<td style="text-align: center;">39</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Discarded</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">33</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Overall, the propensity score matching in <span class="citation" data-cites="Jena2012">Jena et al. (<a href="references.html#ref-Jena2012" role="doc-biblioref">2012</a>)</span> is poor and results in unbalanced covariates and a loss of estimand.</p>
</section>
<section id="further-modelling" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="further-modelling"><span class="header-section-number">4.2</span> Further Modelling</h2>
<p>To improve the poor balance achieved by the <span class="citation" data-cites="Jena2012">Jena et al. (<a href="references.html#ref-Jena2012" role="doc-biblioref">2012</a>)</span>, there are two strategies to obtain better balance. First, the propensity scores can be re-estimated using machine learning to obtain better calibrated propensity scores. Second, inverse propensity weighting (IPW) can be used instead of propensity score matching (PSM). IPW should ensure that the sample size remains the same as no observations are lost through a matching process. IPW should retain all observations and preserve the estimand as the ATT. Additionally, IPW is generally more efficient as a pseudo-population is based on precise weights compared to matched observations that are based on approximate similarity.</p>
<p>The machine learning propensity scores will be estimated using the <code>WeightIt</code> package in the same process as <a href="implimentation_workflow.html" class="quarto-xref"><span>Chapter 3</span></a>. To select the tuning criteria, consider that <a href="#fig-coffee-replication-lplot" class="quarto-xref">Figure&nbsp;<span>4.1</span></a> that shows a significant range of balance levels in the raw data. Knowing this, the model is tuned using <code>criterion = "smd.max"</code> as reducing the priority is to reduce the extremely unbalanced covariates even if this leads to a higher average SMD.</p>
<div class="cell">
<details class="code-fold">
<summary>Code: Perform IPW with a GBM</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(WeightIt)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cobalt)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">88</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>coffee_boosted_weight <span class="ot">&lt;-</span> <span class="fu">weightit</span>(coffee_formula, <span class="at">data =</span> coffee_data, </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">method =</span> <span class="st">"gbm"</span>, <span class="at">distribution =</span> <span class="st">"bernoulli"</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">use.offset =</span> T,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">shrinkage =</span> <span class="fu">seq</span>(<span class="fl">0.15</span>, <span class="fl">0.4</span>, <span class="at">length.out =</span> <span class="dv">5</span>),</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">bag.fraction =</span> <span class="fl">0.67</span>, </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">interaction.depth =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">n.trees =</span> <span class="dv">500</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">criterion =</span> <span class="st">"smd.mean"</span>, </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">estimand =</span> <span class="st">"ATT"</span>)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>coffee_boosted_btab <span class="ot">&lt;-</span> <span class="fu">bal.tab</span>(coffee_boosted_weight, <span class="at">data =</span> coffee_data, </span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>                               <span class="at">stats =</span> <span class="fu">c</span>(<span class="st">"mean.diffs"</span>, <span class="st">"variance.ratios"</span>),</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>                               <span class="at">binary =</span> <span class="st">"std"</span>, <span class="at">continuous =</span> <span class="st">"std"</span>,</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>                               <span class="at">thresholds =</span> <span class="fu">c</span>(<span class="at">mean.diffs =</span> <span class="fl">0.1</span>),</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>                               <span class="at">s.d.denom =</span> <span class="st">"treated"</span>)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>coffee_boosted_btab <span class="ot">&lt;-</span> coffee_boosted_btab<span class="sc">$</span>Balance[<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Discussion of Tuning">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Discussion of Tuning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Initially, a tuning grid considering shrinkage values of <span class="math inline">\(0.001,0.005,.01,0.05,0.1,\text{ and }0.2\)</span> were considered using <span class="math inline">\(10000\)</span> trees with a depth between <span class="math inline">\(1\)</span> and <span class="math inline">\(5\)</span>. The best tuning performance was found with shrinkage of <span class="math inline">\(0.2\)</span> and <span class="math inline">\(9\)</span> trees which were three splits <span class="math inline">\(3\)</span> deep. As such, the tuning grid was redefined in a second iteration to use <span class="math inline">\(0.1, 0.15, 0.2, 0.25, 0.3,0.35,\text{ and } 0.4\)</span> with only <span class="math inline">\(1000\)</span> trees with between <span class="math inline">\(2\)</span> and <span class="math inline">\(5\)</span> depth. The second fit, suggested a learning rate of <span class="math inline">\(0.35\)</span> so the local area of <span class="math inline">\(0.3, 0.325, 0.350, 0.375, \text{ and }0.4\)</span> is searched in the final fit.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code: Perform IPW with Logistic Regression</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>coffee_logit_weight <span class="ot">&lt;-</span> <span class="fu">weightit</span>(coffee_formula, <span class="at">data =</span> coffee_data, </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                                <span class="at">method=</span> <span class="st">"glm"</span>, <span class="at">estimand =</span> <span class="st">"ATT"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>coffee_logit_btab <span class="ot">&lt;-</span> <span class="fu">bal.tab</span>(coffee_logit_weight, <span class="at">data =</span> coffee_data,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">formula =</span> coffee_formula,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>                             <span class="at">stats =</span> <span class="fu">c</span>(<span class="st">"mean.diffs"</span>, <span class="st">"variance.ratios"</span>),</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">binary =</span> <span class="st">"std"</span>, <span class="at">continuous =</span> <span class="st">"std"</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>                             <span class="at">thresholds =</span> <span class="fu">c</span>(<span class="at">mean.diffs =</span> <span class="fl">0.1</span>),</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>                             <span class="at">s.d.denom =</span> <span class="st">"treated"</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>coffee_logit_btab <span class="ot">&lt;-</span> coffee_logit_btab<span class="sc">$</span>Balance[<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Of course there is no guarantee that the GBM model will perform the best and so a logistic model is also fitted. An interesting comparison is between the SMDs in the matched data and in the weighted sample. Any differences between the two samples relates to the difference between PSM and IPW as the propensity scores are identical.</p>
</section>
<section id="comparison-of-methods" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="comparison-of-methods"><span class="header-section-number">4.3</span> Comparison of Methods</h2>
<p>In some of the earlier code chunks, the <code>cobalt</code> package’s <code>bal.tab()</code> computed balance tables which are combined together in <a href="#tbl-coffee-comparison" class="quarto-xref">Table&nbsp;<span>4.5</span></a> to provide a comparison between methods. For a visual interpretation, <code>love.plot()</code> creates <a href="#fig-coffee-love-all" class="quarto-xref">Figure&nbsp;<span>4.3</span></a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code: Create <a href="#tbl-coffee-comparison">Table 4.5</a>.</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"data.table"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'data.table'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:dplyr':

    between, first, last</code></pre>
</div>
<details class="code-fold">
<summary>Code: Create <a href="#tbl-coffee-comparison">Table 4.5</a>.</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cobalt)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ lubridate 1.9.3     ✔ tibble    3.2.1
✔ purrr     1.0.2     ✔ tidyr     1.3.1
✔ readr     2.1.5     </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ data.table::between()    masks dplyr::between()
✖ dplyr::filter()          masks stats::filter()
✖ data.table::first()      masks dplyr::first()
✖ kableExtra::group_rows() masks dplyr::group_rows()
✖ lubridate::hour()        masks data.table::hour()
✖ lubridate::isoweek()     masks data.table::isoweek()
✖ dplyr::lag()             masks stats::lag()
✖ data.table::last()       masks dplyr::last()
✖ lubridate::mday()        masks data.table::mday()
✖ lubridate::minute()      masks data.table::minute()
✖ lubridate::month()       masks data.table::month()
✖ lubridate::quarter()     masks data.table::quarter()
✖ lubridate::second()      masks data.table::second()
✖ purrr::transpose()       masks data.table::transpose()
✖ lubridate::wday()        masks data.table::wday()
✖ lubridate::week()        masks data.table::week()
✖ lubridate::yday()        masks data.table::yday()
✖ lubridate::year()        masks data.table::year()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<details class="code-fold">
<summary>Code: Create <a href="#tbl-coffee-comparison">Table 4.5</a>.</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>coffee_raw_btab <span class="ot">&lt;-</span> <span class="fu">bal.tab</span>(coffee_formula, <span class="at">data =</span> coffee_data, </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">stats =</span> <span class="fu">c</span>(<span class="st">"mean.diffs"</span>,<span class="st">"variance.ratios"</span>),</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">binary =</span> <span class="st">"std"</span>, <span class="at">continuous =</span> <span class="st">"std"</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">thresholds =</span> <span class="fu">c</span>(<span class="at">mean.diffs =</span> <span class="fl">0.1</span>),</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">s.d.denom =</span> <span class="st">"treated"</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>coffee_raw_btab <span class="ot">&lt;-</span> coffee_raw_btab<span class="sc">$</span>Balance[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">6</span>)]</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>coffee_combined_btab <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(<span class="fu">list</span>(coffee_raw_btab,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>                                       coffee_logit_btab,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>                                       coffee_boosted_btab), </span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">use.names=</span><span class="cn">FALSE</span>)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>coffee_combined_btab<span class="sc">$</span>Variable <span class="ot">&lt;-</span> <span class="fu">rep</span>(rowlabels, <span class="dv">3</span>)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>coffee_combined_btab <span class="ot">&lt;-</span> coffee_combined_btab[, <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)]</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>coffee_combined_btab[, <span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>          coffee_combined_btab[, <span class="dv">4</span>] <span class="sc">&gt;=</span> <span class="st">"Not Balanced, &gt;0.1"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(coffee_combined_btab, <span class="at">digits =</span> <span class="dv">4</span>, <span class="at">booktabs =</span> <span class="cn">TRUE</span>, <span class="at">align =</span> <span class="st">"c"</span>, </span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">font_size =</span> <span class="dv">10</span>, <span class="at">col.names =</span> colnames) <span class="sc">%&gt;%</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">width =</span> <span class="st">"5cm"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">bold =</span> <span class="cn">FALSE</span>, <span class="at">width =</span> <span class="st">"1cm"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pack_rows</span>(<span class="st">"Raw Data"</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="at">label_row_css =</span> <span class="st">"text-align: center;"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pack_rows</span>(<span class="st">"Logistic Regression and IPTW"</span>, <span class="dv">11</span>, <span class="dv">20</span>, </span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">label_row_css =</span> <span class="st">"text-align: center;"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pack_rows</span>(<span class="st">"Boosting Machine with IPTW"</span>, <span class="dv">21</span>, <span class="dv">30</span>, </span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">label_row_css =</span> <span class="st">"text-align: center;"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-coffee-comparison" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-coffee-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.5: Comparison of standardised mean difference (SMD) using different propensity score models. Across each of the covariates, a balance threshold is set at <span class="math inline">\(0.1\)</span> to indicate if a covariate is balanced. Binary and continuous variables are both standardised over the treatment group. SMDs are computed using <code>bal.tab()</code> from the <code>cobalt</code> package.
</figcaption>
<div aria-describedby="tbl-coffee-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Variable</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Type</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">SMD</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Balance Threshold</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Variance Ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd" data-grouplength="10">
<td colspan="5" style="text-align: center;"><strong>Raw Data</strong></td>
</tr>
<tr class="even">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Household Age</td>
<td style="text-align: center; width: 1cm;">Contin.</td>
<td style="text-align: center; width: 1cm;">0.5634</td>
<td style="text-align: center; width: 1cm;">No</td>
<td style="text-align: center; width: 1cm;">0.8650</td>
</tr>
<tr class="odd">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Squared Household Age</td>
<td style="text-align: center; width: 1cm;">Contin.</td>
<td style="text-align: center; width: 1cm;">0.4912</td>
<td style="text-align: center; width: 1cm;">No</td>
<td style="text-align: center; width: 1cm;">1.0070</td>
</tr>
<tr class="even">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Non-farm Income Access</td>
<td style="text-align: center; width: 1cm;">Binary</td>
<td style="text-align: center; width: 1cm;">-0.3928</td>
<td style="text-align: center; width: 1cm;">No</td>
<td style="text-align: center; width: 1cm;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Log Total Land</td>
<td style="text-align: center; width: 1cm;">Contin.</td>
<td style="text-align: center; width: 1cm;">-0.4048</td>
<td style="text-align: center; width: 1cm;">No</td>
<td style="text-align: center; width: 1cm;">0.5507</td>
</tr>
<tr class="even">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Dependency Ratio</td>
<td style="text-align: center; width: 1cm;">Contin.</td>
<td style="text-align: center; width: 1cm;">0.0487</td>
<td style="text-align: center; width: 1cm;">Yes</td>
<td style="text-align: center; width: 1cm;">1.2371</td>
</tr>
<tr class="odd">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Bad Weather</td>
<td style="text-align: center; width: 1cm;">Binary</td>
<td style="text-align: center; width: 1cm;">-0.2505</td>
<td style="text-align: center; width: 1cm;">No</td>
<td style="text-align: center; width: 1cm;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Education Level</td>
<td style="text-align: center; width: 1cm;">Contin.</td>
<td style="text-align: center; width: 1cm;">-0.0020</td>
<td style="text-align: center; width: 1cm;">Yes</td>
<td style="text-align: center; width: 1cm;">0.7272</td>
</tr>
<tr class="odd">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Gender</td>
<td style="text-align: center; width: 1cm;">Binary</td>
<td style="text-align: center; width: 1cm;">-0.2750</td>
<td style="text-align: center; width: 1cm;">No</td>
<td style="text-align: center; width: 1cm;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Years of Coffee Production</td>
<td style="text-align: center; width: 1cm;">Contin.</td>
<td style="text-align: center; width: 1cm;">0.4557</td>
<td style="text-align: center; width: 1cm;">No</td>
<td style="text-align: center; width: 1cm;">1.3621</td>
</tr>
<tr class="odd">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Access to Credit</td>
<td style="text-align: center; width: 1cm;">Binary</td>
<td style="text-align: center; width: 1cm;">0.5968</td>
<td style="text-align: center; width: 1cm;">No</td>
<td style="text-align: center; width: 1cm;">NA</td>
</tr>
<tr class="even" data-grouplength="10">
<td colspan="5" style="text-align: center;"><strong>Logistic Regression and IPTW</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Household Age</td>
<td style="text-align: center; width: 1cm;">Contin.</td>
<td style="text-align: center; width: 1cm;">0.2449</td>
<td style="text-align: center; width: 1cm;">No</td>
<td style="text-align: center; width: 1cm;">0.9275</td>
</tr>
<tr class="even">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Squared Household Age</td>
<td style="text-align: center; width: 1cm;">Contin.</td>
<td style="text-align: center; width: 1cm;">0.2277</td>
<td style="text-align: center; width: 1cm;">No</td>
<td style="text-align: center; width: 1cm;">1.0724</td>
</tr>
<tr class="odd">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Non-farm Income Access</td>
<td style="text-align: center; width: 1cm;">Binary</td>
<td style="text-align: center; width: 1cm;">0.1701</td>
<td style="text-align: center; width: 1cm;">No</td>
<td style="text-align: center; width: 1cm;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Log Total Land</td>
<td style="text-align: center; width: 1cm;">Contin.</td>
<td style="text-align: center; width: 1cm;">-0.0923</td>
<td style="text-align: center; width: 1cm;">Yes</td>
<td style="text-align: center; width: 1cm;">0.8564</td>
</tr>
<tr class="odd">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Dependency Ratio</td>
<td style="text-align: center; width: 1cm;">Contin.</td>
<td style="text-align: center; width: 1cm;">0.1138</td>
<td style="text-align: center; width: 1cm;">No</td>
<td style="text-align: center; width: 1cm;">1.3877</td>
</tr>
<tr class="even">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Bad Weather</td>
<td style="text-align: center; width: 1cm;">Binary</td>
<td style="text-align: center; width: 1cm;">0.1941</td>
<td style="text-align: center; width: 1cm;">No</td>
<td style="text-align: center; width: 1cm;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Education Level</td>
<td style="text-align: center; width: 1cm;">Contin.</td>
<td style="text-align: center; width: 1cm;">0.0473</td>
<td style="text-align: center; width: 1cm;">Yes</td>
<td style="text-align: center; width: 1cm;">0.9217</td>
</tr>
<tr class="even">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Gender</td>
<td style="text-align: center; width: 1cm;">Binary</td>
<td style="text-align: center; width: 1cm;">-0.0465</td>
<td style="text-align: center; width: 1cm;">Yes</td>
<td style="text-align: center; width: 1cm;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Years of Coffee Production</td>
<td style="text-align: center; width: 1cm;">Contin.</td>
<td style="text-align: center; width: 1cm;">-0.0613</td>
<td style="text-align: center; width: 1cm;">Yes</td>
<td style="text-align: center; width: 1cm;">1.1125</td>
</tr>
<tr class="even">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Access to Credit</td>
<td style="text-align: center; width: 1cm;">Binary</td>
<td style="text-align: center; width: 1cm;">-0.0292</td>
<td style="text-align: center; width: 1cm;">Yes</td>
<td style="text-align: center; width: 1cm;">NA</td>
</tr>
<tr class="odd" data-grouplength="10">
<td colspan="5" style="text-align: center;"><strong>Boosting Machine with IPTW</strong></td>
</tr>
<tr class="even">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Household Age</td>
<td style="text-align: center; width: 1cm;">Contin.</td>
<td style="text-align: center; width: 1cm;">0.0669</td>
<td style="text-align: center; width: 1cm;">Yes</td>
<td style="text-align: center; width: 1cm;">1.2690</td>
</tr>
<tr class="odd">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Squared Household Age</td>
<td style="text-align: center; width: 1cm;">Contin.</td>
<td style="text-align: center; width: 1cm;">0.0989</td>
<td style="text-align: center; width: 1cm;">Yes</td>
<td style="text-align: center; width: 1cm;">1.4911</td>
</tr>
<tr class="even">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Non-farm Income Access</td>
<td style="text-align: center; width: 1cm;">Binary</td>
<td style="text-align: center; width: 1cm;">0.0579</td>
<td style="text-align: center; width: 1cm;">Yes</td>
<td style="text-align: center; width: 1cm;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Log Total Land</td>
<td style="text-align: center; width: 1cm;">Contin.</td>
<td style="text-align: center; width: 1cm;">-0.0284</td>
<td style="text-align: center; width: 1cm;">Yes</td>
<td style="text-align: center; width: 1cm;">0.8760</td>
</tr>
<tr class="even">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Dependency Ratio</td>
<td style="text-align: center; width: 1cm;">Contin.</td>
<td style="text-align: center; width: 1cm;">-0.0623</td>
<td style="text-align: center; width: 1cm;">Yes</td>
<td style="text-align: center; width: 1cm;">0.7660</td>
</tr>
<tr class="odd">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Bad Weather</td>
<td style="text-align: center; width: 1cm;">Binary</td>
<td style="text-align: center; width: 1cm;">0.1915</td>
<td style="text-align: center; width: 1cm;">No</td>
<td style="text-align: center; width: 1cm;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Education Level</td>
<td style="text-align: center; width: 1cm;">Contin.</td>
<td style="text-align: center; width: 1cm;">0.1377</td>
<td style="text-align: center; width: 1cm;">No</td>
<td style="text-align: center; width: 1cm;">1.0735</td>
</tr>
<tr class="odd">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Gender</td>
<td style="text-align: center; width: 1cm;">Binary</td>
<td style="text-align: center; width: 1cm;">-0.0816</td>
<td style="text-align: center; width: 1cm;">Yes</td>
<td style="text-align: center; width: 1cm;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Years of Coffee Production</td>
<td style="text-align: center; width: 1cm;">Contin.</td>
<td style="text-align: center; width: 1cm;">-0.0055</td>
<td style="text-align: center; width: 1cm;">Yes</td>
<td style="text-align: center; width: 1cm;">0.9704</td>
</tr>
<tr class="odd">
<td style="text-align: center; width: 5cm; font-weight: bold; padding-left: 2em;" data-indentlevel="1">Access to Credit</td>
<td style="text-align: center; width: 1cm;">Binary</td>
<td style="text-align: center; width: 1cm;">0.1231</td>
<td style="text-align: center; width: 1cm;">No</td>
<td style="text-align: center; width: 1cm;">NA</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code: Create <a href="#fig-coffee-love-all">Figure 4.3</a></summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">love.plot</span>(coffee_formula,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> coffee_data, </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">weights =</span> <span class="fu">list</span>(<span class="at">Replication =</span> coffee_rep_pmodel,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Logit =</span> coffee_logit_weight,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Boosting=</span> coffee_boosted_weight),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">var.order =</span> <span class="st">"unadjusted"</span>, <span class="at">binary =</span> <span class="st">"std"</span>, <span class="at">continuous =</span> <span class="st">"std"</span>,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">abs =</span> <span class="cn">TRUE</span>, <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"#333333"</span>, <span class="st">"#2780e3"</span>, <span class="st">"darkblue"</span>,<span class="st">"darkred"</span>), </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">shapes =</span> <span class="fu">rep</span>(<span class="st">"circle filled"</span>, <span class="dv">4</span>),</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">line =</span> <span class="cn">TRUE</span>, <span class="at">thresholds =</span> <span class="fl">0.1</span>, <span class="at">s.d.denom =</span> <span class="st">"treated"</span>, <span class="at">use.grid =</span> F) <span class="sc">+</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Variable Balance Using Different Balance Methods"</span>,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Absolute Standardised Mean Differences"</span>,</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Method"</span>) <span class="sc">+</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">0.6</span>,<span class="at">length.out=</span><span class="dv">7</span>),</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  custom_ggplot_theme </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for x is already present.
Adding another scale for x, which will replace the existing scale.</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-coffee-love-all" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-coffee-love-all-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="coffee_replication_files/figure-html/fig-coffee-love-all-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure&nbsp;4.3: Visual representation of Table&nbsp;tbl-coffee-comparison called a love plot and displays the standardised mean difference (SMD) of covariates in @Jena2012. Additionally, the unadjusted SMDs are displayed for comparison. Variables are ordered by the SMD in the unadjusted data."><img src="coffee_replication_files/figure-html/fig-coffee-love-all-1.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-coffee-love-all-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.3: Visual representation of <a href="#tbl-coffee-comparison" class="quarto-xref">Table&nbsp;<span>4.5</span></a> called a love plot and displays the standardised mean difference (SMD) of covariates in <span class="citation" data-cites="Jena2012">Jena et al. (<a href="references.html#ref-Jena2012" role="doc-biblioref">2012</a>)</span>. Additionally, the unadjusted SMDs are displayed for comparison. Variables are ordered by the SMD in the unadjusted data.
</figcaption>
</figure>
</div>
</div>
</div>
<p>There are three notable findings:</p>
<ol type="1">
<li><p>PSM has performed very poorly relative to IPW even when matching dropps a significant number of observations.</p></li>
<li><p>A GBM model has resulted in better covariate balance than logistic regression for most covariates. Using a <span class="math inline">\(10\%\)</span> threshold for determining balance, logistic regression leaves <span class="math inline">\(5\)</span> variables unbalanced and the GBM leaves <span class="math inline">\(3\)</span> variables unbalanced. Additionally, the degree of unbalance is larger for logistic regression.</p></li>
<li><p>Logistic regress has a satisfactory average SMD of 0.0768603. Boosting has an average SMD of 0.0498114 which is excellent and meets a rigorous threshold of <span class="math inline">\(5\%\)</span>.</p></li>
<li><p>The covariate with the highest SMD is <em>household age</em> (<span class="math inline">\(0.245\%\)</span>) in logistic regression and <em>bad weather</em> (<span class="math inline">\(0.191\)</span>) in the GBM.</p></li>
</ol>
</section>
<section id="results" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="results"><span class="header-section-number">4.4</span> Results</h2>
<p>Now that satisfactory covariate balance is achieved, the treatment effect can be estimated under logistic regression, the GBM, and then compared to the result in the paper. Note that the estimand in the paper is intended to be the average treatment effect (ATT) but dropped observations mean the actual treatment effect is the average treatment effect on matched (ATM) individuals. In theory, better covariate balance should lead to a better estimate of the ATT so a comparison of the estimates is interesting. As in <a href="implimentation_workflow.html#sec-nsw-results" class="quarto-xref"><span>Section 3.2.3</span></a>, the results will be completed using G-computation with the <code>lm_weightit()</code> and <code>avg_comparisons()</code> functions.</p>
<div class="cell">
<details class="code-fold">
<summary>Code: Create <a href="#tbl-comparison-coffee-results">Table 4.6</a></summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>coffee_att_formula <span class="ot">&lt;-</span> <span class="fu">update.formula</span>(<span class="fu">as.formula</span>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="st">"~"</span>, <span class="fu">paste</span>(<span class="fu">attr</span>(<span class="fu">terms</span>(coffee_formula), <span class="st">"term.labels"</span>), </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">collapse =</span> <span class="st">" + "</span>))), </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  percapitaincome_day_maleeq <span class="sc">~</span> certified <span class="sc">*</span> .)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>coffee_logit_fit <span class="ot">&lt;-</span> <span class="fu">lm_weightit</span>(coffee_att_formula,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> coffee_data, <span class="at">weightit =</span> coffee_logit_weight)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>coffee_boosted_fit <span class="ot">&lt;-</span> <span class="fu">lm_weightit</span>(coffee_att_formula,</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">data =</span> coffee_data, </span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">weightit =</span> coffee_boosted_weight)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>coffee_logit_att <span class="ot">&lt;-</span> <span class="fu">avg_comparisons</span>(coffee_logit_fit, <span class="at">variables =</span> <span class="st">"certified"</span>)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>coffee_boosted_att <span class="ot">&lt;-</span> <span class="fu">avg_comparisons</span>(coffee_boosted_fit, </span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">variables =</span> <span class="st">"certified"</span>)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>coffee_comparisons_tab <span class="ot">&lt;-</span> <span class="fu">rbind</span>(replicated_result_tbl, </span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">extract_comparison_results</span>(coffee_logit_att),</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">extract_comparison_results</span>(coffee_boosted_att))</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(coffee_comparisons_tab) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Rep. Result (Logistic with PSM)"</span>,</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Logistic Regression and IPW"</span>, </span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Generalized Boosting Machine and IPW"</span>)</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(coffee_comparisons_tab, <span class="at">digits =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-comparison-coffee-results" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-comparison-coffee-results-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.6: Estimates of the average treatment effect on the treated of certification on per capita income across different propensity score models and methods. Created using <code>WeightIt</code>, <code>MatchIt</code>, and <code>Cobalt</code> packages.
</figcaption>
<div aria-describedby="tbl-comparison-coffee-results-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 46%">
<col style="width: 11%">
<col style="width: 8%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Estimate</th>
<th style="text-align: right;">SE</th>
<th style="text-align: right;">P.Value</th>
<th style="text-align: right;">Lower.CI</th>
<th style="text-align: right;">Upper.CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Rep.&nbsp;Result (Logistic with PSM)</td>
<td style="text-align: right;">-0.1538</td>
<td style="text-align: right;">0.9898</td>
<td style="text-align: right;">0.8350</td>
<td style="text-align: right;">-1.6009</td>
<td style="text-align: right;">1.2934</td>
</tr>
<tr class="even">
<td style="text-align: left;">Logistic Regression and IPW</td>
<td style="text-align: right;">-1.5824</td>
<td style="text-align: right;">0.6072</td>
<td style="text-align: right;">0.0092</td>
<td style="text-align: right;">-2.7724</td>
<td style="text-align: right;">-0.3924</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Generalized Boosting Machine and IPW</td>
<td style="text-align: right;">-1.0187</td>
<td style="text-align: right;">0.5196</td>
<td style="text-align: right;">0.0499</td>
<td style="text-align: right;">-2.0372</td>
<td style="text-align: right;">-0.0003</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p><a href="#tbl-comparison-coffee-results" class="quarto-xref">Table&nbsp;<span>4.6</span></a> shows the estimates of the treatment effect across different methods. Recall that <span class="citation" data-cites="Jena2012">Jena et al. (<a href="references.html#ref-Jena2012" role="doc-biblioref">2012</a>)</span> estimate a an effect of <span class="math inline">\(-0.15\)</span> implying that daily income reduces by <span class="math inline">\(0.15\)</span> if a farmer becomes certified. This result is not statistically significant.</p>
<p>The IPW estimate is <span class="math inline">\(-1.58\)</span> implying that certification leads to a <span class="math inline">\(\$1.58\)</span> decrease in daily income. This coefficient is much larger than than the original paper by a magnitude of <span class="math inline">\(10\)</span>. Additionally, this estimate is statistically significant at the <span class="math inline">\(1\%\)</span> level. The GBM estimate is <span class="math inline">\(-1.02\)</span> which predicts a decrease in daily income by <span class="math inline">\(\$1.02\)</span> when a farmer becomes certified. This finding is statistically significant at the <span class="math inline">\(5\%\)</span> level.</p>
<p>The reason for a large difference is threefold. First, better covariate balance by using a GBM and IPW and should result in a more robust estimate. Of course better covariate balance alone does not guarantee robust results but it is a step in the right direction. Theoretically, weighting on the inverse of the propensity scores from a GBM results in the best estimate so the paper may significantly underestimate the coefficient. Second, a different estimand will often lead to a different estimate of the treatment effect. It is not clear or directly estimable how much of the difference in estimate results from switching from the ATM to the ATT. Related to this, the data used to estimate the treatment effect is different as there are no dropped observations either of the IPW estimates. Third…</p>
<p>The most interesting result is that the estimates become even more negative. One may expect that the result from a better balanced sample would become positive to align with theoretical motivations for cerification policies. <span class="citation" data-cites="Jena2012">Jena et al. (<a href="references.html#ref-Jena2012" role="doc-biblioref">2012</a>)</span> presented two explanations for why certification shows no positive impact. Firstly, the authors note that the prices offered by certified cooperatives are not significantly different from those provided by non-certified cooperatives. Secondly, a substantial portion of coffee—about 75%—is sold to private traders, who often pay higher prices to non-certified farmers. Additionally, from qualitative interviews with farmers, the authors note that policies and arrangements within different cooperatives exhibit heterogeneity so the impact of certification may relate more to the structure of the cooperatives.</p>
<p>An additional answer is the impact of reverse causality. A general problem is causal inference is that the direction of causality is not always known. While it is most intuitive that coffee certification would impact income, it is also possible that a farmers daily income might determine their certification. Suppose that proponents of fairtrade and certification are correct that it will increase income and benefit livelihood. If farmers are are of this, then perhaps the lowest income farmers are most likely to attempt to become certified to increase their income. Additionally, income likely has a reverse causal relationship with many of the explanatory variables. For example, a higher income may lead to better access to credit and the accumulation of land.</p>
<p>In summary, the analysis demonstrates that using more advanced methods like GBM and IPW not only improves covariate balance but also leads to significantly larger and more negative estimates of the treatment effect compared to the original study. This suggests that previous estimates may have underestimated the negative impact of certification on daily income. The findings highlight the importance of methodological rigor in estimating causal effects and raise critical questions about the broader implications of certification policies, particularly when considering potential reverse causality and the varying structures of cooperatives. This analysis underscores the need for careful interpretation of treatment effects, especially in policy-relevant research.</p>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-Abadie2006" class="csl-entry" role="listitem">
Abadie, Alberto, and Guido W. Imbens. 2006. <span>“<span class="nocase">Large sample properties of matching estimators for average treatment effects</span>.”</span> <em>Econometrica</em> 74 (1): 235–67. <a href="https://doi.org/10.1111/j.1468-0262.2006.00655.x">https://doi.org/10.1111/j.1468-0262.2006.00655.x</a>.
</div>
<div id="ref-Jena2012" class="csl-entry" role="listitem">
Jena, Pradyot Ranjan, Bezawit Beyene Chichaibelu, Till Stellmacher, and Ulrike Grote. 2012. <span>“<span class="nocase">The impact of coffee certification on small-scale producers’ livelihoods: A case study from the Jimma Zone, Ethiopia</span>.”</span> <em>Agricultural Economics (United Kingdom)</em> 43 (4): 429–40. <a href="https://doi.org/10.1111/j.1574-0862.2012.00594.x">https://doi.org/10.1111/j.1574-0862.2012.00594.x</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/implimentation_workflow.html" class="pagination-link" aria-label="Tutorial: Implimentation, Workflow, and Example with `WeightIt` and`gbm` in R">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Tutorial: Implimentation, Workflow, and Example with <code>WeightIt</code> and<code>gbm</code> in R</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/conclusion.html" class="pagination-link" aria-label="Conclusion and Summary">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Conclusion and Summary</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb32" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Replication Case Study</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">"globals.RData"</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>The replication study focuses on a paper titled *The Impact of Coffee Certification on Small-Scale Producers' Livelihoods: A Case Study from the Jimma Zone, Ethiopia* published in Agricultural Economics (2012) by Pradyot Ranjan Jena, Bezawit Beyene Chichaibelu, Till Stellmacher, and Ulrike Grote. This paper explores the effects of coffee certification schemes on the economic wellbeing of small-scale coffee farmers in Ethiopia, particularly examining whether these schemes contribute to poverty reduction and improved livelihoods among smallholders.</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>The central theme of the paper is the evaluation of certification schemes, such as Fairtrade and organic certification, as tools for enhancing the income stability and economic resilience of small-scale coffee producers. Certification is seen as a potential tool for economic growth and and environmental sustainability and so it is important to understand the impact on small-scale farmers. @tbl-coffee-var-summary summarises the variables used in the propensity score model. </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: tbl-coffee-var-summary</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: !expr "knitr::is_html_output()"</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-summary: "Code: Create [Table 4.1](#tbl-coffee-var-summary)"</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="in">#| tbl-cap: "List of covaraites in @Jena2012. Per capita income is the outcome and certification is the treatment. Other covariates are used in the propensity score model."</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr) </span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="in">library(kableExtra) </span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="in">coffee_variable_summary &lt;- data.frame(</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="in">  Name = c("Per Capita Income", "Certification (Treatment/ Control)", </span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="in">                    "Household Age", "Squared Household Age", "Gender", </span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a><span class="in">                    "Dependency Ratio", "Education Level", </span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a><span class="in">                    "Years of Coffee Production", </span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="in">                    "Log Total Land", "Access to Credit", </span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a><span class="in">                    "Bad Weather", "Non-farm Income Access"),</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a><span class="in">  Codename = c("`percapitaincome_day_maleeq`", "`certified`", "`age_hh`", </span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a><span class="in">                "`agesq`", "`gender`", "`depratio`", "`edu`", </span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a><span class="in">                "`years_cofeproduction`", "`logtotal_land`", "`access_credit`",  </span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a><span class="in">                "`badweat`", "`nonfarmincome_access`"),</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a><span class="in">  Description = c("Average income earned per person within a farming household", </span></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a><span class="in">                  "If the farming household is certified (=1) or otherwise (=0)", </span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a><span class="in">                  "Age of the head of the household in years", </span></span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a><span class="in">                  "Age of the head of the household squared", </span></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a><span class="in">                  "Gender of the head of household (male = 1 and female = 0)", </span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a><span class="in">                  "Household members below 14 and above 65 years divided by </span></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a><span class="in">                    rest of the household member", </span></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a><span class="in">                  "Education of the head of household in years",</span></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a><span class="in">                  "Years of experience in coffee farming",</span></span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a><span class="in">                  "Logarithm of total land size in hectares",</span></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a><span class="in">                  "Household has access to credit (yes = 1, otherwise = 0)",</span></span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a><span class="in">                  "If the household was affected by floods/droughts during the </span></span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a><span class="in">                    last year (2008–2009)",</span></span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a><span class="in">                  "If the household has access to nonfarm income")</span></span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(coffee_variable_summary)</span></span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- the names start to overlap in the pdf output. fix the pdf sizing  --&gt;</span></span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a>@Jena2012 define livelihood as a combination of per capita income, total income, per capita consumption, and yield per hectare. For simplicity, this replication will only use per capita income as a dependent variable. This measure is selected as per capita income is a direct measurement of the income of those potentially impacted by certification. Additionally, the replication uses the same variables as the original paper so any difference in estimates or  covariate balance can be attributed to the propensity score model. </span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a>Randomisation into certified and uncertified is not possible and it is likely that farmers who seek certification are different than farmers who don't. Thus, there is selection bias leading to structural differences between groups so a contrast in means between the certified (treated) and uncertified (control) farmers would be biased. Propensity scores are used to create covariate balance and reduce bias of the estimated treatment effect. The paper did not assess the balance of covariates. However, this provides a good opportunity to assess covariate balance in the initial paper and the repeat the analysis using a machine learning propensity model. </span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a><span class="fu">## Replication of Original Results</span></span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a>@Jena2012 provides a replication package including Stata code that uses Stata's psmatch2 package to perform nearest neighbour matching with replacement and common support trimming. Common support trimming means that any observations outside the commonly overlapping are are discarded. The results of the paper are be fully replicated using the <span class="in">`MatchIt`</span> package inside R.</span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-61"><a href="#cb32-61" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb32-62"><a href="#cb32-62" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: tbl-replicated-result</span></span>
<span id="cb32-63"><a href="#cb32-63" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb32-64"><a href="#cb32-64" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: !expr "knitr::is_html_output()"</span></span>
<span id="cb32-65"><a href="#cb32-65" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-summary: "Code: Create [Table 4.2](#tbl-replicated-result)"</span></span>
<span id="cb32-66"><a href="#cb32-66" aria-hidden="true" tabindex="-1"></a><span class="in">#| tbl-cap: "Replication of results in @Jena2012. Note a slight difference in standard error which should be $1.1$ as the `MatchItSE` package uses a trivially different method than psmatch2 in Stata [see @Abadie2006]. Matching is performed by `matchit()` from the `MatchIt` package."</span></span>
<span id="cb32-67"><a href="#cb32-67" aria-hidden="true" tabindex="-1"></a><span class="in">library(MatchIt)</span></span>
<span id="cb32-68"><a href="#cb32-68" aria-hidden="true" tabindex="-1"></a><span class="in">library(MatchItSE)</span></span>
<span id="cb32-69"><a href="#cb32-69" aria-hidden="true" tabindex="-1"></a><span class="in">library(marginaleffects)</span></span>
<span id="cb32-70"><a href="#cb32-70" aria-hidden="true" tabindex="-1"></a><span class="in">coffee_formula &lt;- as.formula(certified ~ age_hh + agesq + nonfarmincome_access +</span></span>
<span id="cb32-71"><a href="#cb32-71" aria-hidden="true" tabindex="-1"></a><span class="in">                             depratio + logtotal_land + badweat + edu + gender + </span></span>
<span id="cb32-72"><a href="#cb32-72" aria-hidden="true" tabindex="-1"></a><span class="in">                             years_cofeproduction + access_credit)</span></span>
<span id="cb32-73"><a href="#cb32-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-74"><a href="#cb32-74" aria-hidden="true" tabindex="-1"></a><span class="in">coffee_rep_pmodel &lt;- matchit(coffee_formula, data = coffee_data, </span></span>
<span id="cb32-75"><a href="#cb32-75" aria-hidden="true" tabindex="-1"></a><span class="in">                             distance = "glm", method = "nearest",</span></span>
<span id="cb32-76"><a href="#cb32-76" aria-hidden="true" tabindex="-1"></a><span class="in">                             replace = TRUE, estimand = "ATT", discard = "both") </span></span>
<span id="cb32-77"><a href="#cb32-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-78"><a href="#cb32-78" aria-hidden="true" tabindex="-1"></a><span class="in">coffee_logit_md &lt;- match.data(coffee_rep_pmodel)</span></span>
<span id="cb32-79"><a href="#cb32-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-80"><a href="#cb32-80" aria-hidden="true" tabindex="-1"></a><span class="in">coffee_rep_fit&lt;- lm(percapitaincome_day_maleeq ~ certified,</span></span>
<span id="cb32-81"><a href="#cb32-81" aria-hidden="true" tabindex="-1"></a><span class="in">                    data = coffee_logit_md, weights = weights)</span></span>
<span id="cb32-82"><a href="#cb32-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-83"><a href="#cb32-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-84"><a href="#cb32-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-85"><a href="#cb32-85" aria-hidden="true" tabindex="-1"></a><span class="in">replicated_result &lt;- avg_comparisons(coffee_rep_fit, variables = "certified",</span></span>
<span id="cb32-86"><a href="#cb32-86" aria-hidden="true" tabindex="-1"></a><span class="in">                                     vcov = NULL, </span></span>
<span id="cb32-87"><a href="#cb32-87" aria-hidden="true" tabindex="-1"></a><span class="in">                                     newdata = subset(coffee_logit_md, </span></span>
<span id="cb32-88"><a href="#cb32-88" aria-hidden="true" tabindex="-1"></a><span class="in">                                                      certified == 1),</span></span>
<span id="cb32-89"><a href="#cb32-89" aria-hidden="true" tabindex="-1"></a><span class="in">                                     wts = "weights")</span></span>
<span id="cb32-90"><a href="#cb32-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-91"><a href="#cb32-91" aria-hidden="true" tabindex="-1"></a><span class="in">ai_se &lt;- abadie_imbens_se(obj = coffee_rep_pmodel, </span></span>
<span id="cb32-92"><a href="#cb32-92" aria-hidden="true" tabindex="-1"></a><span class="in">                          Y = coffee_data$percapitaincome_day_maleeq)</span></span>
<span id="cb32-93"><a href="#cb32-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-94"><a href="#cb32-94" aria-hidden="true" tabindex="-1"></a><span class="in">replicated_result_tbl &lt;- extract_comparison_results(replicated_result)</span></span>
<span id="cb32-95"><a href="#cb32-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-96"><a href="#cb32-96" aria-hidden="true" tabindex="-1"></a><span class="in">replicated_result_tbl$SE &lt;- ai_se</span></span>
<span id="cb32-97"><a href="#cb32-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-98"><a href="#cb32-98" aria-hidden="true" tabindex="-1"></a><span class="in">rownames(replicated_result_tbl) &lt;- "Replicated Result"</span></span>
<span id="cb32-99"><a href="#cb32-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-100"><a href="#cb32-100" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(replicated_result_tbl, digits = 4)</span></span>
<span id="cb32-101"><a href="#cb32-101" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-102"><a href="#cb32-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-103"><a href="#cb32-103" aria-hidden="true" tabindex="-1"></a>@tbl-replicated-result shows the replicated result obtained by @Jena2012. The intriguing finding of the paper is that the average treatment effect on the treated (ATT) is negative. That is, of the farmers that become certified, their per capita income is expected to decrease by $\$0.15$ per day. Intuition and proponents of certification schemes suggest that certification leads to an increase of income. If certification negatively impacts income, it would call into question a significant effort to engage in certification and fair trade practices.</span>
<span id="cb32-104"><a href="#cb32-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-105"><a href="#cb32-105" aria-hidden="true" tabindex="-1"></a>@Jena2012 does not perform any discussion or consideration of balance in their paper and so it is unclear if propensity score matching results in covariate balance. The <span class="in">`cobalt`</span> package creates balance tables using <span class="in">`bal.tab()`</span> and a visualisation using <span class="in">`love.plot()`</span>. </span>
<span id="cb32-106"><a href="#cb32-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-109"><a href="#cb32-109" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-110"><a href="#cb32-110" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-coffee-balance</span></span>
<span id="cb32-111"><a href="#cb32-111" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb32-112"><a href="#cb32-112" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: !expr "knitr::is_html_output()"</span></span>
<span id="cb32-113"><a href="#cb32-113" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code: Create [Table 4.3](#tbl-coffee-balance)"</span></span>
<span id="cb32-114"><a href="#cb32-114" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "The standardised mean difference (SMD) for each covariate in @Jena2012 using a logistic regression propensity model and propensity score matching. Across each of the covariates, a balance threshold is set at $0.1$ to indicate if a covariate is balanced.  Binary and continuous variables are both standardised over the treatment group. SMDs are computed using `bal.tab()` from the `cobalt` package."</span></span>
<span id="cb32-115"><a href="#cb32-115" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cobalt)</span>
<span id="cb32-116"><a href="#cb32-116" aria-hidden="true" tabindex="-1"></a>coffee_rep_btab <span class="ot">&lt;-</span> <span class="fu">bal.tab</span>(coffee_rep_pmodel, </span>
<span id="cb32-117"><a href="#cb32-117" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> coffee_data, </span>
<span id="cb32-118"><a href="#cb32-118" aria-hidden="true" tabindex="-1"></a>                        <span class="at">stats =</span> <span class="fu">c</span>(<span class="st">"mean.diffs"</span>,<span class="st">"variance.ratios"</span>),</span>
<span id="cb32-119"><a href="#cb32-119" aria-hidden="true" tabindex="-1"></a>                        <span class="at">binary =</span> <span class="st">"std"</span>, <span class="at">continuous =</span> <span class="st">"std"</span>,</span>
<span id="cb32-120"><a href="#cb32-120" aria-hidden="true" tabindex="-1"></a>                        <span class="at">thresholds =</span> <span class="fu">c</span>(<span class="at">mean.diffs =</span> <span class="fl">0.1</span>),</span>
<span id="cb32-121"><a href="#cb32-121" aria-hidden="true" tabindex="-1"></a>                        <span class="at">s.d.denom =</span> <span class="st">"treated"</span>)</span>
<span id="cb32-122"><a href="#cb32-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-123"><a href="#cb32-123" aria-hidden="true" tabindex="-1"></a>coffee_rep_btab_ss <span class="ot">&lt;-</span> coffee_rep_btab<span class="sc">$</span>Observations</span>
<span id="cb32-124"><a href="#cb32-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-125"><a href="#cb32-125" aria-hidden="true" tabindex="-1"></a>coffee_rep_btab <span class="ot">&lt;-</span> coffee_rep_btab<span class="sc">$</span>Balance[<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>)]</span>
<span id="cb32-126"><a href="#cb32-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-127"><a href="#cb32-127" aria-hidden="true" tabindex="-1"></a>rowlabels <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb32-128"><a href="#cb32-128" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Household Age"</span>, <span class="st">"Squared Household Age"</span>, <span class="st">"Non-farm Income Access"</span>, </span>
<span id="cb32-129"><a href="#cb32-129" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Log Total Land"</span>, <span class="st">"Dependency Ratio"</span>, <span class="st">"Bad Weather"</span>,</span>
<span id="cb32-130"><a href="#cb32-130" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Education Level"</span>, <span class="st">"Gender"</span>, <span class="st">"Years of Coffee Production"</span>, </span>
<span id="cb32-131"><a href="#cb32-131" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Access to Credit"</span>)</span>
<span id="cb32-132"><a href="#cb32-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-133"><a href="#cb32-133" aria-hidden="true" tabindex="-1"></a>colnames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Variable"</span>,<span class="st">"Type"</span>, <span class="st">"SMD"</span>, <span class="st">"Balance Threshold"</span>, <span class="st">"Variance Ratio"</span>)</span>
<span id="cb32-134"><a href="#cb32-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-135"><a href="#cb32-135" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(coffee_rep_btab) <span class="ot">&lt;-</span> rowlabels</span>
<span id="cb32-136"><a href="#cb32-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-137"><a href="#cb32-137" aria-hidden="true" tabindex="-1"></a>coffee_rep_btab[,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb32-138"><a href="#cb32-138" aria-hidden="true" tabindex="-1"></a>          coffee_rep_btab[,<span class="dv">3</span>] <span class="sc">&gt;=</span> <span class="st">"Not Balanced, &gt;0.1"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>)</span>
<span id="cb32-139"><a href="#cb32-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-140"><a href="#cb32-140" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(coffee_rep_btab, <span class="at">digits =</span> <span class="dv">4</span>, <span class="at">align =</span> <span class="st">"c"</span>)</span>
<span id="cb32-141"><a href="#cb32-141" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-142"><a href="#cb32-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-145"><a href="#cb32-145" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-146"><a href="#cb32-146" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb32-147"><a href="#cb32-147" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb32-148"><a href="#cb32-148" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: getndropped</span></span>
<span id="cb32-149"><a href="#cb32-149" aria-hidden="true" tabindex="-1"></a>nobs_coffee_dropped <span class="ot">&lt;-</span> <span class="fu">sum</span>(coffee_rep_pmodel<span class="sc">$</span>discarded, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb32-150"><a href="#cb32-150" aria-hidden="true" tabindex="-1"></a>coffee_data<span class="sc">$</span>discarded <span class="ot">&lt;-</span> coffee_rep_pmodel<span class="sc">$</span>discarded</span>
<span id="cb32-151"><a href="#cb32-151" aria-hidden="true" tabindex="-1"></a>nobs_coffee_Tdropped <span class="ot">&lt;-</span> <span class="fu">nrow</span>(<span class="fu">subset</span>(coffee_data,discarded<span class="sc">==</span><span class="cn">TRUE</span><span class="sc">&amp;</span>certified<span class="sc">==</span><span class="dv">1</span>))</span>
<span id="cb32-152"><a href="#cb32-152" aria-hidden="true" tabindex="-1"></a>nobs_coffee_Cdropped <span class="ot">&lt;-</span> <span class="fu">nrow</span>(<span class="fu">subset</span>(coffee_data,discarded<span class="sc">==</span><span class="cn">TRUE</span><span class="sc">&amp;</span>certified<span class="sc">==</span><span class="dv">0</span>))</span>
<span id="cb32-153"><a href="#cb32-153" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-154"><a href="#cb32-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-157"><a href="#cb32-157" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-158"><a href="#cb32-158" aria-hidden="true" tabindex="-1"></a><span class="co">#| dev: "ragg_png"</span></span>
<span id="cb32-159"><a href="#cb32-159" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-coffee-replication-lplot</span></span>
<span id="cb32-160"><a href="#cb32-160" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb32-161"><a href="#cb32-161" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: !expr "knitr::is_html_output()"</span></span>
<span id="cb32-162"><a href="#cb32-162" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code: Create [Figure 4.1](#fig-coffee-replication-lplot)"</span></span>
<span id="cb32-163"><a href="#cb32-163" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "A visual representation of @tbl-coffee-balance called a love plot. Additionally, the unadjusted (raw data) SMDs are displayed for comparison. Variables are ordered by the SMD in the unadjusted data. Plot is created using `love.plot()` from the `cobalt` package."</span></span>
<span id="cb32-164"><a href="#cb32-164" aria-hidden="true" tabindex="-1"></a><span class="co"># add render info for showtext to yaml. also chang legend to be more informative.  </span></span>
<span id="cb32-165"><a href="#cb32-165" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb32-166"><a href="#cb32-166" aria-hidden="true" tabindex="-1"></a><span class="fu">love.plot</span>(coffee_formula, <span class="at">data =</span> coffee_data, </span>
<span id="cb32-167"><a href="#cb32-167" aria-hidden="true" tabindex="-1"></a>          <span class="at">weights =</span> <span class="fu">list</span>(<span class="at">Replication =</span> coffee_rep_pmodel),</span>
<span id="cb32-168"><a href="#cb32-168" aria-hidden="true" tabindex="-1"></a>          <span class="at">sample.names =</span> <span class="fu">c</span>(<span class="st">"Unadjusted"</span>, <span class="st">"Replication"</span>),</span>
<span id="cb32-169"><a href="#cb32-169" aria-hidden="true" tabindex="-1"></a>          <span class="at">var.order =</span> <span class="st">"unadjusted"</span>, <span class="at">binary =</span> <span class="st">"std"</span>,</span>
<span id="cb32-170"><a href="#cb32-170" aria-hidden="true" tabindex="-1"></a>          <span class="at">abs =</span> <span class="cn">TRUE</span>, <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"#333333"</span>, <span class="st">"#2780e3"</span>), </span>
<span id="cb32-171"><a href="#cb32-171" aria-hidden="true" tabindex="-1"></a>          <span class="at">shapes =</span> <span class="fu">c</span>(<span class="st">"circle filled"</span>, <span class="st">"circle filled"</span>),</span>
<span id="cb32-172"><a href="#cb32-172" aria-hidden="true" tabindex="-1"></a>          <span class="at">line =</span> <span class="cn">TRUE</span>, <span class="at">thresholds =</span> <span class="fl">0.1</span>, <span class="at">s.d.denom =</span> <span class="st">"treated"</span>) <span class="sc">+</span></span>
<span id="cb32-173"><a href="#cb32-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Variable Balance of Replication"</span>,</span>
<span id="cb32-174"><a href="#cb32-174" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Absolute Standardised Mean Differences"</span>, <span class="at">fill =</span> <span class="st">"Method"</span>) <span class="sc">+</span></span>
<span id="cb32-175"><a href="#cb32-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">0.6</span>,<span class="at">length.out=</span><span class="dv">7</span>),</span>
<span id="cb32-176"><a href="#cb32-176" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb32-177"><a href="#cb32-177" aria-hidden="true" tabindex="-1"></a>  custom_ggplot_theme </span>
<span id="cb32-178"><a href="#cb32-178" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-179"><a href="#cb32-179" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- the sizing of this vs the other loveplot is inconsistent in pdf output --&gt;</span></span>
<span id="cb32-180"><a href="#cb32-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-181"><a href="#cb32-181" aria-hidden="true" tabindex="-1"></a>@tbl-coffee-balance and @fig-coffee-replication-lplot show that propensity score matching has obtained very poor balance. Based on the $10\%$ rule discussed in @sec-assessing-balance, not a single variable is balanced and so the estimate of the treatment effect is likely to be biased by structural differences between control and certified.</span>
<span id="cb32-182"><a href="#cb32-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-183"><a href="#cb32-183" aria-hidden="true" tabindex="-1"></a>Four key variables: *age*, *gender*, *education*, and *access to credit* all exhibit poor balance. These variables are strong confounders in theory and so emphasising balance in these variables is critical to making a robust causal inference. Perhaps there is gender or age discrimination in the certification process. Perhaps, those with lesser education may struggle to obtain certification. Perhaps those who have less access to credit are unable to afford to become certified. Moving forward, these variables must exhibit better covariate balance to make a robust conclusion.</span>
<span id="cb32-184"><a href="#cb32-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-185"><a href="#cb32-185" aria-hidden="true" tabindex="-1"></a>@fig-replication-pscore shows the effect of common support trimming. @tbl-coffee-replication-ss shows <span class="in">`{r} nobs_coffee_dropped`</span> total observations are dropped of which <span class="in">`{r} nobs_coffee_Tdropped`</span> are treated and <span class="in">`{r} nobs_coffee_Cdropped`</span> are control. By dropping these observations, PSM avoids making poor matching which should lead to better covariate balance. When observations are discarded, the estimand is no longer the ATT. Instead, it is refereed to as the average treatment effect on the matched or ATM. There is a significant reduction in the effective sample size in the control group from $82$ to $21$ individuals.  </span>
<span id="cb32-186"><a href="#cb32-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-189"><a href="#cb32-189" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-190"><a href="#cb32-190" aria-hidden="true" tabindex="-1"></a><span class="co">#| dev: "ragg_png"</span></span>
<span id="cb32-191"><a href="#cb32-191" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb32-192"><a href="#cb32-192" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-replication-pscore</span></span>
<span id="cb32-193"><a href="#cb32-193" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb32-194"><a href="#cb32-194" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: !expr "knitr::is_html_output()"</span></span>
<span id="cb32-195"><a href="#cb32-195" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code: Create [Figure 4.2](#fig-replication-pscore)"</span></span>
<span id="cb32-196"><a href="#cb32-196" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Density estimates of the propensity scores from @Jena2012 using logistic regression. Propensity score matching discards some observations as displayed by the discarded range on the left. A single observation is discarded on the right."</span></span>
<span id="cb32-197"><a href="#cb32-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-198"><a href="#cb32-198" aria-hidden="true" tabindex="-1"></a><span class="co">#check if we acutally using these</span></span>
<span id="cb32-199"><a href="#cb32-199" aria-hidden="true" tabindex="-1"></a>discarded_scores <span class="ot">&lt;-</span> coffee_rep_pmodel<span class="sc">$</span>distance[coffee_rep_pmodel<span class="sc">$</span>discarded]</span>
<span id="cb32-200"><a href="#cb32-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-201"><a href="#cb32-201" aria-hidden="true" tabindex="-1"></a>discard_min <span class="ot">&lt;-</span> <span class="fu">min</span>(discarded_scores, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-202"><a href="#cb32-202" aria-hidden="true" tabindex="-1"></a>discard_max <span class="ot">&lt;-</span> <span class="fu">max</span>(discarded_scores, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-203"><a href="#cb32-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-204"><a href="#cb32-204" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(coffee_data, <span class="fu">aes</span>(<span class="at">x =</span> coffee_rep_pmodel<span class="sc">$</span>distance, </span>
<span id="cb32-205"><a href="#cb32-205" aria-hidden="true" tabindex="-1"></a>                        <span class="at">fill =</span> <span class="fu">factor</span>(certified))) <span class="sc">+</span></span>
<span id="cb32-206"><a href="#cb32-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb32-207"><a href="#cb32-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#e5e5e5"</span>, <span class="st">"#2780e3"</span>), </span>
<span id="cb32-208"><a href="#cb32-208" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Certified"</span>)) <span class="sc">+</span></span>
<span id="cb32-209"><a href="#cb32-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Propensity Scores in Replication"</span>, </span>
<span id="cb32-210"><a href="#cb32-210" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Propensity Scores"</span>, <span class="at">y =</span> <span class="st">"Density"</span>, <span class="at">fill =</span> <span class="st">"Group:"</span>) <span class="sc">+</span></span>
<span id="cb32-211"><a href="#cb32-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb32-212"><a href="#cb32-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb32-213"><a href="#cb32-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> discard_max, <span class="at">color =</span> <span class="st">"#333333"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb32-214"><a href="#cb32-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> <span class="dv">0</span>, <span class="at">xmax =</span> discard_min, <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>, </span>
<span id="cb32-215"><a href="#cb32-215" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">"#333333"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb32-216"><a href="#cb32-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> discard_max, <span class="at">xmax =</span> <span class="dv">1</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>, </span>
<span id="cb32-217"><a href="#cb32-217" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">"#333333"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb32-218"><a href="#cb32-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.02</span>, <span class="at">y =</span> <span class="fl">1.5</span>, </span>
<span id="cb32-219"><a href="#cb32-219" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Discarded Range"</span>, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">1.5</span>, <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb32-220"><a href="#cb32-220" aria-hidden="true" tabindex="-1"></a>           <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">color =</span> <span class="st">"#333333"</span>) <span class="sc">+</span></span>
<span id="cb32-221"><a href="#cb32-221" aria-hidden="true" tabindex="-1"></a>  custom_ggplot_theme</span>
<span id="cb32-222"><a href="#cb32-222" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-223"><a href="#cb32-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-226"><a href="#cb32-226" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-227"><a href="#cb32-227" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-coffee-replication-ss</span></span>
<span id="cb32-228"><a href="#cb32-228" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb32-229"><a href="#cb32-229" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: !expr "knitr::is_html_output()"</span></span>
<span id="cb32-230"><a href="#cb32-230" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code: Create [Table 4.4](#tbl-coffee-replication-ss)"</span></span>
<span id="cb32-231"><a href="#cb32-231" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "The effective sample size resulting from the use of propensity score matching in @Jena2012. The effective sample size (ESS) is displayed in the unweighted (raw) and matched data as well as the number of disarded observations. Computed using `bal.tab()` from the `cobalt` package."</span></span>
<span id="cb32-232"><a href="#cb32-232" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coffee_rep_btab_ss) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Certified"</span>)</span>
<span id="cb32-233"><a href="#cb32-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-234"><a href="#cb32-234" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(coffee_rep_btab_ss, <span class="at">digits=</span><span class="dv">0</span>, <span class="at">align =</span> <span class="st">"c"</span>)</span>
<span id="cb32-235"><a href="#cb32-235" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-236"><a href="#cb32-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-237"><a href="#cb32-237" aria-hidden="true" tabindex="-1"></a>Overall, the propensity score matching in @Jena2012 is poor and results in unbalanced covariates and a loss of estimand.</span>
<span id="cb32-238"><a href="#cb32-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-239"><a href="#cb32-239" aria-hidden="true" tabindex="-1"></a><span class="fu">## Further Modelling </span></span>
<span id="cb32-240"><a href="#cb32-240" aria-hidden="true" tabindex="-1"></a>To improve the poor balance achieved by the @Jena2012, there are two strategies to obtain better balance. First, the propensity scores can be re-estimated using machine learning to obtain better calibrated propensity scores. Second, inverse propensity weighting (IPW) can be used instead of propensity score matching (PSM). IPW should ensure that the sample size remains the same as no observations are lost through a matching process. IPW should retain all observations and preserve the estimand as the ATT. Additionally, IPW is generally more efficient as a pseudo-population is based on precise weights compared to matched observations that are based on approximate similarity.</span>
<span id="cb32-241"><a href="#cb32-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-242"><a href="#cb32-242" aria-hidden="true" tabindex="-1"></a>The machine learning propensity scores will be estimated using the <span class="in">`WeightIt`</span> package in the same process as @sec-demo. To select the tuning criteria, consider that @fig-coffee-replication-lplot that shows a significant range of balance levels in the raw data. Knowing this, the model is tuned using <span class="in">`criterion = "smd.max"`</span> as reducing the priority is to reduce the extremely unbalanced covariates even if this leads to a higher average SMD. </span>
<span id="cb32-243"><a href="#cb32-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-246"><a href="#cb32-246" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-247"><a href="#cb32-247" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: coffee-boost-btab</span></span>
<span id="cb32-248"><a href="#cb32-248" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb32-249"><a href="#cb32-249" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: !expr "knitr::is_html_output()"</span></span>
<span id="cb32-250"><a href="#cb32-250" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code: Perform IPW with a GBM"</span></span>
<span id="cb32-251"><a href="#cb32-251" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(WeightIt)</span>
<span id="cb32-252"><a href="#cb32-252" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cobalt)</span>
<span id="cb32-253"><a href="#cb32-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-254"><a href="#cb32-254" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">88</span>)</span>
<span id="cb32-255"><a href="#cb32-255" aria-hidden="true" tabindex="-1"></a>coffee_boosted_weight <span class="ot">&lt;-</span> <span class="fu">weightit</span>(coffee_formula, <span class="at">data =</span> coffee_data, </span>
<span id="cb32-256"><a href="#cb32-256" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">method =</span> <span class="st">"gbm"</span>, <span class="at">distribution =</span> <span class="st">"bernoulli"</span>,</span>
<span id="cb32-257"><a href="#cb32-257" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">use.offset =</span> T,</span>
<span id="cb32-258"><a href="#cb32-258" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">shrinkage =</span> <span class="fu">seq</span>(<span class="fl">0.15</span>, <span class="fl">0.4</span>, <span class="at">length.out =</span> <span class="dv">5</span>),</span>
<span id="cb32-259"><a href="#cb32-259" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">bag.fraction =</span> <span class="fl">0.67</span>, </span>
<span id="cb32-260"><a href="#cb32-260" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">interaction.depth =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>,</span>
<span id="cb32-261"><a href="#cb32-261" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">n.trees =</span> <span class="dv">500</span>,</span>
<span id="cb32-262"><a href="#cb32-262" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">criterion =</span> <span class="st">"smd.mean"</span>, </span>
<span id="cb32-263"><a href="#cb32-263" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">estimand =</span> <span class="st">"ATT"</span>)</span>
<span id="cb32-264"><a href="#cb32-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-265"><a href="#cb32-265" aria-hidden="true" tabindex="-1"></a>coffee_boosted_btab <span class="ot">&lt;-</span> <span class="fu">bal.tab</span>(coffee_boosted_weight, <span class="at">data =</span> coffee_data, </span>
<span id="cb32-266"><a href="#cb32-266" aria-hidden="true" tabindex="-1"></a>                               <span class="at">stats =</span> <span class="fu">c</span>(<span class="st">"mean.diffs"</span>, <span class="st">"variance.ratios"</span>),</span>
<span id="cb32-267"><a href="#cb32-267" aria-hidden="true" tabindex="-1"></a>                               <span class="at">binary =</span> <span class="st">"std"</span>, <span class="at">continuous =</span> <span class="st">"std"</span>,</span>
<span id="cb32-268"><a href="#cb32-268" aria-hidden="true" tabindex="-1"></a>                               <span class="at">thresholds =</span> <span class="fu">c</span>(<span class="at">mean.diffs =</span> <span class="fl">0.1</span>),</span>
<span id="cb32-269"><a href="#cb32-269" aria-hidden="true" tabindex="-1"></a>                               <span class="at">s.d.denom =</span> <span class="st">"treated"</span>)</span>
<span id="cb32-270"><a href="#cb32-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-271"><a href="#cb32-271" aria-hidden="true" tabindex="-1"></a>coffee_boosted_btab <span class="ot">&lt;-</span> coffee_boosted_btab<span class="sc">$</span>Balance[<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>)]</span>
<span id="cb32-272"><a href="#cb32-272" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-273"><a href="#cb32-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-274"><a href="#cb32-274" aria-hidden="true" tabindex="-1"></a>::: {.callout-note title="Discussion of Tuning"}</span>
<span id="cb32-275"><a href="#cb32-275" aria-hidden="true" tabindex="-1"></a>Initially, a tuning grid considering shrinkage values of $0.001,0.005,.01,0.05,0.1,\text{ and }0.2$ were considered using $10000$ trees with a depth between $1$ and $5$. The best tuning performance was found with shrinkage of $0.2$ and $9$ trees which were three splits $3$ deep. As such, the tuning grid was redefined in a second iteration to use $0.1, 0.15, 0.2, 0.25, 0.3,0.35,\text{ and } 0.4$ with only $1000$ trees with between $2$ and $5$ depth. The second fit, suggested a learning rate of $0.35$ so the local area of $0.3, 0.325, 0.350, 0.375, \text{ and }0.4$ is searched in the final fit.</span>
<span id="cb32-276"><a href="#cb32-276" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb32-277"><a href="#cb32-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-280"><a href="#cb32-280" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-281"><a href="#cb32-281" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: coffee_logit_weight</span></span>
<span id="cb32-282"><a href="#cb32-282" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb32-283"><a href="#cb32-283" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: !expr "knitr::is_html_output()"</span></span>
<span id="cb32-284"><a href="#cb32-284" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code: Perform IPW with Logistic Regression"</span></span>
<span id="cb32-285"><a href="#cb32-285" aria-hidden="true" tabindex="-1"></a>coffee_logit_weight <span class="ot">&lt;-</span> <span class="fu">weightit</span>(coffee_formula, <span class="at">data =</span> coffee_data, </span>
<span id="cb32-286"><a href="#cb32-286" aria-hidden="true" tabindex="-1"></a>                                <span class="at">method=</span> <span class="st">"glm"</span>, <span class="at">estimand =</span> <span class="st">"ATT"</span>)</span>
<span id="cb32-287"><a href="#cb32-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-288"><a href="#cb32-288" aria-hidden="true" tabindex="-1"></a>coffee_logit_btab <span class="ot">&lt;-</span> <span class="fu">bal.tab</span>(coffee_logit_weight, <span class="at">data =</span> coffee_data,</span>
<span id="cb32-289"><a href="#cb32-289" aria-hidden="true" tabindex="-1"></a>                             <span class="at">formula =</span> coffee_formula,</span>
<span id="cb32-290"><a href="#cb32-290" aria-hidden="true" tabindex="-1"></a>                             <span class="at">stats =</span> <span class="fu">c</span>(<span class="st">"mean.diffs"</span>, <span class="st">"variance.ratios"</span>),</span>
<span id="cb32-291"><a href="#cb32-291" aria-hidden="true" tabindex="-1"></a>                             <span class="at">binary =</span> <span class="st">"std"</span>, <span class="at">continuous =</span> <span class="st">"std"</span>,</span>
<span id="cb32-292"><a href="#cb32-292" aria-hidden="true" tabindex="-1"></a>                             <span class="at">thresholds =</span> <span class="fu">c</span>(<span class="at">mean.diffs =</span> <span class="fl">0.1</span>),</span>
<span id="cb32-293"><a href="#cb32-293" aria-hidden="true" tabindex="-1"></a>                             <span class="at">s.d.denom =</span> <span class="st">"treated"</span>)</span>
<span id="cb32-294"><a href="#cb32-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-295"><a href="#cb32-295" aria-hidden="true" tabindex="-1"></a>coffee_logit_btab <span class="ot">&lt;-</span> coffee_logit_btab<span class="sc">$</span>Balance[<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>)]</span>
<span id="cb32-296"><a href="#cb32-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-297"><a href="#cb32-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-298"><a href="#cb32-298" aria-hidden="true" tabindex="-1"></a>Of course there is no guarantee that the GBM model will perform the best and so a logistic model is also fitted. An interesting comparison is between the SMDs in the matched data and in the weighted sample. Any differences between the two samples relates to the difference between PSM and IPW as the propensity scores are identical.</span>
<span id="cb32-299"><a href="#cb32-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-300"><a href="#cb32-300" aria-hidden="true" tabindex="-1"></a><span class="fu">## Comparison of Methods </span></span>
<span id="cb32-301"><a href="#cb32-301" aria-hidden="true" tabindex="-1"></a>In some of the earlier code chunks, the <span class="in">`cobalt`</span> package's <span class="in">`bal.tab()`</span> computed balance tables which are combined together in @tbl-coffee-comparison to provide a comparison between methods. For a visual interpretation, <span class="in">`love.plot()`</span> creates @fig-coffee-love-all. </span>
<span id="cb32-302"><a href="#cb32-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-303"><a href="#cb32-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-306"><a href="#cb32-306" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-307"><a href="#cb32-307" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb32-308"><a href="#cb32-308" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: !expr "knitr::is_html_output()"</span></span>
<span id="cb32-309"><a href="#cb32-309" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code: Create [Table 4.5](#tbl-coffee-comparison)."</span></span>
<span id="cb32-310"><a href="#cb32-310" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-coffee-comparison</span></span>
<span id="cb32-311"><a href="#cb32-311" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Comparison of standardised mean difference (SMD) using different propensity score models. Across each of the covariates, a balance threshold is set at $0.1$ to indicate if a covariate is balanced. Binary and continuous variables are both standardised over the treatment group. SMDs are computed using `bal.tab()` from the `cobalt` package."</span></span>
<span id="cb32-312"><a href="#cb32-312" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"data.table"</span>)</span>
<span id="cb32-313"><a href="#cb32-313" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cobalt)</span>
<span id="cb32-314"><a href="#cb32-314" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb32-315"><a href="#cb32-315" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb32-316"><a href="#cb32-316" aria-hidden="true" tabindex="-1"></a>coffee_raw_btab <span class="ot">&lt;-</span> <span class="fu">bal.tab</span>(coffee_formula, <span class="at">data =</span> coffee_data, </span>
<span id="cb32-317"><a href="#cb32-317" aria-hidden="true" tabindex="-1"></a>                        <span class="at">stats =</span> <span class="fu">c</span>(<span class="st">"mean.diffs"</span>,<span class="st">"variance.ratios"</span>),</span>
<span id="cb32-318"><a href="#cb32-318" aria-hidden="true" tabindex="-1"></a>                        <span class="at">binary =</span> <span class="st">"std"</span>, <span class="at">continuous =</span> <span class="st">"std"</span>,</span>
<span id="cb32-319"><a href="#cb32-319" aria-hidden="true" tabindex="-1"></a>                        <span class="at">thresholds =</span> <span class="fu">c</span>(<span class="at">mean.diffs =</span> <span class="fl">0.1</span>),</span>
<span id="cb32-320"><a href="#cb32-320" aria-hidden="true" tabindex="-1"></a>                        <span class="at">s.d.denom =</span> <span class="st">"treated"</span>)</span>
<span id="cb32-321"><a href="#cb32-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-322"><a href="#cb32-322" aria-hidden="true" tabindex="-1"></a>coffee_raw_btab <span class="ot">&lt;-</span> coffee_raw_btab<span class="sc">$</span>Balance[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">6</span>)]</span>
<span id="cb32-323"><a href="#cb32-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-324"><a href="#cb32-324" aria-hidden="true" tabindex="-1"></a>coffee_combined_btab <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(<span class="fu">list</span>(coffee_raw_btab,</span>
<span id="cb32-325"><a href="#cb32-325" aria-hidden="true" tabindex="-1"></a>                                       coffee_logit_btab,</span>
<span id="cb32-326"><a href="#cb32-326" aria-hidden="true" tabindex="-1"></a>                                       coffee_boosted_btab), </span>
<span id="cb32-327"><a href="#cb32-327" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">use.names=</span><span class="cn">FALSE</span>)</span>
<span id="cb32-328"><a href="#cb32-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-329"><a href="#cb32-329" aria-hidden="true" tabindex="-1"></a>coffee_combined_btab<span class="sc">$</span>Variable <span class="ot">&lt;-</span> <span class="fu">rep</span>(rowlabels, <span class="dv">3</span>)</span>
<span id="cb32-330"><a href="#cb32-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-331"><a href="#cb32-331" aria-hidden="true" tabindex="-1"></a>coffee_combined_btab <span class="ot">&lt;-</span> coffee_combined_btab[, <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)]</span>
<span id="cb32-332"><a href="#cb32-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-333"><a href="#cb32-333" aria-hidden="true" tabindex="-1"></a>coffee_combined_btab[, <span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb32-334"><a href="#cb32-334" aria-hidden="true" tabindex="-1"></a>          coffee_combined_btab[, <span class="dv">4</span>] <span class="sc">&gt;=</span> <span class="st">"Not Balanced, &gt;0.1"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>)</span>
<span id="cb32-335"><a href="#cb32-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-336"><a href="#cb32-336" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(coffee_combined_btab, <span class="at">digits =</span> <span class="dv">4</span>, <span class="at">booktabs =</span> <span class="cn">TRUE</span>, <span class="at">align =</span> <span class="st">"c"</span>, </span>
<span id="cb32-337"><a href="#cb32-337" aria-hidden="true" tabindex="-1"></a>    <span class="at">font_size =</span> <span class="dv">10</span>, <span class="at">col.names =</span> colnames) <span class="sc">%&gt;%</span></span>
<span id="cb32-338"><a href="#cb32-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-339"><a href="#cb32-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">width =</span> <span class="st">"5cm"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-340"><a href="#cb32-340" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">bold =</span> <span class="cn">FALSE</span>, <span class="at">width =</span> <span class="st">"1cm"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-341"><a href="#cb32-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pack_rows</span>(<span class="st">"Raw Data"</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="at">label_row_css =</span> <span class="st">"text-align: center;"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-342"><a href="#cb32-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pack_rows</span>(<span class="st">"Logistic Regression and IPTW"</span>, <span class="dv">11</span>, <span class="dv">20</span>, </span>
<span id="cb32-343"><a href="#cb32-343" aria-hidden="true" tabindex="-1"></a>            <span class="at">label_row_css =</span> <span class="st">"text-align: center;"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-344"><a href="#cb32-344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pack_rows</span>(<span class="st">"Boosting Machine with IPTW"</span>, <span class="dv">21</span>, <span class="dv">30</span>, </span>
<span id="cb32-345"><a href="#cb32-345" aria-hidden="true" tabindex="-1"></a>            <span class="at">label_row_css =</span> <span class="st">"text-align: center;"</span>)</span>
<span id="cb32-346"><a href="#cb32-346" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-347"><a href="#cb32-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-348"><a href="#cb32-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-351"><a href="#cb32-351" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-352"><a href="#cb32-352" aria-hidden="true" tabindex="-1"></a><span class="co">#| dev: "ragg_png"</span></span>
<span id="cb32-353"><a href="#cb32-353" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-coffee-love-all</span></span>
<span id="cb32-354"><a href="#cb32-354" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb32-355"><a href="#cb32-355" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: !expr "knitr::is_html_output()"</span></span>
<span id="cb32-356"><a href="#cb32-356" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code: Create [Figure 4.3](#fig-coffee-love-all)"</span></span>
<span id="cb32-357"><a href="#cb32-357" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Visual representation of @tbl-coffee-comparison called a love plot and displays the standardised mean difference (SMD) of covariates in @Jena2012. Additionally, the unadjusted SMDs are displayed for comparison. Variables are ordered by the SMD in the unadjusted data."</span></span>
<span id="cb32-358"><a href="#cb32-358" aria-hidden="true" tabindex="-1"></a><span class="fu">love.plot</span>(coffee_formula,</span>
<span id="cb32-359"><a href="#cb32-359" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> coffee_data, </span>
<span id="cb32-360"><a href="#cb32-360" aria-hidden="true" tabindex="-1"></a>          <span class="at">weights =</span> <span class="fu">list</span>(<span class="at">Replication =</span> coffee_rep_pmodel,</span>
<span id="cb32-361"><a href="#cb32-361" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Logit =</span> coffee_logit_weight,</span>
<span id="cb32-362"><a href="#cb32-362" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Boosting=</span> coffee_boosted_weight),</span>
<span id="cb32-363"><a href="#cb32-363" aria-hidden="true" tabindex="-1"></a>          <span class="at">var.order =</span> <span class="st">"unadjusted"</span>, <span class="at">binary =</span> <span class="st">"std"</span>, <span class="at">continuous =</span> <span class="st">"std"</span>,</span>
<span id="cb32-364"><a href="#cb32-364" aria-hidden="true" tabindex="-1"></a>          <span class="at">abs =</span> <span class="cn">TRUE</span>, <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"#333333"</span>, <span class="st">"#2780e3"</span>, <span class="st">"darkblue"</span>,<span class="st">"darkred"</span>), </span>
<span id="cb32-365"><a href="#cb32-365" aria-hidden="true" tabindex="-1"></a>          <span class="at">shapes =</span> <span class="fu">rep</span>(<span class="st">"circle filled"</span>, <span class="dv">4</span>),</span>
<span id="cb32-366"><a href="#cb32-366" aria-hidden="true" tabindex="-1"></a>          <span class="at">line =</span> <span class="cn">TRUE</span>, <span class="at">thresholds =</span> <span class="fl">0.1</span>, <span class="at">s.d.denom =</span> <span class="st">"treated"</span>, <span class="at">use.grid =</span> F) <span class="sc">+</span></span>
<span id="cb32-367"><a href="#cb32-367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Variable Balance Using Different Balance Methods"</span>,</span>
<span id="cb32-368"><a href="#cb32-368" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Absolute Standardised Mean Differences"</span>,</span>
<span id="cb32-369"><a href="#cb32-369" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Method"</span>) <span class="sc">+</span></span>
<span id="cb32-370"><a href="#cb32-370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">0.6</span>,<span class="at">length.out=</span><span class="dv">7</span>),</span>
<span id="cb32-371"><a href="#cb32-371" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb32-372"><a href="#cb32-372" aria-hidden="true" tabindex="-1"></a>  custom_ggplot_theme </span>
<span id="cb32-373"><a href="#cb32-373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-374"><a href="#cb32-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-375"><a href="#cb32-375" aria-hidden="true" tabindex="-1"></a>There are three notable findings: </span>
<span id="cb32-376"><a href="#cb32-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-377"><a href="#cb32-377" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>PSM has performed very poorly relative to IPW even when matching dropps a significant number of observations.  </span>
<span id="cb32-378"><a href="#cb32-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-379"><a href="#cb32-379" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>A GBM model has resulted in better covariate balance than logistic regression for most covariates. Using a $10\%$ threshold for determining balance, logistic regression leaves $5$ variables unbalanced and the GBM leaves $3$ variables unbalanced. Additionally, the degree of unbalance is larger for logistic regression. </span>
<span id="cb32-380"><a href="#cb32-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-381"><a href="#cb32-381" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Logistic regress has a satisfactory average SMD of <span class="in">`{r} mean(coffee_logit_btab$Diff.Adj)`</span>. Boosting has an average SMD of <span class="in">`{r} mean(coffee_boosted_btab$Diff.Adj)`</span> which is excellent and meets a rigorous threshold of $5\%$. </span>
<span id="cb32-382"><a href="#cb32-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-383"><a href="#cb32-383" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>The covariate with the highest SMD is *household age* ($0.245\%$) in logistic regression and *bad weather* ($0.191$) in the GBM.</span>
<span id="cb32-384"><a href="#cb32-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-385"><a href="#cb32-385" aria-hidden="true" tabindex="-1"></a><span class="fu">## Results</span></span>
<span id="cb32-386"><a href="#cb32-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-387"><a href="#cb32-387" aria-hidden="true" tabindex="-1"></a>Now that satisfactory covariate balance is achieved, the treatment effect can be estimated under logistic regression, the GBM, and then compared to the result in the paper. Note that the estimand in the paper is intended to be the average treatment effect (ATT) but dropped observations mean the actual treatment effect is the average treatment effect on matched (ATM) individuals. In theory, better covariate balance should lead to a better estimate of the ATT so a comparison of the estimates is interesting. As in @sec-nsw-results, the results will be completed using G-computation with the <span class="in">`lm_weightit()`</span> and <span class="in">`avg_comparisons()`</span> functions.</span>
<span id="cb32-388"><a href="#cb32-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-391"><a href="#cb32-391" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-392"><a href="#cb32-392" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb32-393"><a href="#cb32-393" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: !expr "knitr::is_html_output()"</span></span>
<span id="cb32-394"><a href="#cb32-394" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code: Create [Table 4.6](#tbl-comparison-coffee-results)"</span></span>
<span id="cb32-395"><a href="#cb32-395" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-comparison-coffee-results</span></span>
<span id="cb32-396"><a href="#cb32-396" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Estimates of the average treatment effect on the treated of certification on per capita income across different propensity score models and methods. Created using `WeightIt`, `MatchIt`, and `Cobalt` packages."</span></span>
<span id="cb32-397"><a href="#cb32-397" aria-hidden="true" tabindex="-1"></a>coffee_att_formula <span class="ot">&lt;-</span> <span class="fu">update.formula</span>(<span class="fu">as.formula</span>(</span>
<span id="cb32-398"><a href="#cb32-398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="st">"~"</span>, <span class="fu">paste</span>(<span class="fu">attr</span>(<span class="fu">terms</span>(coffee_formula), <span class="st">"term.labels"</span>), </span>
<span id="cb32-399"><a href="#cb32-399" aria-hidden="true" tabindex="-1"></a>                   <span class="at">collapse =</span> <span class="st">" + "</span>))), </span>
<span id="cb32-400"><a href="#cb32-400" aria-hidden="true" tabindex="-1"></a>  percapitaincome_day_maleeq <span class="sc">~</span> certified <span class="sc">*</span> .)</span>
<span id="cb32-401"><a href="#cb32-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-402"><a href="#cb32-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-403"><a href="#cb32-403" aria-hidden="true" tabindex="-1"></a>coffee_logit_fit <span class="ot">&lt;-</span> <span class="fu">lm_weightit</span>(coffee_att_formula,</span>
<span id="cb32-404"><a href="#cb32-404" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> coffee_data, <span class="at">weightit =</span> coffee_logit_weight)</span>
<span id="cb32-405"><a href="#cb32-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-406"><a href="#cb32-406" aria-hidden="true" tabindex="-1"></a>coffee_boosted_fit <span class="ot">&lt;-</span> <span class="fu">lm_weightit</span>(coffee_att_formula,</span>
<span id="cb32-407"><a href="#cb32-407" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">data =</span> coffee_data, </span>
<span id="cb32-408"><a href="#cb32-408" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">weightit =</span> coffee_boosted_weight)</span>
<span id="cb32-409"><a href="#cb32-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-410"><a href="#cb32-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-411"><a href="#cb32-411" aria-hidden="true" tabindex="-1"></a>coffee_logit_att <span class="ot">&lt;-</span> <span class="fu">avg_comparisons</span>(coffee_logit_fit, <span class="at">variables =</span> <span class="st">"certified"</span>)</span>
<span id="cb32-412"><a href="#cb32-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-413"><a href="#cb32-413" aria-hidden="true" tabindex="-1"></a>coffee_boosted_att <span class="ot">&lt;-</span> <span class="fu">avg_comparisons</span>(coffee_boosted_fit, </span>
<span id="cb32-414"><a href="#cb32-414" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">variables =</span> <span class="st">"certified"</span>)</span>
<span id="cb32-415"><a href="#cb32-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-416"><a href="#cb32-416" aria-hidden="true" tabindex="-1"></a>coffee_comparisons_tab <span class="ot">&lt;-</span> <span class="fu">rbind</span>(replicated_result_tbl, </span>
<span id="cb32-417"><a href="#cb32-417" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">extract_comparison_results</span>(coffee_logit_att),</span>
<span id="cb32-418"><a href="#cb32-418" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">extract_comparison_results</span>(coffee_boosted_att))</span>
<span id="cb32-419"><a href="#cb32-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-420"><a href="#cb32-420" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(coffee_comparisons_tab) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Rep. Result (Logistic with PSM)"</span>,</span>
<span id="cb32-421"><a href="#cb32-421" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Logistic Regression and IPW"</span>, </span>
<span id="cb32-422"><a href="#cb32-422" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Generalized Boosting Machine and IPW"</span>)</span>
<span id="cb32-423"><a href="#cb32-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-424"><a href="#cb32-424" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(coffee_comparisons_tab, <span class="at">digits =</span> <span class="dv">4</span>)</span>
<span id="cb32-425"><a href="#cb32-425" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-426"><a href="#cb32-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-427"><a href="#cb32-427" aria-hidden="true" tabindex="-1"></a>@tbl-comparison-coffee-results shows the estimates of the treatment effect across different methods. Recall that @Jena2012 estimate a an effect of $-0.15$ implying that daily income reduces by $0.15$ if a farmer becomes certified. This result is not statistically significant. </span>
<span id="cb32-428"><a href="#cb32-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-429"><a href="#cb32-429" aria-hidden="true" tabindex="-1"></a>The IPW estimate is $-1.58$ implying that certification leads to a $\$1.58$ decrease in daily income. This coefficient is much larger than than the original paper by a magnitude of $10$. Additionally, this estimate is statistically significant at the $1\%$ level. The GBM estimate is $-1.02$ which predicts a decrease in daily income by $\$1.02$ when a farmer becomes certified. This finding is statistically significant at the $5\%$ level. </span>
<span id="cb32-430"><a href="#cb32-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-431"><a href="#cb32-431" aria-hidden="true" tabindex="-1"></a>The reason for a large difference is threefold. First, better covariate balance by using a GBM and IPW and should result in a more robust estimate. Of course better covariate balance alone does not guarantee robust results but it is a step in the right direction. Theoretically, weighting on the inverse of the propensity scores from a GBM results in the best estimate so the paper may significantly underestimate the coefficient. Second, a different estimand will often lead to a different estimate of the treatment effect. It is not clear or directly estimable how much of the difference in estimate results from switching from the ATM to the ATT. Related to this, the data used to estimate the treatment effect is different as there are no dropped observations either of the IPW estimates. Third...</span>
<span id="cb32-432"><a href="#cb32-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-433"><a href="#cb32-433" aria-hidden="true" tabindex="-1"></a>The most interesting result is that the estimates become even more negative. One may expect that the result from a better balanced sample would become positive to align with theoretical motivations for cerification policies. @Jena2012 presented two explanations for why certification shows no positive impact. Firstly, the authors note that the prices offered by certified cooperatives are not significantly different from those provided by non-certified cooperatives. Secondly, a substantial portion of coffee—about 75%—is sold to private traders, who often pay higher prices to non-certified farmers. Additionally, from qualitative interviews with farmers, the authors note that policies and arrangements within different cooperatives exhibit heterogeneity so the impact of certification may relate more to the structure of the cooperatives. </span>
<span id="cb32-434"><a href="#cb32-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-435"><a href="#cb32-435" aria-hidden="true" tabindex="-1"></a>An additional answer is the impact of reverse causality. A general problem is causal inference is that the direction of causality is not always known. While it is most intuitive that coffee certification would impact income, it is also possible that a farmers daily income might determine their certification. Suppose that proponents of fairtrade and certification are correct that it will increase income and benefit livelihood. If farmers are are of this, then perhaps the lowest income farmers are most likely to attempt to become certified to increase their income. Additionally, income likely has a reverse causal relationship with many of the explanatory variables. For example, a higher income may lead to better access to credit and the accumulation of land. </span>
<span id="cb32-436"><a href="#cb32-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-437"><a href="#cb32-437" aria-hidden="true" tabindex="-1"></a>In summary, the analysis demonstrates that using more advanced methods like GBM and IPW not only improves covariate balance but also leads to significantly larger and more negative estimates of the treatment effect compared to the original study. This suggests that previous estimates may have underestimated the negative impact of certification on daily income. The findings highlight the importance of methodological rigor in estimating causal effects and raise critical questions about the broader implications of certification policies, particularly when considering potential reverse causality and the varying structures of cooperatives. This analysis underscores the need for careful interpretation of treatment effects, especially in policy-relevant research.</span>
<span id="cb32-438"><a href="#cb32-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-439"><a href="#cb32-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-442"><a href="#cb32-442" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-443"><a href="#cb32-443" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb32-444"><a href="#cb32-444" aria-hidden="true" tabindex="-1"></a><span class="fu">save.image</span>(<span class="at">file =</span> <span class="st">"globals.RData"</span>)</span>
<span id="cb32-445"><a href="#cb32-445" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/mitchellcameron123/ML-PS.git/edit/main/chapters/coffee_replication.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div></div></footer><script>var lightboxQuarto = GLightbox({"selector":".lightbox","loop":false,"closeEffect":"zoom","descPosition":"bottom","openEffect":"zoom"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>